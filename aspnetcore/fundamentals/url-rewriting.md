---
title: Oprogramowanie pośredniczące do przepisywania adresów URL w ASP.NET Core
author: rick-anderson
description: Dowiedz się więcej o przepisywaniu i przekierowywaniu adresów URL za pomocą oprogramowania pośredniczącego do przepisywania adresów URL w aplikacjach ASP.NET Core.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 08/16/2019
uid: fundamentals/url-rewriting
ms.openlocfilehash: 7d63cf381f1d8a19ed4fb789348e36f94304ad63
ms.sourcegitcommit: f7886fd2e219db9d7ce27b16c0dc5901e658d64e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2020
ms.locfileid: "78666468"
---
# <a name="url-rewriting-middleware-in-aspnet-core"></a><span data-ttu-id="9e65d-103">Oprogramowanie pośredniczące do przepisywania adresów URL w ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="9e65d-103">URL Rewriting Middleware in ASP.NET Core</span></span>

<span data-ttu-id="9e65d-104">Przez [Mikael Mengistu](https://github.com/mikaelm12)</span><span class="sxs-lookup"><span data-stu-id="9e65d-104">By [Mikael Mengistu](https://github.com/mikaelm12)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="9e65d-105">W tym dokumencie wprowadzono przepisywanie adresów URL z instrukcjami dotyczącymi używania oprogramowania pośredniczącego do przepisywania adresów URL w aplikacjach ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="9e65d-105">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="9e65d-106">Przepisywanie adresów URL to czynność modyfikowania adresów URL żądań na podstawie co najmniej jednej wstępnie zdefiniowanej reguły.</span><span class="sxs-lookup"><span data-stu-id="9e65d-106">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="9e65d-107">Przepisywanie adresów URL tworzy abstrakcję między lokalizacjami zasobów a ich adresami, dzięki czemu lokalizacje i adresy nie są ściśle powiązane.</span><span class="sxs-lookup"><span data-stu-id="9e65d-107">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="9e65d-108">Przepisywanie adresów URL jest cenne w kilku scenariuszach, aby:</span><span class="sxs-lookup"><span data-stu-id="9e65d-108">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="9e65d-109">Przenieś lub zastąp zasoby serwera tymczasowo lub na stałe i zachowaj stabilne lokalizatory dla tych zasobów.</span><span class="sxs-lookup"><span data-stu-id="9e65d-109">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="9e65d-110">Przetwarzanie żądań podzielonych na różne aplikacje lub w różnych obszarach jednej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-110">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="9e65d-111">Usuwanie, dodawanie lub reorganizowanie segmentów adresów URL w żądaniach przychodzących.</span><span class="sxs-lookup"><span data-stu-id="9e65d-111">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="9e65d-112">Optymalizacja publicznych adresów URL pod kątem optymalizacji pod kątem wyszukiwarek (SEO).</span><span class="sxs-lookup"><span data-stu-id="9e65d-112">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="9e65d-113">Zezwalaj na używanie przyjaznych publicznych adresów URL, aby ułatwić odwiedzającym przewidywanie zwracanej zawartości przez żądanie zasobu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-113">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="9e65d-114">Przekieruj niezabezpieczone żądania do bezpiecznych punktów końcowych.</span><span class="sxs-lookup"><span data-stu-id="9e65d-114">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="9e65d-115">Zapobiegaj hotlinkingowi, gdy witryna zewnętrzna używa hostowanego zasobu statycznego w innej witrynie, łącząc go z własną zawartością.</span><span class="sxs-lookup"><span data-stu-id="9e65d-115">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="9e65d-116">Przepisywanie adresów URL może zmniejszyć wydajność aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-116">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="9e65d-117">Tam, gdzie jest to możliwe, ogranicz liczbę i złożoność przepisów.</span><span class="sxs-lookup"><span data-stu-id="9e65d-117">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="9e65d-118">[Wyświetl lub pobierz przykładowy kod](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([jak pobrać](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="9e65d-118">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="9e65d-119">Przekierowanie adresu URL i przepisanie adresu URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-119">URL redirect and URL rewrite</span></span>

<span data-ttu-id="9e65d-120">Różnica w sformułowaniu między *przekierowaniem adresu URL* a *przepisaniem adresu URL jest subtelna,* ale ma istotne implikacje dla dostarczania zasobów klientom.</span><span class="sxs-lookup"><span data-stu-id="9e65d-120">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="9e65d-121">ASP.NET Core url przepisywanie oprogramowania pośredniczącego jest w stanie zasypać potrzebę obu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-121">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="9e65d-122">*Przekierowanie adresu URL* obejmuje operację po stronie klienta, gdzie klient jest poinstruowany, aby uzyskać dostęp do zasobu pod innym adresem niż klient pierwotnie żądany.</span><span class="sxs-lookup"><span data-stu-id="9e65d-122">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="9e65d-123">Wymaga to podróży w obie strony do serwera.</span><span class="sxs-lookup"><span data-stu-id="9e65d-123">This requires a round trip to the server.</span></span> <span data-ttu-id="9e65d-124">Adres URL przekierowania zwrócony do klienta pojawia się na pasku adresu przeglądarki, gdy klient wysunie nowe żądanie dla zasobu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-124">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="9e65d-125">Jeśli `/resource` zostanie *przekierowany* do `/different-resource`programu, serwer odpowiada, że `/different-resource` klient powinien uzyskać zasób z kodem stanu wskazującym, że przekierowanie jest tymczasowe lub stałe.</span><span class="sxs-lookup"><span data-stu-id="9e65d-125">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Punkt końcowy usługi WebAPI został tymczasowo zmieniony z wersji 1 (wersja 1) na wersję 2 (wersja 2) na serwerze.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="9e65d-131">Podczas przekierowywania żądań do innego adresu URL, należy wskazać, czy przekierowanie jest stałe czy tymczasowe, określając kod stanu z odpowiedzią:</span><span class="sxs-lookup"><span data-stu-id="9e65d-131">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="9e65d-132">*301 - Przeniesiony kod* stanu trwale jest używany, gdy zasób ma nowy, stały adres URL i chcesz poinstruować klienta, że wszystkie przyszłe żądania dla zasobu powinny używać nowego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-132">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="9e65d-133">*Klient może buforować i ponownie używać odpowiedzi po odebraniu kodu stanu 301.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-133">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="9e65d-134">Kod stanu *302 - Znaleziono* jest używany, gdy przekierowanie jest tymczasowe lub zazwyczaj może ulec zmianie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-134">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="9e65d-135">Kod stanu 302 oznacza, że klient nie przechowuje adresu URL i nie używa go w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="9e65d-135">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="9e65d-136">Aby uzyskać więcej informacji na temat kodów stanu, zobacz [RFC 2616: Definicje kodu stanu](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span><span class="sxs-lookup"><span data-stu-id="9e65d-136">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="9e65d-137">*Przepisanie adresu URL* jest operacją po stronie serwera, która zapewnia zasób z adresu innego zasobu niż żądany klient.</span><span class="sxs-lookup"><span data-stu-id="9e65d-137">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="9e65d-138">Przepisywanie adresu URL nie wymaga podróży w obie strony do serwera.</span><span class="sxs-lookup"><span data-stu-id="9e65d-138">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="9e65d-139">Przepisany adres URL nie jest zwracany do klienta i nie jest wyświetlany na pasku adresu przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="9e65d-139">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="9e65d-140">Jeśli `/resource` jest *przepisany* do `/different-resource`, serwer *wewnętrznie* pobiera i `/different-resource`zwraca zasób w .</span><span class="sxs-lookup"><span data-stu-id="9e65d-140">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="9e65d-141">Mimo że klient może być w stanie pobrać zasób przy przepisanych adresów URL, klient nie jest informowany, że zasób istnieje w przepisany adres URL, gdy sprawia, że jego żądanie i odbiera odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="9e65d-141">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Punkt końcowy usługi WebAPI został zmieniony z wersji 1 (wersja 1) na wersję 2 (wersja 2) na serwerze.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="9e65d-146">Przykładowa aplikacja do przepisywania adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-146">URL rewriting sample app</span></span>

<span data-ttu-id="9e65d-147">Za pomocą [przykładowej aplikacji](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/)można zapoznać się z funkcjami oprogramowania pośredniczącego przepisywania adresów URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-147">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="9e65d-148">Aplikacja stosuje reguły przekierowania i przepisywania i pokazuje przekierowany lub przepisany adres URL dla kilku scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="9e65d-148">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="9e65d-149">Kiedy używać oprogramowania pośredniczącego do przepisywania adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-149">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="9e65d-150">Oprogramowanie pośredniczące do przepisywania adresów URL używa się następujących metod:</span><span class="sxs-lookup"><span data-stu-id="9e65d-150">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="9e65d-151">Moduł przepisywania adresów URL z usługami IIS w systemie Windows Server</span><span class="sxs-lookup"><span data-stu-id="9e65d-151">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="9e65d-152">Moduł mod_rewrite Apache na serwerze Apache</span><span class="sxs-lookup"><span data-stu-id="9e65d-152">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="9e65d-153">Przepisywanie adresów URL w Nginx</span><span class="sxs-lookup"><span data-stu-id="9e65d-153">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="9e65d-154">Ponadto należy użyć oprogramowania pośredniczącego, gdy aplikacja jest hostowana na [serwerze HTTP.sys](xref:fundamentals/servers/httpsys) (dawniej nazywanym WebListener).</span><span class="sxs-lookup"><span data-stu-id="9e65d-154">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="9e65d-155">Główne powody, dla których warto używać opartych na serwerze technologii przepisywania adresów URL w usługach IIS, Apache i Nginx to:</span><span class="sxs-lookup"><span data-stu-id="9e65d-155">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="9e65d-156">Oprogramowanie pośredniczące nie obsługuje pełnych funkcji tych modułów.</span><span class="sxs-lookup"><span data-stu-id="9e65d-156">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="9e65d-157">Niektóre funkcje modułów serwera nie działają z ASP.NET projektów podstawowych, `IsFile` takich `IsDirectory` jak i ograniczenia modułu IIS Rewrite.</span><span class="sxs-lookup"><span data-stu-id="9e65d-157">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="9e65d-158">W tych scenariuszach zamiast tego należy użyć oprogramowania pośredniczącego.</span><span class="sxs-lookup"><span data-stu-id="9e65d-158">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="9e65d-159">Wydajność oprogramowania pośredniczącego prawdopodobnie nie pasuje do wydajności modułów.</span><span class="sxs-lookup"><span data-stu-id="9e65d-159">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="9e65d-160">Analiza porównawcza jest jedynym sposobem, aby wiedzieć na pewno, które podejście obniża wydajność najbardziej lub jeśli obniżona wydajność jest znikoma.</span><span class="sxs-lookup"><span data-stu-id="9e65d-160">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="9e65d-161">Pakiet</span><span class="sxs-lookup"><span data-stu-id="9e65d-161">Package</span></span>

<span data-ttu-id="9e65d-162">Oprogramowanie pośredniczące do przepisywania adresów URL jest dostarczane przez pakiet [Microsoft.AspNetCore.Rewrite,](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) który jest niejawnie zawarty w aplikacjach ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="9e65d-162">URL Rewriting Middleware is provided by the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package, which is implicitly included in ASP.NET Core apps.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="9e65d-163">Rozszerzenie i opcje</span><span class="sxs-lookup"><span data-stu-id="9e65d-163">Extension and options</span></span>

<span data-ttu-id="9e65d-164">Uspokaj reguły przepisywania i przekierowywania adresów URL, tworząc wystąpienie klasy [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) z metodami rozszerzenia dla każdej reguły przepisywania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-164">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="9e65d-165">Łańcuch wielu reguł w kolejności, w której chcesz je przetworzyć.</span><span class="sxs-lookup"><span data-stu-id="9e65d-165">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="9e65d-166">Są `RewriteOptions` przekazywane do adresu URL przepisywanie oprogramowania pośredniczącego, <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>jak jest dodawany do potoku żądania z:</span><span class="sxs-lookup"><span data-stu-id="9e65d-166">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="9e65d-167">Przekieruj inne niż www na www</span><span class="sxs-lookup"><span data-stu-id="9e65d-167">Redirect non-www to www</span></span>

<span data-ttu-id="9e65d-168">Trzy opcje pozwalają aplikacji przekierować`www` `www`nie-żądania do:</span><span class="sxs-lookup"><span data-stu-id="9e65d-168">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="9e65d-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>&ndash; Trwale przekieruj żądanie do `www` poddomeny, jeśli żądanie nie jest-`www`.</span><span class="sxs-lookup"><span data-stu-id="9e65d-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="9e65d-170">Przekierowuje z kodem stanu [Status308PermanentRedirect.](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect)</span><span class="sxs-lookup"><span data-stu-id="9e65d-170">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="9e65d-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>&ndash; Przekieruj `www` żądanie do poddomeny,`www`jeśli żądanie przychodzące nie jest - .</span><span class="sxs-lookup"><span data-stu-id="9e65d-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="9e65d-172">Przekierowuje z kodem stanu [Status307TemporaryRedirect.](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect)</span><span class="sxs-lookup"><span data-stu-id="9e65d-172">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="9e65d-173">Przeciążenie umożliwia podanie kodu stanu odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="9e65d-173">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="9e65d-174">Użyj pola <xref:Microsoft.AspNetCore.Http.StatusCodes> klasy dla przypisania kodu stanu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-174">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="9e65d-175">Przekierowywanie adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-175">URL redirect</span></span>

<span data-ttu-id="9e65d-176">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> do przekierowywania żądań.</span><span class="sxs-lookup"><span data-stu-id="9e65d-176">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="9e65d-177">Pierwszy parametr zawiera wyrażenie regularne do dopasowywania na ścieżce przychodzącego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-177">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="9e65d-178">Drugi parametr to ciąg zastępczy.</span><span class="sxs-lookup"><span data-stu-id="9e65d-178">The second parameter is the replacement string.</span></span> <span data-ttu-id="9e65d-179">Trzeci parametr, jeśli jest obecny, określa kod stanu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-179">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="9e65d-180">Jeśli nie określisz kodu stanu, domyślnie kod stanu *302 - Znaleziono*, co oznacza, że zasób jest tymczasowo przeniesiony lub zastąpiony.</span><span class="sxs-lookup"><span data-stu-id="9e65d-180">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="9e65d-181">W przeglądarce z włączonymi narzędziami deweloperskimi złożyć `/redirect-rule/1234/5678`żądanie do przykładowej aplikacji ze ścieżką .</span><span class="sxs-lookup"><span data-stu-id="9e65d-181">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="9e65d-182">Wyrażenie regularne jest zgodne `redirect-rule/(.*)`ze ścieżką żądania, `/redirected/1234/5678`a ścieżka jest zastępowana .</span><span class="sxs-lookup"><span data-stu-id="9e65d-182">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="9e65d-183">Adres URL przekierowania jest wysyłany z powrotem do klienta z kodem stanu *302 — znaleziono.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-183">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="9e65d-184">Przeglądarka tworzy nowe żądanie pod adresem URL przekierowania, który pojawia się na pasku adresu przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="9e65d-184">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="9e65d-185">Ponieważ żadne reguły w przykładowej aplikacji nie są zgodne z adresem URL przekierowania:</span><span class="sxs-lookup"><span data-stu-id="9e65d-185">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="9e65d-186">Drugie żądanie otrzymuje *odpowiedź 200 — OK* z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-186">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="9e65d-187">Treść odpowiedzi pokazuje adres URL przekierowania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-187">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="9e65d-188">Po *przekierowaniu*adresu URL adres URL na serwer odbywa się podróż w obie strony.</span><span class="sxs-lookup"><span data-stu-id="9e65d-188">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="9e65d-189">Należy zachować ostrożność podczas ustanawiania reguł przekierowania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-189">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="9e65d-190">Reguły przekierowania są oceniane przy każdym żądaniu do aplikacji, w tym po przekierowaniu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-190">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="9e65d-191">Łatwo jest przypadkowo utworzyć *pętlę nieskończonych przekierowań*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-191">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="9e65d-192">Oryginalna prośba:`/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="9e65d-192">Original Request: `/redirect-rule/1234/5678`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="9e65d-194">Część wyrażenia zawarta w nawiasach jest nazywana *grupą przechwytywania*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-194">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="9e65d-195">Kropka (`.`) wyrażenia oznacza *dopasowanie dowolnego znaku*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-195">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="9e65d-196">Gwiazdka (`*`) oznacza *dopasowanie poprzedniego znaku zero lub więcej razy*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-196">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="9e65d-197">W związku z tym dwa ostatnie segmenty ścieżki adresu `1234/5678` `(.*)`URL, są przechwytywane przez grupę przechwytywania .</span><span class="sxs-lookup"><span data-stu-id="9e65d-197">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="9e65d-198">Każda wartość podana w `redirect-rule/` adresie URL żądania po jest przechwytywany przez tę pojedynczą grupę przechwytywania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-198">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="9e65d-199">W ciągu zastępczym przechwycone grupy są wtryskiwane`$`do ciągu ze znakiem dolara ( ), po którym następuje numer sekwencyjny przechwytywania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-199">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="9e65d-200">Pierwsza wartość grupy przechwytywania `$1`jest uzyskiwana za pomocą , drugi z `$2`, i są one kontynuowane w kolejności dla grup przechwytywania w wyrażeniach.</span><span class="sxs-lookup"><span data-stu-id="9e65d-200">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="9e65d-201">Istnieje tylko jedna przechwycona grupa w resecie przekierowania regex w przykładowej aplikacji, więc `$1`jest tylko jedna wstrzyknięta grupa w ciągu zastępczym, który jest .</span><span class="sxs-lookup"><span data-stu-id="9e65d-201">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="9e65d-202">Po zastosowaniu reguły adres `/redirected/1234/5678`URL staje się .</span><span class="sxs-lookup"><span data-stu-id="9e65d-202">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="9e65d-203">Przekierowanie adresu URL do bezpiecznego punktu końcowego</span><span class="sxs-lookup"><span data-stu-id="9e65d-203">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="9e65d-204">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> do przekierowywania żądań HTTP do tego samego hosta i ścieżki przy użyciu protokołu HTTPS.</span><span class="sxs-lookup"><span data-stu-id="9e65d-204">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="9e65d-205">Jeśli kod stanu nie jest podany, oprogramowanie pośredniczące domyślnie *302 - Znaleziono*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-205">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="9e65d-206">Jeśli port nie jest podany:</span><span class="sxs-lookup"><span data-stu-id="9e65d-206">If the port isn't supplied:</span></span>

* <span data-ttu-id="9e65d-207">Oprogramowanie pośredniczące `null`domyślnie ma wartość .</span><span class="sxs-lookup"><span data-stu-id="9e65d-207">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="9e65d-208">Schemat zmienia `https` się na (protokół HTTPS), a klient uzyskuje dostęp do zasobu na porcie 443.</span><span class="sxs-lookup"><span data-stu-id="9e65d-208">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="9e65d-209">W poniższym przykładzie pokazano, jak ustawić kod stanu na *301 — przeniesiony na stałe* i zmienić port na 5001.</span><span class="sxs-lookup"><span data-stu-id="9e65d-209">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="9e65d-210">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> do przekierowywania niezabezpieczonych żądań do tego samego hosta i ścieżki z bezpiecznym protokołem HTTPS na porcie 443.</span><span class="sxs-lookup"><span data-stu-id="9e65d-210">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="9e65d-211">Oprogramowanie pośredniczące ustawia kod stanu na *301 - Przeniesiony na stałe*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-211">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="9e65d-212">Podczas przekierowywania do bezpiecznego punktu końcowego bez wymogu dodatkowych reguł przekierowania, zaleca się użycie oprogramowania pośredniczącego przekierowania HTTPS.</span><span class="sxs-lookup"><span data-stu-id="9e65d-212">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="9e65d-213">Aby uzyskać więcej informacji, zobacz temat [Wymuszanie protokołu HTTPS.](xref:security/enforcing-ssl#require-https)</span><span class="sxs-lookup"><span data-stu-id="9e65d-213">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="9e65d-214">Przykładowa aplikacja jest w stanie `AddRedirectToHttps` wykazać, jak używać lub `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="9e65d-214">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="9e65d-215">Dodaj metodę rozszerzenia `RewriteOptions`do pliku .</span><span class="sxs-lookup"><span data-stu-id="9e65d-215">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="9e65d-216">Złożyć niezabezpieczone żądanie do aplikacji w dowolnym adresie URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-216">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="9e65d-217">Odrzuć ostrzeżenie zabezpieczeń przeglądarki, że certyfikat z podpisem własnym jest niezaufany lub utwórz wyjątek, aby ufać certyfikatowi.</span><span class="sxs-lookup"><span data-stu-id="9e65d-217">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="9e65d-218">Oryginalne żądanie `AddRedirectToHttps(301, 5001)`za pomocą:`http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="9e65d-218">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="9e65d-220">Oryginalne żądanie `AddRedirectToHttpsPermanent`za pomocą:`http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="9e65d-220">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="9e65d-222">Regenerowanie adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-222">URL rewrite</span></span>

<span data-ttu-id="9e65d-223">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> do tworzenia reguły przepisywania adresów URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-223">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="9e65d-224">Pierwszy parametr zawiera wyrażenie regularne do dopasowywania na przychodzącej ścieżce adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-224">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="9e65d-225">Drugi parametr to ciąg zastępczy.</span><span class="sxs-lookup"><span data-stu-id="9e65d-225">The second parameter is the replacement string.</span></span> <span data-ttu-id="9e65d-226">Trzeci parametr `skipRemainingRules: {true|false}`, wskazuje oprogramowaniu pośredniczącemu, czy pominąć dodatkowe reguły ponownego zapisu, jeśli stosowana jest bieżąca reguła.</span><span class="sxs-lookup"><span data-stu-id="9e65d-226">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="9e65d-227">Oryginalna prośba:`/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="9e65d-227">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądanie i odpowiedź](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="9e65d-229">Karat (`^`) na początku wyrażenia oznacza, że dopasowywanie rozpoczyna się na początku ścieżki adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-229">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="9e65d-230">We wcześniejszym przykładzie z `redirect-rule/(.*)`regułą przekierowania ,`^`nie ma karatów ( ) na początku wyrażenia regularnego.</span><span class="sxs-lookup"><span data-stu-id="9e65d-230">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="9e65d-231">W związku z tym `redirect-rule/` wszystkie znaki mogą poprzedzać w ścieżce dla pomyślnego dopasowania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-231">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="9e65d-232">Ścieżka</span><span class="sxs-lookup"><span data-stu-id="9e65d-232">Path</span></span>                               | <span data-ttu-id="9e65d-233">Dopasowanie</span><span class="sxs-lookup"><span data-stu-id="9e65d-233">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="9e65d-234">Tak</span><span class="sxs-lookup"><span data-stu-id="9e65d-234">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="9e65d-235">Tak</span><span class="sxs-lookup"><span data-stu-id="9e65d-235">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="9e65d-236">Tak</span><span class="sxs-lookup"><span data-stu-id="9e65d-236">Yes</span></span>   |

<span data-ttu-id="9e65d-237">Reguła przepisywania, `^rewrite-rule/(\d+)/(\d+)`, dopasowuje ścieżki `rewrite-rule/`tylko wtedy, gdy zaczynają się od .</span><span class="sxs-lookup"><span data-stu-id="9e65d-237">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="9e65d-238">W poniższej tabeli należy zwrócić uwagę na różnicę w dopasowywaniu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-238">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="9e65d-239">Ścieżka</span><span class="sxs-lookup"><span data-stu-id="9e65d-239">Path</span></span>                              | <span data-ttu-id="9e65d-240">Dopasowanie</span><span class="sxs-lookup"><span data-stu-id="9e65d-240">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="9e65d-241">Tak</span><span class="sxs-lookup"><span data-stu-id="9e65d-241">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="9e65d-242">Nie</span><span class="sxs-lookup"><span data-stu-id="9e65d-242">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="9e65d-243">Nie</span><span class="sxs-lookup"><span data-stu-id="9e65d-243">No</span></span>    |

<span data-ttu-id="9e65d-244">Po `^rewrite-rule/` części wyrażenia istnieją dwie grupy przechwytywania, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="9e65d-244">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="9e65d-245">Oznacza `\d` to *dopasowanie cyfry (liczby)*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-245">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="9e65d-246">Znak plus`+`( ) oznacza *dopasowanie jednego lub więcej z poprzedniego znaku*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-246">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="9e65d-247">W związku z tym adres URL musi zawierać liczbę, po której następuje ukośnik do przodu, po którym następuje inny numer.</span><span class="sxs-lookup"><span data-stu-id="9e65d-247">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="9e65d-248">Te grupy przechwytywania są wstrzykiwane `$1` do `$2`przepisanych adresów URL jako i .</span><span class="sxs-lookup"><span data-stu-id="9e65d-248">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="9e65d-249">Ciąg zastępowania reguły ponownego przepisywania umieszcza przechwycone grupy w ciągu zapytania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-249">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="9e65d-250">Żądana ścieżka `/rewrite-rule/1234/5678` jest przepisana w celu `/rewritten?var1=1234&var2=5678`uzyskania zasobu w pliku .</span><span class="sxs-lookup"><span data-stu-id="9e65d-250">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="9e65d-251">Jeśli ciąg zapytania jest obecny na oryginalnym żądaniu, jest zachowywany, gdy adres URL jest przepisany.</span><span class="sxs-lookup"><span data-stu-id="9e65d-251">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="9e65d-252">Nie ma żadnej podróży w obie strony do serwera, aby uzyskać zasób.</span><span class="sxs-lookup"><span data-stu-id="9e65d-252">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="9e65d-253">Jeśli zasób istnieje, jest pobierany i zwracany do klienta z kodem stanu *200 - OK.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-253">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="9e65d-254">Ponieważ klient nie jest przekierowywał, adres URL na pasku adresu przeglądarki nie zmienia się.</span><span class="sxs-lookup"><span data-stu-id="9e65d-254">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="9e65d-255">Klienci nie mogą wykryć, że na serwerze wystąpiła operacja ponownego zmiany adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-255">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="9e65d-256">Używaj, `skipRemainingRules: true` gdy jest to możliwe, ponieważ reguły dopasowywania są kosztowne pod względem obliczeniowym i wydłuża czas reakcji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-256">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="9e65d-257">Aby uzyskać najszybszą odpowiedź aplikacji:</span><span class="sxs-lookup"><span data-stu-id="9e65d-257">For the fastest app response:</span></span>
>
> * <span data-ttu-id="9e65d-258">Kolejność przepisywania reguł z najczęściej dopasowywane reguły do reguły najrzadziej dopasowane.</span><span class="sxs-lookup"><span data-stu-id="9e65d-258">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="9e65d-259">Pomiń przetwarzanie pozostałych reguł, gdy wystąpi dopasowanie i nie jest wymagane żadne dodatkowe przetwarzanie reguł.</span><span class="sxs-lookup"><span data-stu-id="9e65d-259">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="9e65d-260">mod_rewrite Apache</span><span class="sxs-lookup"><span data-stu-id="9e65d-260">Apache mod_rewrite</span></span>

<span data-ttu-id="9e65d-261">Zastosuj apache mod_rewrite reguły <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>z .</span><span class="sxs-lookup"><span data-stu-id="9e65d-261">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="9e65d-262">Upewnij się, że plik reguł jest wdrożony z aplikacją.</span><span class="sxs-lookup"><span data-stu-id="9e65d-262">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="9e65d-263">Aby uzyskać więcej informacji i przykłady reguł mod_rewrite, zobacz [mod_rewrite Apache](https://httpd.apache.org/docs/2.4/rewrite/).</span><span class="sxs-lookup"><span data-stu-id="9e65d-263">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="9e65d-264">A <xref:System.IO.StreamReader> służy do odczytywania reguł z pliku reguł *ApacheModRewrite.txt:*</span><span class="sxs-lookup"><span data-stu-id="9e65d-264">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="9e65d-265">Przykładowa aplikacja przekierowuje żądania z `/apache-mod-rules-redirect/(.\*)` . `/redirected?id=$1`</span><span class="sxs-lookup"><span data-stu-id="9e65d-265">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="9e65d-266">Kod stanu odpowiedzi to *302 - Znaleziono*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-266">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/3.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="9e65d-267">Oryginalna prośba:`/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="9e65d-267">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="9e65d-269">Oprogramowanie pośredniczące obsługuje następujące zmienne serwera mod_rewrite Apache:</span><span class="sxs-lookup"><span data-stu-id="9e65d-269">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="9e65d-270">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-270">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="9e65d-271">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="9e65d-271">HTTP_ACCEPT</span></span>
* <span data-ttu-id="9e65d-272">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="9e65d-272">HTTP_CONNECTION</span></span>
* <span data-ttu-id="9e65d-273">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="9e65d-273">HTTP_COOKIE</span></span>
* <span data-ttu-id="9e65d-274">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="9e65d-274">HTTP_FORWARDED</span></span>
* <span data-ttu-id="9e65d-275">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="9e65d-275">HTTP_HOST</span></span>
* <span data-ttu-id="9e65d-276">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="9e65d-276">HTTP_REFERER</span></span>
* <span data-ttu-id="9e65d-277">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="9e65d-277">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="9e65d-278">HTTPS</span><span class="sxs-lookup"><span data-stu-id="9e65d-278">HTTPS</span></span>
* <span data-ttu-id="9e65d-279">Protokół IPV6</span><span class="sxs-lookup"><span data-stu-id="9e65d-279">IPV6</span></span>
* <span data-ttu-id="9e65d-280">Query_string</span><span class="sxs-lookup"><span data-stu-id="9e65d-280">QUERY_STRING</span></span>
* <span data-ttu-id="9e65d-281">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-281">REMOTE_ADDR</span></span>
* <span data-ttu-id="9e65d-282">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="9e65d-282">REMOTE_PORT</span></span>
* <span data-ttu-id="9e65d-283">Request_filename</span><span class="sxs-lookup"><span data-stu-id="9e65d-283">REQUEST_FILENAME</span></span>
* <span data-ttu-id="9e65d-284">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="9e65d-284">REQUEST_METHOD</span></span>
* <span data-ttu-id="9e65d-285">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="9e65d-285">REQUEST_SCHEME</span></span>
* <span data-ttu-id="9e65d-286">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="9e65d-286">REQUEST_URI</span></span>
* <span data-ttu-id="9e65d-287">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="9e65d-287">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="9e65d-288">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-288">SERVER_ADDR</span></span>
* <span data-ttu-id="9e65d-289">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="9e65d-289">SERVER_PORT</span></span>
* <span data-ttu-id="9e65d-290">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="9e65d-290">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="9e65d-291">CZAS</span><span class="sxs-lookup"><span data-stu-id="9e65d-291">TIME</span></span>
* <span data-ttu-id="9e65d-292">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="9e65d-292">TIME_DAY</span></span>
* <span data-ttu-id="9e65d-293">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="9e65d-293">TIME_HOUR</span></span>
* <span data-ttu-id="9e65d-294">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="9e65d-294">TIME_MIN</span></span>
* <span data-ttu-id="9e65d-295">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="9e65d-295">TIME_MON</span></span>
* <span data-ttu-id="9e65d-296">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="9e65d-296">TIME_SEC</span></span>
* <span data-ttu-id="9e65d-297">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="9e65d-297">TIME_WDAY</span></span>
* <span data-ttu-id="9e65d-298">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="9e65d-298">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="9e65d-299">Reguły modułu przepisywania adresów URL w uirozmywanych adresach URL w uirozie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-299">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="9e65d-300">Aby użyć tego samego zestawu reguł, który ma zastosowanie do <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>modułu przepisywania adresu URL iIS, należy użyć programu .</span><span class="sxs-lookup"><span data-stu-id="9e65d-300">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="9e65d-301">Upewnij się, że plik reguł jest wdrożony z aplikacją.</span><span class="sxs-lookup"><span data-stu-id="9e65d-301">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="9e65d-302">Nie kieruj oprogramowania pośredniczącego do używania pliku *web.config* aplikacji podczas uruchamiania w systemie Windows Server IIS.</span><span class="sxs-lookup"><span data-stu-id="9e65d-302">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="9e65d-303">Dzięki usługom IIS te reguły powinny być przechowywane poza *plikiem web.config* aplikacji, aby uniknąć konfliktów z modułem Przepisywanie usług IIS.</span><span class="sxs-lookup"><span data-stu-id="9e65d-303">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="9e65d-304">Aby uzyskać więcej informacji i przykłady reguł modułu zapisywania adresów URL usług IIS, zobacz [Korzystanie z modułu 2.0 do przepisywania adresów URL](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) i odwołanie do konfiguracji [modułu ponownego zapisu adresu URL](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span><span class="sxs-lookup"><span data-stu-id="9e65d-304">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="9e65d-305">A <xref:System.IO.StreamReader> służy do odczytywania reguł z pliku reguł *IISUrlRewrite.xml:*</span><span class="sxs-lookup"><span data-stu-id="9e65d-305">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="9e65d-306">Przykładowa aplikacja przepisuje `/iis-rules-rewrite/(.*)` `/rewritten?id=$1`żądania z do .</span><span class="sxs-lookup"><span data-stu-id="9e65d-306">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="9e65d-307">Odpowiedź jest wysyłana do klienta z kodem stanu *200 - OK.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-307">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/3.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="9e65d-308">Oryginalna prośba:`/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="9e65d-308">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądanie i odpowiedź](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="9e65d-310">Jeśli masz aktywny moduł przepisywania usług IIS z skonfigurowaną regułą na poziomie serwera, która miałaby wpływ na aplikację w niepożądany sposób, możesz wyłączyć moduł przepisywania usług IIS dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-310">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="9e65d-311">Aby uzyskać więcej informacji, zobacz [Wyłączanie modułów IIS](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span><span class="sxs-lookup"><span data-stu-id="9e65d-311">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="9e65d-312">Nieobsługiwały się funkcje</span><span class="sxs-lookup"><span data-stu-id="9e65d-312">Unsupported features</span></span>

<span data-ttu-id="9e65d-313">Oprogramowanie pośredniczące wydane z ASP.NET Core 2.x nie obsługuje następujących funkcji modułu zapisywania adresów URL IIS:</span><span class="sxs-lookup"><span data-stu-id="9e65d-313">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="9e65d-314">Reguły ruchu wychodzącego</span><span class="sxs-lookup"><span data-stu-id="9e65d-314">Outbound Rules</span></span>
* <span data-ttu-id="9e65d-315">Niestandardowe zmienne serwera</span><span class="sxs-lookup"><span data-stu-id="9e65d-315">Custom Server Variables</span></span>
* <span data-ttu-id="9e65d-316">Symbole wieloznaczne</span><span class="sxs-lookup"><span data-stu-id="9e65d-316">Wildcards</span></span>
* <span data-ttu-id="9e65d-317">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="9e65d-317">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="9e65d-318">Obsługiwane zmienne serwera</span><span class="sxs-lookup"><span data-stu-id="9e65d-318">Supported server variables</span></span>

<span data-ttu-id="9e65d-319">Oprogramowanie pośredniczące obsługuje następujące zmienne serwera serwera iis url rewrite module:</span><span class="sxs-lookup"><span data-stu-id="9e65d-319">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="9e65d-320">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="9e65d-320">CONTENT_LENGTH</span></span>
* <span data-ttu-id="9e65d-321">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="9e65d-321">CONTENT_TYPE</span></span>
* <span data-ttu-id="9e65d-322">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="9e65d-322">HTTP_ACCEPT</span></span>
* <span data-ttu-id="9e65d-323">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="9e65d-323">HTTP_CONNECTION</span></span>
* <span data-ttu-id="9e65d-324">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="9e65d-324">HTTP_COOKIE</span></span>
* <span data-ttu-id="9e65d-325">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="9e65d-325">HTTP_HOST</span></span>
* <span data-ttu-id="9e65d-326">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="9e65d-326">HTTP_REFERER</span></span>
* <span data-ttu-id="9e65d-327">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-327">HTTP_URL</span></span>
* <span data-ttu-id="9e65d-328">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="9e65d-328">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="9e65d-329">HTTPS</span><span class="sxs-lookup"><span data-stu-id="9e65d-329">HTTPS</span></span>
* <span data-ttu-id="9e65d-330">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-330">LOCAL_ADDR</span></span>
* <span data-ttu-id="9e65d-331">Query_string</span><span class="sxs-lookup"><span data-stu-id="9e65d-331">QUERY_STRING</span></span>
* <span data-ttu-id="9e65d-332">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-332">REMOTE_ADDR</span></span>
* <span data-ttu-id="9e65d-333">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="9e65d-333">REMOTE_PORT</span></span>
* <span data-ttu-id="9e65d-334">Request_filename</span><span class="sxs-lookup"><span data-stu-id="9e65d-334">REQUEST_FILENAME</span></span>
* <span data-ttu-id="9e65d-335">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="9e65d-335">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="9e65d-336">Można również uzyskać <xref:Microsoft.Extensions.FileProviders.IFileProvider> za <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>pośrednictwem .</span><span class="sxs-lookup"><span data-stu-id="9e65d-336">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="9e65d-337">Takie podejście może zapewnić większą elastyczność lokalizacji plików reguł ponownego zapisu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-337">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="9e65d-338">Upewnij się, że pliki reguł ponownego zapisu są wdrażane na serwerze w ścieżce, którą podasz.</span><span class="sxs-lookup"><span data-stu-id="9e65d-338">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="9e65d-339">Reguła oparta na metodzie</span><span class="sxs-lookup"><span data-stu-id="9e65d-339">Method-based rule</span></span>

<span data-ttu-id="9e65d-340">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> do implementowania własnej logiki reguły w metodzie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-340">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="9e65d-341">`Add`udostępnia <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, który udostępnia <xref:Microsoft.AspNetCore.Http.HttpContext> do wykorzystania w metodzie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-341">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="9e65d-342">[RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) określa sposób obsługi dodatkowego przetwarzania potoku.</span><span class="sxs-lookup"><span data-stu-id="9e65d-342">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="9e65d-343">Ustaw wartość jednego z <xref:Microsoft.AspNetCore.Rewrite.RuleResult> pól opisanych w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="9e65d-343">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| `RewriteContext.Result`              | <span data-ttu-id="9e65d-344">Akcja</span><span class="sxs-lookup"><span data-stu-id="9e65d-344">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="9e65d-345">`RuleResult.ContinueRules`(domyślnie)</span><span class="sxs-lookup"><span data-stu-id="9e65d-345">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="9e65d-346">Kontynuuj stosowanie reguł.</span><span class="sxs-lookup"><span data-stu-id="9e65d-346">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="9e65d-347">Przestań stosować reguły i wyślij odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="9e65d-347">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="9e65d-348">Przestań stosować reguły i wyślij kontekst do następnego oprogramowania pośredniczącego.</span><span class="sxs-lookup"><span data-stu-id="9e65d-348">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="9e65d-349">Przykładowa aplikacja pokazuje metodę, która przekierowuje żądania ścieżek, które kończą się na *.xml*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-349">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="9e65d-350">Jeśli zostanie złożony `/file.xml`wniosek, żądanie zostanie `/xmlfiles/file.xml`przekierowane do .</span><span class="sxs-lookup"><span data-stu-id="9e65d-350">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="9e65d-351">Kod stanu jest ustawiony na *301 - Przeniesiony na stałe*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-351">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="9e65d-352">Gdy przeglądarka wysunie nowe żądanie dla */xmlfiles/file.xml*, Oprogramowanie pośredniczące plików statycznych służy do klienta z folderu *wwwroot/xmlfiles.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-352">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="9e65d-353">W przypadku przekierowania jawnie ustaw kod stanu odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="9e65d-353">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="9e65d-354">W przeciwnym razie zwracany jest kod stanu *200 - OK,* a przekierowanie nie występuje na kliencie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-354">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="9e65d-355">*RewriteRules.cs:*</span><span class="sxs-lookup"><span data-stu-id="9e65d-355">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="9e65d-356">Takie podejście można również przepisać żądania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-356">This approach can also rewrite requests.</span></span> <span data-ttu-id="9e65d-357">Przykładowa aplikacja demonstruje przepisywanie ścieżki dla dowolnego żądania pliku tekstowego do obsługi pliku tekstowego *file.txt* z folderu *wwwroot.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-357">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="9e65d-358">Oprogramowanie pośredniczące plików statycznych obsługuje plik na podstawie zaktualizowanej ścieżki żądania:</span><span class="sxs-lookup"><span data-stu-id="9e65d-358">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="9e65d-359">*RewriteRules.cs:*</span><span class="sxs-lookup"><span data-stu-id="9e65d-359">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="9e65d-360">Reguła oparta na zasadach irule</span><span class="sxs-lookup"><span data-stu-id="9e65d-360">IRule-based rule</span></span>

<span data-ttu-id="9e65d-361">Użyj <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> logiki reguły w klasie, <xref:Microsoft.AspNetCore.Rewrite.IRule> która implementuje interfejs.</span><span class="sxs-lookup"><span data-stu-id="9e65d-361">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="9e65d-362">`IRule`zapewnia większą elastyczność w stosowania metody opartej na metodzie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-362">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="9e65d-363">Klasa implementacji może zawierać konstruktora, który <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> umożliwia przekazywanie parametrów dla metody.</span><span class="sxs-lookup"><span data-stu-id="9e65d-363">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="9e65d-364">Wartości parametrów w przykładowej aplikacji `extension` dla `newPath` i są sprawdzane, aby spełnić kilka warunków.</span><span class="sxs-lookup"><span data-stu-id="9e65d-364">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="9e65d-365">Musi `extension` zawierać wartość, a wartość musi być *.png*, *.jpg*lub *gif*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-365">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="9e65d-366">Jeśli `newPath` nie jest prawidłowy, jest wyrzucany. <xref:System.ArgumentException></span><span class="sxs-lookup"><span data-stu-id="9e65d-366">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="9e65d-367">Jeśli zostanie złożony wniosek o *image.png,* żądanie `/png-images/image.png`zostanie przekierowane do .</span><span class="sxs-lookup"><span data-stu-id="9e65d-367">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="9e65d-368">Jeśli zostanie złożony wniosek o *image.jpg*, `/jpg-images/image.jpg`żądanie zostanie przekierowane do .</span><span class="sxs-lookup"><span data-stu-id="9e65d-368">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="9e65d-369">Kod stanu jest ustawiony na *301 -* `context.Result` Przeniesiony na stałe , a jest ustawiony, aby zatrzymać reguły przetwarzania i wysłać odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="9e65d-369">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="9e65d-370">Oryginalna prośba:`/image.png`</span><span class="sxs-lookup"><span data-stu-id="9e65d-370">Original Request: `/image.png`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi dla pliku image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="9e65d-372">Oryginalna prośba:`/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="9e65d-372">Original Request: `/image.jpg`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi dla pliku image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="9e65d-374">Przykłady regex</span><span class="sxs-lookup"><span data-stu-id="9e65d-374">Regex examples</span></span>

| <span data-ttu-id="9e65d-375">Cel</span><span class="sxs-lookup"><span data-stu-id="9e65d-375">Goal</span></span> | <span data-ttu-id="9e65d-376">& ciągu regex</span><span class="sxs-lookup"><span data-stu-id="9e65d-376">Regex String &</span></span><br><span data-ttu-id="9e65d-377">Przykład dopasowania</span><span class="sxs-lookup"><span data-stu-id="9e65d-377">Match Example</span></span> | <span data-ttu-id="9e65d-378">& ciągu zastępczego</span><span class="sxs-lookup"><span data-stu-id="9e65d-378">Replacement String &</span></span><br><span data-ttu-id="9e65d-379">Przykład wyjścia</span><span class="sxs-lookup"><span data-stu-id="9e65d-379">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="9e65d-380">Przepisanie ścieżki do sznurka zapytania</span><span class="sxs-lookup"><span data-stu-id="9e65d-380">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="9e65d-381">Ukośnik na końcu taśmy</span><span class="sxs-lookup"><span data-stu-id="9e65d-381">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="9e65d-382">Wymuszanie końcowego ukośnika</span><span class="sxs-lookup"><span data-stu-id="9e65d-382">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="9e65d-383">Unikaj przepisywania określonych żądań</span><span class="sxs-lookup"><span data-stu-id="9e65d-383">Avoid rewriting specific requests</span></span> | <span data-ttu-id="9e65d-384">`^(.*)(?<!\.axd)$` lub `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="9e65d-384">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="9e65d-385">Tak:`/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="9e65d-385">Yes: `/resource.htm`</span></span><br><span data-ttu-id="9e65d-386">№:`/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="9e65d-386">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="9e65d-387">Zmienianie rozmieszczenia segmentów adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-387">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="9e65d-388">Zastępowanie segmentu adresu URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-388">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="9e65d-389">W tym dokumencie wprowadzono przepisywanie adresów URL z instrukcjami dotyczącymi używania oprogramowania pośredniczącego do przepisywania adresów URL w aplikacjach ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="9e65d-389">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="9e65d-390">Przepisywanie adresów URL to czynność modyfikowania adresów URL żądań na podstawie co najmniej jednej wstępnie zdefiniowanej reguły.</span><span class="sxs-lookup"><span data-stu-id="9e65d-390">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="9e65d-391">Przepisywanie adresów URL tworzy abstrakcję między lokalizacjami zasobów a ich adresami, dzięki czemu lokalizacje i adresy nie są ściśle powiązane.</span><span class="sxs-lookup"><span data-stu-id="9e65d-391">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="9e65d-392">Przepisywanie adresów URL jest cenne w kilku scenariuszach, aby:</span><span class="sxs-lookup"><span data-stu-id="9e65d-392">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="9e65d-393">Przenieś lub zastąp zasoby serwera tymczasowo lub na stałe i zachowaj stabilne lokalizatory dla tych zasobów.</span><span class="sxs-lookup"><span data-stu-id="9e65d-393">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="9e65d-394">Przetwarzanie żądań podzielonych na różne aplikacje lub w różnych obszarach jednej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-394">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="9e65d-395">Usuwanie, dodawanie lub reorganizowanie segmentów adresów URL w żądaniach przychodzących.</span><span class="sxs-lookup"><span data-stu-id="9e65d-395">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="9e65d-396">Optymalizacja publicznych adresów URL pod kątem optymalizacji pod kątem wyszukiwarek (SEO).</span><span class="sxs-lookup"><span data-stu-id="9e65d-396">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="9e65d-397">Zezwalaj na używanie przyjaznych publicznych adresów URL, aby ułatwić odwiedzającym przewidywanie zwracanej zawartości przez żądanie zasobu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-397">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="9e65d-398">Przekieruj niezabezpieczone żądania do bezpiecznych punktów końcowych.</span><span class="sxs-lookup"><span data-stu-id="9e65d-398">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="9e65d-399">Zapobiegaj hotlinkingowi, gdy witryna zewnętrzna używa hostowanego zasobu statycznego w innej witrynie, łącząc go z własną zawartością.</span><span class="sxs-lookup"><span data-stu-id="9e65d-399">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="9e65d-400">Przepisywanie adresów URL może zmniejszyć wydajność aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-400">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="9e65d-401">Tam, gdzie jest to możliwe, ogranicz liczbę i złożoność przepisów.</span><span class="sxs-lookup"><span data-stu-id="9e65d-401">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="9e65d-402">[Wyświetl lub pobierz przykładowy kod](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([jak pobrać](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="9e65d-402">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="9e65d-403">Przekierowanie adresu URL i przepisanie adresu URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-403">URL redirect and URL rewrite</span></span>

<span data-ttu-id="9e65d-404">Różnica w sformułowaniu między *przekierowaniem adresu URL* a *przepisaniem adresu URL jest subtelna,* ale ma istotne implikacje dla dostarczania zasobów klientom.</span><span class="sxs-lookup"><span data-stu-id="9e65d-404">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="9e65d-405">ASP.NET Core url przepisywanie oprogramowania pośredniczącego jest w stanie zasypać potrzebę obu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-405">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="9e65d-406">*Przekierowanie adresu URL* obejmuje operację po stronie klienta, gdzie klient jest poinstruowany, aby uzyskać dostęp do zasobu pod innym adresem niż klient pierwotnie żądany.</span><span class="sxs-lookup"><span data-stu-id="9e65d-406">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="9e65d-407">Wymaga to podróży w obie strony do serwera.</span><span class="sxs-lookup"><span data-stu-id="9e65d-407">This requires a round trip to the server.</span></span> <span data-ttu-id="9e65d-408">Adres URL przekierowania zwrócony do klienta pojawia się na pasku adresu przeglądarki, gdy klient wysunie nowe żądanie dla zasobu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-408">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="9e65d-409">Jeśli `/resource` zostanie *przekierowany* do `/different-resource`programu, serwer odpowiada, że `/different-resource` klient powinien uzyskać zasób z kodem stanu wskazującym, że przekierowanie jest tymczasowe lub stałe.</span><span class="sxs-lookup"><span data-stu-id="9e65d-409">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Punkt końcowy usługi WebAPI został tymczasowo zmieniony z wersji 1 (wersja 1) na wersję 2 (wersja 2) na serwerze.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="9e65d-415">Podczas przekierowywania żądań do innego adresu URL, należy wskazać, czy przekierowanie jest stałe czy tymczasowe, określając kod stanu z odpowiedzią:</span><span class="sxs-lookup"><span data-stu-id="9e65d-415">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="9e65d-416">*301 - Przeniesiony kod* stanu trwale jest używany, gdy zasób ma nowy, stały adres URL i chcesz poinstruować klienta, że wszystkie przyszłe żądania dla zasobu powinny używać nowego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-416">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="9e65d-417">*Klient może buforować i ponownie używać odpowiedzi po odebraniu kodu stanu 301.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-417">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="9e65d-418">Kod stanu *302 - Znaleziono* jest używany, gdy przekierowanie jest tymczasowe lub zazwyczaj może ulec zmianie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-418">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="9e65d-419">Kod stanu 302 oznacza, że klient nie przechowuje adresu URL i nie używa go w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="9e65d-419">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="9e65d-420">Aby uzyskać więcej informacji na temat kodów stanu, zobacz [RFC 2616: Definicje kodu stanu](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span><span class="sxs-lookup"><span data-stu-id="9e65d-420">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="9e65d-421">*Przepisanie adresu URL* jest operacją po stronie serwera, która zapewnia zasób z adresu innego zasobu niż żądany klient.</span><span class="sxs-lookup"><span data-stu-id="9e65d-421">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="9e65d-422">Przepisywanie adresu URL nie wymaga podróży w obie strony do serwera.</span><span class="sxs-lookup"><span data-stu-id="9e65d-422">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="9e65d-423">Przepisany adres URL nie jest zwracany do klienta i nie jest wyświetlany na pasku adresu przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="9e65d-423">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="9e65d-424">Jeśli `/resource` jest *przepisany* do `/different-resource`, serwer *wewnętrznie* pobiera i `/different-resource`zwraca zasób w .</span><span class="sxs-lookup"><span data-stu-id="9e65d-424">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="9e65d-425">Mimo że klient może być w stanie pobrać zasób przy przepisanych adresów URL, klient nie jest informowany, że zasób istnieje w przepisany adres URL, gdy sprawia, że jego żądanie i odbiera odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="9e65d-425">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Punkt końcowy usługi WebAPI został zmieniony z wersji 1 (wersja 1) na wersję 2 (wersja 2) na serwerze.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="9e65d-430">Przykładowa aplikacja do przepisywania adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-430">URL rewriting sample app</span></span>

<span data-ttu-id="9e65d-431">Za pomocą [przykładowej aplikacji](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/)można zapoznać się z funkcjami oprogramowania pośredniczącego przepisywania adresów URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-431">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="9e65d-432">Aplikacja stosuje reguły przekierowania i przepisywania i pokazuje przekierowany lub przepisany adres URL dla kilku scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="9e65d-432">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="9e65d-433">Kiedy używać oprogramowania pośredniczącego do przepisywania adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-433">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="9e65d-434">Oprogramowanie pośredniczące do przepisywania adresów URL używa się następujących metod:</span><span class="sxs-lookup"><span data-stu-id="9e65d-434">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="9e65d-435">Moduł przepisywania adresów URL z usługami IIS w systemie Windows Server</span><span class="sxs-lookup"><span data-stu-id="9e65d-435">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="9e65d-436">Moduł mod_rewrite Apache na serwerze Apache</span><span class="sxs-lookup"><span data-stu-id="9e65d-436">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="9e65d-437">Przepisywanie adresów URL w Nginx</span><span class="sxs-lookup"><span data-stu-id="9e65d-437">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="9e65d-438">Ponadto należy użyć oprogramowania pośredniczącego, gdy aplikacja jest hostowana na [serwerze HTTP.sys](xref:fundamentals/servers/httpsys) (dawniej nazywanym WebListener).</span><span class="sxs-lookup"><span data-stu-id="9e65d-438">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="9e65d-439">Główne powody, dla których warto używać opartych na serwerze technologii przepisywania adresów URL w usługach IIS, Apache i Nginx to:</span><span class="sxs-lookup"><span data-stu-id="9e65d-439">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="9e65d-440">Oprogramowanie pośredniczące nie obsługuje pełnych funkcji tych modułów.</span><span class="sxs-lookup"><span data-stu-id="9e65d-440">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="9e65d-441">Niektóre funkcje modułów serwera nie działają z ASP.NET projektów podstawowych, `IsFile` takich `IsDirectory` jak i ograniczenia modułu IIS Rewrite.</span><span class="sxs-lookup"><span data-stu-id="9e65d-441">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="9e65d-442">W tych scenariuszach zamiast tego należy użyć oprogramowania pośredniczącego.</span><span class="sxs-lookup"><span data-stu-id="9e65d-442">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="9e65d-443">Wydajność oprogramowania pośredniczącego prawdopodobnie nie pasuje do wydajności modułów.</span><span class="sxs-lookup"><span data-stu-id="9e65d-443">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="9e65d-444">Analiza porównawcza jest jedynym sposobem, aby wiedzieć na pewno, które podejście obniża wydajność najbardziej lub jeśli obniżona wydajność jest znikoma.</span><span class="sxs-lookup"><span data-stu-id="9e65d-444">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="9e65d-445">Pakiet</span><span class="sxs-lookup"><span data-stu-id="9e65d-445">Package</span></span>

<span data-ttu-id="9e65d-446">Aby uwzględnić oprogramowanie pośredniczące w projekcie, dodaj odwołanie do pakietu [Microsoft.AspNetCore.App metapakiet](xref:fundamentals/metapackage-app) w pliku projektu, który zawiera pakiet [Microsoft.AspNetCore.Rewrite.](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite)</span><span class="sxs-lookup"><span data-stu-id="9e65d-446">To include the middleware in your project, add a package reference to the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the project file, which contains the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package.</span></span>

<span data-ttu-id="9e65d-447">Jeśli nie `Microsoft.AspNetCore.App` jest używany metapackage, dodaj `Microsoft.AspNetCore.Rewrite` odwołanie do projektu do pakietu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-447">When not using the `Microsoft.AspNetCore.App` metapackage, add a project reference to the `Microsoft.AspNetCore.Rewrite` package.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="9e65d-448">Rozszerzenie i opcje</span><span class="sxs-lookup"><span data-stu-id="9e65d-448">Extension and options</span></span>

<span data-ttu-id="9e65d-449">Uspokaj reguły przepisywania i przekierowywania adresów URL, tworząc wystąpienie klasy [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) z metodami rozszerzenia dla każdej reguły przepisywania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-449">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="9e65d-450">Łańcuch wielu reguł w kolejności, w której chcesz je przetworzyć.</span><span class="sxs-lookup"><span data-stu-id="9e65d-450">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="9e65d-451">Są `RewriteOptions` przekazywane do adresu URL przepisywanie oprogramowania pośredniczącego, <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>jak jest dodawany do potoku żądania z:</span><span class="sxs-lookup"><span data-stu-id="9e65d-451">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="9e65d-452">Przekieruj inne niż www na www</span><span class="sxs-lookup"><span data-stu-id="9e65d-452">Redirect non-www to www</span></span>

<span data-ttu-id="9e65d-453">Trzy opcje pozwalają aplikacji przekierować`www` `www`nie-żądania do:</span><span class="sxs-lookup"><span data-stu-id="9e65d-453">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="9e65d-454"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>&ndash; Trwale przekieruj żądanie do `www` poddomeny, jeśli żądanie nie jest-`www`.</span><span class="sxs-lookup"><span data-stu-id="9e65d-454"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="9e65d-455">Przekierowuje z kodem stanu [Status308PermanentRedirect.](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect)</span><span class="sxs-lookup"><span data-stu-id="9e65d-455">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="9e65d-456"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>&ndash; Przekieruj `www` żądanie do poddomeny,`www`jeśli żądanie przychodzące nie jest - .</span><span class="sxs-lookup"><span data-stu-id="9e65d-456"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="9e65d-457">Przekierowuje z kodem stanu [Status307TemporaryRedirect.](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect)</span><span class="sxs-lookup"><span data-stu-id="9e65d-457">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="9e65d-458">Przeciążenie umożliwia podanie kodu stanu odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="9e65d-458">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="9e65d-459">Użyj pola <xref:Microsoft.AspNetCore.Http.StatusCodes> klasy dla przypisania kodu stanu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-459">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="9e65d-460">Przekierowywanie adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-460">URL redirect</span></span>

<span data-ttu-id="9e65d-461">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> do przekierowywania żądań.</span><span class="sxs-lookup"><span data-stu-id="9e65d-461">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="9e65d-462">Pierwszy parametr zawiera wyrażenie regularne do dopasowywania na ścieżce przychodzącego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-462">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="9e65d-463">Drugi parametr to ciąg zastępczy.</span><span class="sxs-lookup"><span data-stu-id="9e65d-463">The second parameter is the replacement string.</span></span> <span data-ttu-id="9e65d-464">Trzeci parametr, jeśli jest obecny, określa kod stanu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-464">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="9e65d-465">Jeśli nie określisz kodu stanu, domyślnie kod stanu *302 - Znaleziono*, co oznacza, że zasób jest tymczasowo przeniesiony lub zastąpiony.</span><span class="sxs-lookup"><span data-stu-id="9e65d-465">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="9e65d-466">W przeglądarce z włączonymi narzędziami deweloperskimi złożyć `/redirect-rule/1234/5678`żądanie do przykładowej aplikacji ze ścieżką .</span><span class="sxs-lookup"><span data-stu-id="9e65d-466">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="9e65d-467">Wyrażenie regularne jest zgodne `redirect-rule/(.*)`ze ścieżką żądania, `/redirected/1234/5678`a ścieżka jest zastępowana .</span><span class="sxs-lookup"><span data-stu-id="9e65d-467">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="9e65d-468">Adres URL przekierowania jest wysyłany z powrotem do klienta z kodem stanu *302 — znaleziono.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-468">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="9e65d-469">Przeglądarka tworzy nowe żądanie pod adresem URL przekierowania, który pojawia się na pasku adresu przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="9e65d-469">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="9e65d-470">Ponieważ żadne reguły w przykładowej aplikacji nie są zgodne z adresem URL przekierowania:</span><span class="sxs-lookup"><span data-stu-id="9e65d-470">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="9e65d-471">Drugie żądanie otrzymuje *odpowiedź 200 — OK* z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-471">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="9e65d-472">Treść odpowiedzi pokazuje adres URL przekierowania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-472">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="9e65d-473">Po *przekierowaniu*adresu URL adres URL na serwer odbywa się podróż w obie strony.</span><span class="sxs-lookup"><span data-stu-id="9e65d-473">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="9e65d-474">Należy zachować ostrożność podczas ustanawiania reguł przekierowania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-474">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="9e65d-475">Reguły przekierowania są oceniane przy każdym żądaniu do aplikacji, w tym po przekierowaniu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-475">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="9e65d-476">Łatwo jest przypadkowo utworzyć *pętlę nieskończonych przekierowań*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-476">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="9e65d-477">Oryginalna prośba:`/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="9e65d-477">Original Request: `/redirect-rule/1234/5678`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="9e65d-479">Część wyrażenia zawarta w nawiasach jest nazywana *grupą przechwytywania*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-479">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="9e65d-480">Kropka (`.`) wyrażenia oznacza *dopasowanie dowolnego znaku*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-480">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="9e65d-481">Gwiazdka (`*`) oznacza *dopasowanie poprzedniego znaku zero lub więcej razy*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-481">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="9e65d-482">W związku z tym dwa ostatnie segmenty ścieżki adresu `1234/5678` `(.*)`URL, są przechwytywane przez grupę przechwytywania .</span><span class="sxs-lookup"><span data-stu-id="9e65d-482">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="9e65d-483">Każda wartość podana w `redirect-rule/` adresie URL żądania po jest przechwytywany przez tę pojedynczą grupę przechwytywania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-483">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="9e65d-484">W ciągu zastępczym przechwycone grupy są wtryskiwane`$`do ciągu ze znakiem dolara ( ), po którym następuje numer sekwencyjny przechwytywania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-484">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="9e65d-485">Pierwsza wartość grupy przechwytywania `$1`jest uzyskiwana za pomocą , drugi z `$2`, i są one kontynuowane w kolejności dla grup przechwytywania w wyrażeniach.</span><span class="sxs-lookup"><span data-stu-id="9e65d-485">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="9e65d-486">Istnieje tylko jedna przechwycona grupa w resecie przekierowania regex w przykładowej aplikacji, więc `$1`jest tylko jedna wstrzyknięta grupa w ciągu zastępczym, który jest .</span><span class="sxs-lookup"><span data-stu-id="9e65d-486">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="9e65d-487">Po zastosowaniu reguły adres `/redirected/1234/5678`URL staje się .</span><span class="sxs-lookup"><span data-stu-id="9e65d-487">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="9e65d-488">Przekierowanie adresu URL do bezpiecznego punktu końcowego</span><span class="sxs-lookup"><span data-stu-id="9e65d-488">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="9e65d-489">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> do przekierowywania żądań HTTP do tego samego hosta i ścieżki przy użyciu protokołu HTTPS.</span><span class="sxs-lookup"><span data-stu-id="9e65d-489">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="9e65d-490">Jeśli kod stanu nie jest podany, oprogramowanie pośredniczące domyślnie *302 - Znaleziono*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-490">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="9e65d-491">Jeśli port nie jest podany:</span><span class="sxs-lookup"><span data-stu-id="9e65d-491">If the port isn't supplied:</span></span>

* <span data-ttu-id="9e65d-492">Oprogramowanie pośredniczące `null`domyślnie ma wartość .</span><span class="sxs-lookup"><span data-stu-id="9e65d-492">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="9e65d-493">Schemat zmienia `https` się na (protokół HTTPS), a klient uzyskuje dostęp do zasobu na porcie 443.</span><span class="sxs-lookup"><span data-stu-id="9e65d-493">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="9e65d-494">W poniższym przykładzie pokazano, jak ustawić kod stanu na *301 — przeniesiony na stałe* i zmienić port na 5001.</span><span class="sxs-lookup"><span data-stu-id="9e65d-494">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="9e65d-495">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> do przekierowywania niezabezpieczonych żądań do tego samego hosta i ścieżki z bezpiecznym protokołem HTTPS na porcie 443.</span><span class="sxs-lookup"><span data-stu-id="9e65d-495">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="9e65d-496">Oprogramowanie pośredniczące ustawia kod stanu na *301 - Przeniesiony na stałe*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-496">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="9e65d-497">Podczas przekierowywania do bezpiecznego punktu końcowego bez wymogu dodatkowych reguł przekierowania, zaleca się użycie oprogramowania pośredniczącego przekierowania HTTPS.</span><span class="sxs-lookup"><span data-stu-id="9e65d-497">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="9e65d-498">Aby uzyskać więcej informacji, zobacz temat [Wymuszanie protokołu HTTPS.](xref:security/enforcing-ssl#require-https)</span><span class="sxs-lookup"><span data-stu-id="9e65d-498">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="9e65d-499">Przykładowa aplikacja jest w stanie `AddRedirectToHttps` wykazać, jak używać lub `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="9e65d-499">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="9e65d-500">Dodaj metodę rozszerzenia `RewriteOptions`do pliku .</span><span class="sxs-lookup"><span data-stu-id="9e65d-500">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="9e65d-501">Złożyć niezabezpieczone żądanie do aplikacji w dowolnym adresie URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-501">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="9e65d-502">Odrzuć ostrzeżenie zabezpieczeń przeglądarki, że certyfikat z podpisem własnym jest niezaufany lub utwórz wyjątek, aby ufać certyfikatowi.</span><span class="sxs-lookup"><span data-stu-id="9e65d-502">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="9e65d-503">Oryginalne żądanie `AddRedirectToHttps(301, 5001)`za pomocą:`http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="9e65d-503">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="9e65d-505">Oryginalne żądanie `AddRedirectToHttpsPermanent`za pomocą:`http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="9e65d-505">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="9e65d-507">Regenerowanie adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-507">URL rewrite</span></span>

<span data-ttu-id="9e65d-508">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> do tworzenia reguły przepisywania adresów URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-508">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="9e65d-509">Pierwszy parametr zawiera wyrażenie regularne do dopasowywania na przychodzącej ścieżce adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-509">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="9e65d-510">Drugi parametr to ciąg zastępczy.</span><span class="sxs-lookup"><span data-stu-id="9e65d-510">The second parameter is the replacement string.</span></span> <span data-ttu-id="9e65d-511">Trzeci parametr `skipRemainingRules: {true|false}`, wskazuje oprogramowaniu pośredniczącemu, czy pominąć dodatkowe reguły ponownego zapisu, jeśli stosowana jest bieżąca reguła.</span><span class="sxs-lookup"><span data-stu-id="9e65d-511">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="9e65d-512">Oryginalna prośba:`/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="9e65d-512">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądanie i odpowiedź](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="9e65d-514">Karat (`^`) na początku wyrażenia oznacza, że dopasowywanie rozpoczyna się na początku ścieżki adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-514">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="9e65d-515">We wcześniejszym przykładzie z `redirect-rule/(.*)`regułą przekierowania ,`^`nie ma karatów ( ) na początku wyrażenia regularnego.</span><span class="sxs-lookup"><span data-stu-id="9e65d-515">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="9e65d-516">W związku z tym `redirect-rule/` wszystkie znaki mogą poprzedzać w ścieżce dla pomyślnego dopasowania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-516">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="9e65d-517">Ścieżka</span><span class="sxs-lookup"><span data-stu-id="9e65d-517">Path</span></span>                               | <span data-ttu-id="9e65d-518">Dopasowanie</span><span class="sxs-lookup"><span data-stu-id="9e65d-518">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="9e65d-519">Tak</span><span class="sxs-lookup"><span data-stu-id="9e65d-519">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="9e65d-520">Tak</span><span class="sxs-lookup"><span data-stu-id="9e65d-520">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="9e65d-521">Tak</span><span class="sxs-lookup"><span data-stu-id="9e65d-521">Yes</span></span>   |

<span data-ttu-id="9e65d-522">Reguła przepisywania, `^rewrite-rule/(\d+)/(\d+)`, dopasowuje ścieżki `rewrite-rule/`tylko wtedy, gdy zaczynają się od .</span><span class="sxs-lookup"><span data-stu-id="9e65d-522">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="9e65d-523">W poniższej tabeli należy zwrócić uwagę na różnicę w dopasowywaniu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-523">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="9e65d-524">Ścieżka</span><span class="sxs-lookup"><span data-stu-id="9e65d-524">Path</span></span>                              | <span data-ttu-id="9e65d-525">Dopasowanie</span><span class="sxs-lookup"><span data-stu-id="9e65d-525">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="9e65d-526">Tak</span><span class="sxs-lookup"><span data-stu-id="9e65d-526">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="9e65d-527">Nie</span><span class="sxs-lookup"><span data-stu-id="9e65d-527">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="9e65d-528">Nie</span><span class="sxs-lookup"><span data-stu-id="9e65d-528">No</span></span>    |

<span data-ttu-id="9e65d-529">Po `^rewrite-rule/` części wyrażenia istnieją dwie grupy przechwytywania, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="9e65d-529">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="9e65d-530">Oznacza `\d` to *dopasowanie cyfry (liczby)*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-530">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="9e65d-531">Znak plus`+`( ) oznacza *dopasowanie jednego lub więcej z poprzedniego znaku*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-531">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="9e65d-532">W związku z tym adres URL musi zawierać liczbę, po której następuje ukośnik do przodu, po którym następuje inny numer.</span><span class="sxs-lookup"><span data-stu-id="9e65d-532">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="9e65d-533">Te grupy przechwytywania są wstrzykiwane `$1` do `$2`przepisanych adresów URL jako i .</span><span class="sxs-lookup"><span data-stu-id="9e65d-533">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="9e65d-534">Ciąg zastępowania reguły ponownego przepisywania umieszcza przechwycone grupy w ciągu zapytania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-534">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="9e65d-535">Żądana ścieżka `/rewrite-rule/1234/5678` jest przepisana w celu `/rewritten?var1=1234&var2=5678`uzyskania zasobu w pliku .</span><span class="sxs-lookup"><span data-stu-id="9e65d-535">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="9e65d-536">Jeśli ciąg zapytania jest obecny na oryginalnym żądaniu, jest zachowywany, gdy adres URL jest przepisany.</span><span class="sxs-lookup"><span data-stu-id="9e65d-536">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="9e65d-537">Nie ma żadnej podróży w obie strony do serwera, aby uzyskać zasób.</span><span class="sxs-lookup"><span data-stu-id="9e65d-537">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="9e65d-538">Jeśli zasób istnieje, jest pobierany i zwracany do klienta z kodem stanu *200 - OK.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-538">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="9e65d-539">Ponieważ klient nie jest przekierowywał, adres URL na pasku adresu przeglądarki nie zmienia się.</span><span class="sxs-lookup"><span data-stu-id="9e65d-539">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="9e65d-540">Klienci nie mogą wykryć, że na serwerze wystąpiła operacja ponownego zmiany adresu URL.</span><span class="sxs-lookup"><span data-stu-id="9e65d-540">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="9e65d-541">Używaj, `skipRemainingRules: true` gdy jest to możliwe, ponieważ reguły dopasowywania są kosztowne pod względem obliczeniowym i wydłuża czas reakcji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-541">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="9e65d-542">Aby uzyskać najszybszą odpowiedź aplikacji:</span><span class="sxs-lookup"><span data-stu-id="9e65d-542">For the fastest app response:</span></span>
>
> * <span data-ttu-id="9e65d-543">Kolejność przepisywania reguł z najczęściej dopasowywane reguły do reguły najrzadziej dopasowane.</span><span class="sxs-lookup"><span data-stu-id="9e65d-543">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="9e65d-544">Pomiń przetwarzanie pozostałych reguł, gdy wystąpi dopasowanie i nie jest wymagane żadne dodatkowe przetwarzanie reguł.</span><span class="sxs-lookup"><span data-stu-id="9e65d-544">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="9e65d-545">mod_rewrite Apache</span><span class="sxs-lookup"><span data-stu-id="9e65d-545">Apache mod_rewrite</span></span>

<span data-ttu-id="9e65d-546">Zastosuj apache mod_rewrite reguły <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>z .</span><span class="sxs-lookup"><span data-stu-id="9e65d-546">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="9e65d-547">Upewnij się, że plik reguł jest wdrożony z aplikacją.</span><span class="sxs-lookup"><span data-stu-id="9e65d-547">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="9e65d-548">Aby uzyskać więcej informacji i przykłady reguł mod_rewrite, zobacz [mod_rewrite Apache](https://httpd.apache.org/docs/2.4/rewrite/).</span><span class="sxs-lookup"><span data-stu-id="9e65d-548">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="9e65d-549">A <xref:System.IO.StreamReader> służy do odczytywania reguł z pliku reguł *ApacheModRewrite.txt:*</span><span class="sxs-lookup"><span data-stu-id="9e65d-549">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="9e65d-550">Przykładowa aplikacja przekierowuje żądania z `/apache-mod-rules-redirect/(.\*)` . `/redirected?id=$1`</span><span class="sxs-lookup"><span data-stu-id="9e65d-550">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="9e65d-551">Kod stanu odpowiedzi to *302 - Znaleziono*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-551">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/2.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="9e65d-552">Oryginalna prośba:`/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="9e65d-552">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="9e65d-554">Oprogramowanie pośredniczące obsługuje następujące zmienne serwera mod_rewrite Apache:</span><span class="sxs-lookup"><span data-stu-id="9e65d-554">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="9e65d-555">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-555">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="9e65d-556">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="9e65d-556">HTTP_ACCEPT</span></span>
* <span data-ttu-id="9e65d-557">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="9e65d-557">HTTP_CONNECTION</span></span>
* <span data-ttu-id="9e65d-558">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="9e65d-558">HTTP_COOKIE</span></span>
* <span data-ttu-id="9e65d-559">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="9e65d-559">HTTP_FORWARDED</span></span>
* <span data-ttu-id="9e65d-560">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="9e65d-560">HTTP_HOST</span></span>
* <span data-ttu-id="9e65d-561">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="9e65d-561">HTTP_REFERER</span></span>
* <span data-ttu-id="9e65d-562">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="9e65d-562">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="9e65d-563">HTTPS</span><span class="sxs-lookup"><span data-stu-id="9e65d-563">HTTPS</span></span>
* <span data-ttu-id="9e65d-564">Protokół IPV6</span><span class="sxs-lookup"><span data-stu-id="9e65d-564">IPV6</span></span>
* <span data-ttu-id="9e65d-565">Query_string</span><span class="sxs-lookup"><span data-stu-id="9e65d-565">QUERY_STRING</span></span>
* <span data-ttu-id="9e65d-566">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-566">REMOTE_ADDR</span></span>
* <span data-ttu-id="9e65d-567">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="9e65d-567">REMOTE_PORT</span></span>
* <span data-ttu-id="9e65d-568">Request_filename</span><span class="sxs-lookup"><span data-stu-id="9e65d-568">REQUEST_FILENAME</span></span>
* <span data-ttu-id="9e65d-569">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="9e65d-569">REQUEST_METHOD</span></span>
* <span data-ttu-id="9e65d-570">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="9e65d-570">REQUEST_SCHEME</span></span>
* <span data-ttu-id="9e65d-571">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="9e65d-571">REQUEST_URI</span></span>
* <span data-ttu-id="9e65d-572">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="9e65d-572">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="9e65d-573">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-573">SERVER_ADDR</span></span>
* <span data-ttu-id="9e65d-574">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="9e65d-574">SERVER_PORT</span></span>
* <span data-ttu-id="9e65d-575">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="9e65d-575">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="9e65d-576">CZAS</span><span class="sxs-lookup"><span data-stu-id="9e65d-576">TIME</span></span>
* <span data-ttu-id="9e65d-577">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="9e65d-577">TIME_DAY</span></span>
* <span data-ttu-id="9e65d-578">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="9e65d-578">TIME_HOUR</span></span>
* <span data-ttu-id="9e65d-579">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="9e65d-579">TIME_MIN</span></span>
* <span data-ttu-id="9e65d-580">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="9e65d-580">TIME_MON</span></span>
* <span data-ttu-id="9e65d-581">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="9e65d-581">TIME_SEC</span></span>
* <span data-ttu-id="9e65d-582">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="9e65d-582">TIME_WDAY</span></span>
* <span data-ttu-id="9e65d-583">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="9e65d-583">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="9e65d-584">Reguły modułu przepisywania adresów URL w uirozmywanych adresach URL w uirozie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-584">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="9e65d-585">Aby użyć tego samego zestawu reguł, który ma zastosowanie do <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>modułu przepisywania adresu URL iIS, należy użyć programu .</span><span class="sxs-lookup"><span data-stu-id="9e65d-585">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="9e65d-586">Upewnij się, że plik reguł jest wdrożony z aplikacją.</span><span class="sxs-lookup"><span data-stu-id="9e65d-586">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="9e65d-587">Nie kieruj oprogramowania pośredniczącego do używania pliku *web.config* aplikacji podczas uruchamiania w systemie Windows Server IIS.</span><span class="sxs-lookup"><span data-stu-id="9e65d-587">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="9e65d-588">Dzięki usługom IIS te reguły powinny być przechowywane poza *plikiem web.config* aplikacji, aby uniknąć konfliktów z modułem Przepisywanie usług IIS.</span><span class="sxs-lookup"><span data-stu-id="9e65d-588">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="9e65d-589">Aby uzyskać więcej informacji i przykłady reguł modułu zapisywania adresów URL usług IIS, zobacz [Korzystanie z modułu 2.0 do przepisywania adresów URL](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) i odwołanie do konfiguracji [modułu ponownego zapisu adresu URL](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span><span class="sxs-lookup"><span data-stu-id="9e65d-589">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="9e65d-590">A <xref:System.IO.StreamReader> służy do odczytywania reguł z pliku reguł *IISUrlRewrite.xml:*</span><span class="sxs-lookup"><span data-stu-id="9e65d-590">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="9e65d-591">Przykładowa aplikacja przepisuje `/iis-rules-rewrite/(.*)` `/rewritten?id=$1`żądania z do .</span><span class="sxs-lookup"><span data-stu-id="9e65d-591">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="9e65d-592">Odpowiedź jest wysyłana do klienta z kodem stanu *200 - OK.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-592">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/2.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="9e65d-593">Oryginalna prośba:`/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="9e65d-593">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądanie i odpowiedź](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="9e65d-595">Jeśli masz aktywny moduł przepisywania usług IIS z skonfigurowaną regułą na poziomie serwera, która miałaby wpływ na aplikację w niepożądany sposób, możesz wyłączyć moduł przepisywania usług IIS dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e65d-595">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="9e65d-596">Aby uzyskać więcej informacji, zobacz [Wyłączanie modułów IIS](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span><span class="sxs-lookup"><span data-stu-id="9e65d-596">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="9e65d-597">Nieobsługiwały się funkcje</span><span class="sxs-lookup"><span data-stu-id="9e65d-597">Unsupported features</span></span>

<span data-ttu-id="9e65d-598">Oprogramowanie pośredniczące wydane z ASP.NET Core 2.x nie obsługuje następujących funkcji modułu zapisywania adresów URL IIS:</span><span class="sxs-lookup"><span data-stu-id="9e65d-598">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="9e65d-599">Reguły ruchu wychodzącego</span><span class="sxs-lookup"><span data-stu-id="9e65d-599">Outbound Rules</span></span>
* <span data-ttu-id="9e65d-600">Niestandardowe zmienne serwera</span><span class="sxs-lookup"><span data-stu-id="9e65d-600">Custom Server Variables</span></span>
* <span data-ttu-id="9e65d-601">Symbole wieloznaczne</span><span class="sxs-lookup"><span data-stu-id="9e65d-601">Wildcards</span></span>
* <span data-ttu-id="9e65d-602">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="9e65d-602">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="9e65d-603">Obsługiwane zmienne serwera</span><span class="sxs-lookup"><span data-stu-id="9e65d-603">Supported server variables</span></span>

<span data-ttu-id="9e65d-604">Oprogramowanie pośredniczące obsługuje następujące zmienne serwera serwera iis url rewrite module:</span><span class="sxs-lookup"><span data-stu-id="9e65d-604">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="9e65d-605">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="9e65d-605">CONTENT_LENGTH</span></span>
* <span data-ttu-id="9e65d-606">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="9e65d-606">CONTENT_TYPE</span></span>
* <span data-ttu-id="9e65d-607">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="9e65d-607">HTTP_ACCEPT</span></span>
* <span data-ttu-id="9e65d-608">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="9e65d-608">HTTP_CONNECTION</span></span>
* <span data-ttu-id="9e65d-609">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="9e65d-609">HTTP_COOKIE</span></span>
* <span data-ttu-id="9e65d-610">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="9e65d-610">HTTP_HOST</span></span>
* <span data-ttu-id="9e65d-611">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="9e65d-611">HTTP_REFERER</span></span>
* <span data-ttu-id="9e65d-612">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-612">HTTP_URL</span></span>
* <span data-ttu-id="9e65d-613">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="9e65d-613">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="9e65d-614">HTTPS</span><span class="sxs-lookup"><span data-stu-id="9e65d-614">HTTPS</span></span>
* <span data-ttu-id="9e65d-615">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-615">LOCAL_ADDR</span></span>
* <span data-ttu-id="9e65d-616">Query_string</span><span class="sxs-lookup"><span data-stu-id="9e65d-616">QUERY_STRING</span></span>
* <span data-ttu-id="9e65d-617">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="9e65d-617">REMOTE_ADDR</span></span>
* <span data-ttu-id="9e65d-618">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="9e65d-618">REMOTE_PORT</span></span>
* <span data-ttu-id="9e65d-619">Request_filename</span><span class="sxs-lookup"><span data-stu-id="9e65d-619">REQUEST_FILENAME</span></span>
* <span data-ttu-id="9e65d-620">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="9e65d-620">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="9e65d-621">Można również uzyskać <xref:Microsoft.Extensions.FileProviders.IFileProvider> za <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>pośrednictwem .</span><span class="sxs-lookup"><span data-stu-id="9e65d-621">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="9e65d-622">Takie podejście może zapewnić większą elastyczność lokalizacji plików reguł ponownego zapisu.</span><span class="sxs-lookup"><span data-stu-id="9e65d-622">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="9e65d-623">Upewnij się, że pliki reguł ponownego zapisu są wdrażane na serwerze w ścieżce, którą podasz.</span><span class="sxs-lookup"><span data-stu-id="9e65d-623">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="9e65d-624">Reguła oparta na metodzie</span><span class="sxs-lookup"><span data-stu-id="9e65d-624">Method-based rule</span></span>

<span data-ttu-id="9e65d-625">Służy <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> do implementowania własnej logiki reguły w metodzie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-625">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="9e65d-626">`Add`udostępnia <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, który udostępnia <xref:Microsoft.AspNetCore.Http.HttpContext> do wykorzystania w metodzie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-626">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="9e65d-627">[RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) określa sposób obsługi dodatkowego przetwarzania potoku.</span><span class="sxs-lookup"><span data-stu-id="9e65d-627">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="9e65d-628">Ustaw wartość jednego z <xref:Microsoft.AspNetCore.Rewrite.RuleResult> pól opisanych w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="9e65d-628">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| `RewriteContext.Result`              | <span data-ttu-id="9e65d-629">Akcja</span><span class="sxs-lookup"><span data-stu-id="9e65d-629">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="9e65d-630">`RuleResult.ContinueRules`(domyślnie)</span><span class="sxs-lookup"><span data-stu-id="9e65d-630">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="9e65d-631">Kontynuuj stosowanie reguł.</span><span class="sxs-lookup"><span data-stu-id="9e65d-631">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="9e65d-632">Przestań stosować reguły i wyślij odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="9e65d-632">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="9e65d-633">Przestań stosować reguły i wyślij kontekst do następnego oprogramowania pośredniczącego.</span><span class="sxs-lookup"><span data-stu-id="9e65d-633">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="9e65d-634">Przykładowa aplikacja pokazuje metodę, która przekierowuje żądania ścieżek, które kończą się na *.xml*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-634">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="9e65d-635">Jeśli zostanie złożony `/file.xml`wniosek, żądanie zostanie `/xmlfiles/file.xml`przekierowane do .</span><span class="sxs-lookup"><span data-stu-id="9e65d-635">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="9e65d-636">Kod stanu jest ustawiony na *301 - Przeniesiony na stałe*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-636">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="9e65d-637">Gdy przeglądarka wysunie nowe żądanie dla */xmlfiles/file.xml*, Oprogramowanie pośredniczące plików statycznych służy do klienta z folderu *wwwroot/xmlfiles.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-637">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="9e65d-638">W przypadku przekierowania jawnie ustaw kod stanu odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="9e65d-638">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="9e65d-639">W przeciwnym razie zwracany jest kod stanu *200 - OK,* a przekierowanie nie występuje na kliencie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-639">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="9e65d-640">*RewriteRules.cs:*</span><span class="sxs-lookup"><span data-stu-id="9e65d-640">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="9e65d-641">Takie podejście można również przepisać żądania.</span><span class="sxs-lookup"><span data-stu-id="9e65d-641">This approach can also rewrite requests.</span></span> <span data-ttu-id="9e65d-642">Przykładowa aplikacja demonstruje przepisywanie ścieżki dla dowolnego żądania pliku tekstowego do obsługi pliku tekstowego *file.txt* z folderu *wwwroot.*</span><span class="sxs-lookup"><span data-stu-id="9e65d-642">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="9e65d-643">Oprogramowanie pośredniczące plików statycznych obsługuje plik na podstawie zaktualizowanej ścieżki żądania:</span><span class="sxs-lookup"><span data-stu-id="9e65d-643">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="9e65d-644">*RewriteRules.cs:*</span><span class="sxs-lookup"><span data-stu-id="9e65d-644">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="9e65d-645">Reguła oparta na zasadach irule</span><span class="sxs-lookup"><span data-stu-id="9e65d-645">IRule-based rule</span></span>

<span data-ttu-id="9e65d-646">Użyj <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> logiki reguły w klasie, <xref:Microsoft.AspNetCore.Rewrite.IRule> która implementuje interfejs.</span><span class="sxs-lookup"><span data-stu-id="9e65d-646">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="9e65d-647">`IRule`zapewnia większą elastyczność w stosowania metody opartej na metodzie.</span><span class="sxs-lookup"><span data-stu-id="9e65d-647">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="9e65d-648">Klasa implementacji może zawierać konstruktora, który <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> umożliwia przekazywanie parametrów dla metody.</span><span class="sxs-lookup"><span data-stu-id="9e65d-648">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="9e65d-649">Wartości parametrów w przykładowej aplikacji `extension` dla `newPath` i są sprawdzane, aby spełnić kilka warunków.</span><span class="sxs-lookup"><span data-stu-id="9e65d-649">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="9e65d-650">Musi `extension` zawierać wartość, a wartość musi być *.png*, *.jpg*lub *gif*.</span><span class="sxs-lookup"><span data-stu-id="9e65d-650">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="9e65d-651">Jeśli `newPath` nie jest prawidłowy, jest wyrzucany. <xref:System.ArgumentException></span><span class="sxs-lookup"><span data-stu-id="9e65d-651">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="9e65d-652">Jeśli zostanie złożony wniosek o *image.png,* żądanie `/png-images/image.png`zostanie przekierowane do .</span><span class="sxs-lookup"><span data-stu-id="9e65d-652">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="9e65d-653">Jeśli zostanie złożony wniosek o *image.jpg*, `/jpg-images/image.jpg`żądanie zostanie przekierowane do .</span><span class="sxs-lookup"><span data-stu-id="9e65d-653">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="9e65d-654">Kod stanu jest ustawiony na *301 -* `context.Result` Przeniesiony na stałe , a jest ustawiony, aby zatrzymać reguły przetwarzania i wysłać odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="9e65d-654">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="9e65d-655">Oryginalna prośba:`/image.png`</span><span class="sxs-lookup"><span data-stu-id="9e65d-655">Original Request: `/image.png`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi dla pliku image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="9e65d-657">Oryginalna prośba:`/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="9e65d-657">Original Request: `/image.jpg`</span></span>

![Okno przeglądarki z narzędziami deweloperskimi śledzącymi żądania i odpowiedzi dla pliku image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="9e65d-659">Przykłady regex</span><span class="sxs-lookup"><span data-stu-id="9e65d-659">Regex examples</span></span>

| <span data-ttu-id="9e65d-660">Cel</span><span class="sxs-lookup"><span data-stu-id="9e65d-660">Goal</span></span> | <span data-ttu-id="9e65d-661">& ciągu regex</span><span class="sxs-lookup"><span data-stu-id="9e65d-661">Regex String &</span></span><br><span data-ttu-id="9e65d-662">Przykład dopasowania</span><span class="sxs-lookup"><span data-stu-id="9e65d-662">Match Example</span></span> | <span data-ttu-id="9e65d-663">& ciągu zastępczego</span><span class="sxs-lookup"><span data-stu-id="9e65d-663">Replacement String &</span></span><br><span data-ttu-id="9e65d-664">Przykład wyjścia</span><span class="sxs-lookup"><span data-stu-id="9e65d-664">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="9e65d-665">Przepisanie ścieżki do sznurka zapytania</span><span class="sxs-lookup"><span data-stu-id="9e65d-665">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="9e65d-666">Ukośnik na końcu taśmy</span><span class="sxs-lookup"><span data-stu-id="9e65d-666">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="9e65d-667">Wymuszanie końcowego ukośnika</span><span class="sxs-lookup"><span data-stu-id="9e65d-667">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="9e65d-668">Unikaj przepisywania określonych żądań</span><span class="sxs-lookup"><span data-stu-id="9e65d-668">Avoid rewriting specific requests</span></span> | <span data-ttu-id="9e65d-669">`^(.*)(?<!\.axd)$` lub `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="9e65d-669">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="9e65d-670">Tak:`/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="9e65d-670">Yes: `/resource.htm`</span></span><br><span data-ttu-id="9e65d-671">№:`/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="9e65d-671">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="9e65d-672">Zmienianie rozmieszczenia segmentów adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-672">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="9e65d-673">Zastępowanie segmentu adresu URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-673">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

## <a name="additional-resources"></a><span data-ttu-id="9e65d-674">Zasoby dodatkowe</span><span class="sxs-lookup"><span data-stu-id="9e65d-674">Additional resources</span></span>

* <xref:fundamentals/startup>
* <xref:fundamentals/middleware/index>
* [<span data-ttu-id="9e65d-675">Wyrażenia regularne w programie .NET</span><span class="sxs-lookup"><span data-stu-id="9e65d-675">Regular expressions in .NET</span></span>](/dotnet/articles/standard/base-types/regular-expressions)
* [<span data-ttu-id="9e65d-676">Język wyrażenia regularnego - podręczny punkt odniesienia</span><span class="sxs-lookup"><span data-stu-id="9e65d-676">Regular expression language - quick reference</span></span>](/dotnet/articles/standard/base-types/quick-ref)
* [<span data-ttu-id="9e65d-677">mod_rewrite Apache</span><span class="sxs-lookup"><span data-stu-id="9e65d-677">Apache mod_rewrite</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="9e65d-678">Korzystanie z modułu 2.0 (dla iis)</span><span class="sxs-lookup"><span data-stu-id="9e65d-678">Using Url Rewrite Module 2.0 (for IIS)</span></span>](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20)
* [<span data-ttu-id="9e65d-679">Odwołanie do konfiguracji modułu ponownego zapisu adresu URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-679">URL Rewrite Module Configuration Reference</span></span>](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference)
* [<span data-ttu-id="9e65d-680">Forum modułu zapisywania adresów URL programu IIS</span><span class="sxs-lookup"><span data-stu-id="9e65d-680">IIS URL Rewrite Module Forum</span></span>](https://forums.iis.net/1152.aspx)
* [<span data-ttu-id="9e65d-681">Zachowaj prostą strukturę adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-681">Keep a simple URL structure</span></span>](https://support.google.com/webmasters/answer/76329?hl=en)
* [<span data-ttu-id="9e65d-682">10 porad i wskazówek dotyczących przepisywania adresów URL</span><span class="sxs-lookup"><span data-stu-id="9e65d-682">10 URL Rewriting Tips and Tricks</span></span>](https://ruslany.net/2009/04/10-url-rewriting-tips-and-tricks/)
* [<span data-ttu-id="9e65d-683">Aby ciąć lub nie ciąć</span><span class="sxs-lookup"><span data-stu-id="9e65d-683">To slash or not to slash</span></span>](https://webmasters.googleblog.com/2010/04/to-slash-or-not-to-slash.html)
