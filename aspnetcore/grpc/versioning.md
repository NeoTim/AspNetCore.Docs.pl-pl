---
title: Przechowywanie wersji usług gRPC
author: jamesnk
description: Dowiedz się, jak wersję usług gRPC.
monikerRange: '>= aspnetcore-3.0'
ms.author: jamesnk
ms.date: 01/09/2020
uid: grpc/versioning
ms.openlocfilehash: 9bd76009ba28a1abef25a98686afea6753d4a8f4
ms.sourcegitcommit: f7886fd2e219db9d7ce27b16c0dc5901e658d64e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2020
ms.locfileid: "78664116"
---
# <a name="versioning-grpc-services"></a><span data-ttu-id="4f048-103">Przechowywanie wersji usług gRPC</span><span class="sxs-lookup"><span data-stu-id="4f048-103">Versioning gRPC services</span></span>

<span data-ttu-id="4f048-104">Przez [James Newton-King](https://twitter.com/jamesnk)</span><span class="sxs-lookup"><span data-stu-id="4f048-104">By [James Newton-King](https://twitter.com/jamesnk)</span></span>

<span data-ttu-id="4f048-105">Nowe funkcje dodane do aplikacji mogą wymagać, aby usługi gRPC świadczone klientom były zmieniane, czasami w nieoczekiwany i przełomowy sposób.</span><span class="sxs-lookup"><span data-stu-id="4f048-105">New features added to an app can require gRPC services provided to clients to change, sometimes in unexpected and breaking ways.</span></span> <span data-ttu-id="4f048-106">Po zmianie usług gRPC:</span><span class="sxs-lookup"><span data-stu-id="4f048-106">When gRPC services change:</span></span>

* <span data-ttu-id="4f048-107">Należy wziąć pod uwagę wpływ zmian na klientów.</span><span class="sxs-lookup"><span data-stu-id="4f048-107">Consideration should be given on how changes impact clients.</span></span>
* <span data-ttu-id="4f048-108">Należy wdrożyć strategię przechowywania wersji do obsługi zmian.</span><span class="sxs-lookup"><span data-stu-id="4f048-108">A versioning strategy to support changes should be implemented.</span></span>

## <a name="backwards-compatibility"></a><span data-ttu-id="4f048-109">Zgodność z przewładem</span><span class="sxs-lookup"><span data-stu-id="4f048-109">Backwards compatibility</span></span>

<span data-ttu-id="4f048-110">Protokół gRPC jest przeznaczony do obsługi usług, które zmieniają się w czasie.</span><span class="sxs-lookup"><span data-stu-id="4f048-110">The gRPC protocol is designed to support services that change over time.</span></span> <span data-ttu-id="4f048-111">Ogólnie rzecz biorąc, dodatki do usług i metod gRPC nie są łamane.</span><span class="sxs-lookup"><span data-stu-id="4f048-111">Generally, additions to gRPC services and methods are non-breaking.</span></span> <span data-ttu-id="4f048-112">Nierozerwalne zmiany umożliwiają istniejącym klientom kontynuowanie pracy bez zmian.</span><span class="sxs-lookup"><span data-stu-id="4f048-112">Non-breaking changes allow existing clients to continue working without changes.</span></span> <span data-ttu-id="4f048-113">Zmiana lub usunięcie usług gRPC to przełomowe zmiany.</span><span class="sxs-lookup"><span data-stu-id="4f048-113">Changing or deleting gRPC services are breaking changes.</span></span> <span data-ttu-id="4f048-114">Gdy usługi gRPC mają przełomowe zmiany, klienci korzystający z tej usługi muszą zostać zaktualizowani i ponownie wsiewając.</span><span class="sxs-lookup"><span data-stu-id="4f048-114">When gRPC services have breaking changes, clients using that service have to be updated and redeployed.</span></span>

<span data-ttu-id="4f048-115">Wprowadzanie nierozerwowych zmian w usłudze ma wiele zalet:</span><span class="sxs-lookup"><span data-stu-id="4f048-115">Making non-breaking changes to a service has a number of benefits:</span></span>

* <span data-ttu-id="4f048-116">Istniejący klienci nadal działają.</span><span class="sxs-lookup"><span data-stu-id="4f048-116">Existing clients continue to run.</span></span>
* <span data-ttu-id="4f048-117">Pozwala uniknąć pracy związanej z powiadamianiem klientów o przełomowych zmianach i aktualizowaniem ich.</span><span class="sxs-lookup"><span data-stu-id="4f048-117">Avoids work involved with notifying clients of breaking changes, and updating them.</span></span>
* <span data-ttu-id="4f048-118">Tylko jedna wersja usługi musi być udokumentowana i utrzymywana.</span><span class="sxs-lookup"><span data-stu-id="4f048-118">Only one version of the service needs to be documented and maintained.</span></span>

### <a name="non-breaking-changes"></a><span data-ttu-id="4f048-119">Zmiany nierozłamane</span><span class="sxs-lookup"><span data-stu-id="4f048-119">Non-breaking changes</span></span>

<span data-ttu-id="4f048-120">Zmiany te nie są łamanie na poziomie protokołu gRPC i .NET binarny poziom.</span><span class="sxs-lookup"><span data-stu-id="4f048-120">These changes are non-breaking at a gRPC protocol level and .NET binary level.</span></span>

* <span data-ttu-id="4f048-121">**Dodawanie nowej usługi**</span><span class="sxs-lookup"><span data-stu-id="4f048-121">**Adding a new service**</span></span>
* <span data-ttu-id="4f048-122">**Dodawanie nowej metody do usługi**</span><span class="sxs-lookup"><span data-stu-id="4f048-122">**Adding a new method to a service**</span></span>
* <span data-ttu-id="4f048-123">**Dodawanie pola do komunikatu żądania** — pola dodane do komunikatu żądania są deserializowane z [wartością domyślną](https://developers.google.com/protocol-buffers/docs/proto3#default) na serwerze, gdy nie są ustawione.</span><span class="sxs-lookup"><span data-stu-id="4f048-123">**Adding a field to a request message** - Fields added to a request message are deserialized with the [default value](https://developers.google.com/protocol-buffers/docs/proto3#default) on the server when not set.</span></span> <span data-ttu-id="4f048-124">Aby usługa była zmianą nierozważną, musi zakończyć się pomyślnie, gdy nowe pole nie jest ustawiane przez starszych klientów.</span><span class="sxs-lookup"><span data-stu-id="4f048-124">To be a non-breaking change, the service must succeed when the new field isn't set by older clients.</span></span>
* <span data-ttu-id="4f048-125">**Dodawanie pola do komunikatu odpowiedzi** — pola dodane do wiadomości odpowiedzi są deserializowane do kolekcji [nieznanych pól](https://developers.google.com/protocol-buffers/docs/proto3#unknowns) wiadomości na kliencie.</span><span class="sxs-lookup"><span data-stu-id="4f048-125">**Adding a field to a response message** - Fields added to a response message are deserialized into the message's [unknown fields](https://developers.google.com/protocol-buffers/docs/proto3#unknowns) collection on the client.</span></span>
* <span data-ttu-id="4f048-126">**Dodawanie wartości do wyliczenia** — wyliczenia są serializowane jako wartość liczbowa.</span><span class="sxs-lookup"><span data-stu-id="4f048-126">**Adding a value to an enum** - Enums are serialized as a numeric value.</span></span> <span data-ttu-id="4f048-127">Nowe wartości wyliczenia są deserializowane na kliencie do wartości wyliczenia bez nazwy wyliczenia.</span><span class="sxs-lookup"><span data-stu-id="4f048-127">New enum values are deserialized on the client to the enum value without an enum name.</span></span> <span data-ttu-id="4f048-128">Aby być zmianą nierozłamającą, starsi klienci muszą działać poprawnie podczas odbierania nowej wartości wyliczenia.</span><span class="sxs-lookup"><span data-stu-id="4f048-128">To be a non-breaking change, older clients must run correctly when receiving the new enum value.</span></span>

### <a name="binary-breaking-changes"></a><span data-ttu-id="4f048-129">Binary przełomowe zmiany</span><span class="sxs-lookup"><span data-stu-id="4f048-129">Binary breaking changes</span></span>

<span data-ttu-id="4f048-130">Następujące zmiany nie są przerywane na poziomie protokołu gRPC, ale klient musi zostać zaktualizowany, jeśli uaktualni do najnowszego kontraktu *.proto* lub zestawu .NET klienta.</span><span class="sxs-lookup"><span data-stu-id="4f048-130">The following changes are non-breaking at a gRPC protocol level, but the client needs to be updated if it upgrades to the latest *.proto* contract or client .NET assembly.</span></span> <span data-ttu-id="4f048-131">Zgodność binarna jest ważne, jeśli planujesz opublikować bibliotekę gRPC do NuGet.</span><span class="sxs-lookup"><span data-stu-id="4f048-131">Binary compatibility is important if you plan to publish a gRPC library to NuGet.</span></span>

* <span data-ttu-id="4f048-132">**Usuwanie pola** — wartości z usuniętego pola są deserializowane do [nieznanych pól](https://developers.google.com/protocol-buffers/docs/proto3#unknowns)wiadomości .</span><span class="sxs-lookup"><span data-stu-id="4f048-132">**Removing a field** - Values from a removed field are deserialized to a message's [unknown fields](https://developers.google.com/protocol-buffers/docs/proto3#unknowns).</span></span> <span data-ttu-id="4f048-133">Nie jest to zmiana podziału protokołu gRPC, ale klient musi zostać zaktualizowany, jeśli uaktualni się do najnowszej umowy.</span><span class="sxs-lookup"><span data-stu-id="4f048-133">This isn't a gRPC protocol breaking change, but the client needs to be updated if it upgrades to the latest contract.</span></span> <span data-ttu-id="4f048-134">Ważne jest, aby usunięty numer pola nie był przypadkowo ponownie odtwarzany w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="4f048-134">It's important that a removed field number isn't accidentally reused in the future.</span></span> <span data-ttu-id="4f048-135">Aby upewnić się, że tak się nie stanie, określ usunięte numery pól i nazwy w wiadomości za pomocą [zastrzeżonego](https://developers.google.com/protocol-buffers/docs/proto3#reserved) słowa kluczowego Protobuf.</span><span class="sxs-lookup"><span data-stu-id="4f048-135">To ensure this doesn't happen, specify deleted field numbers and names on the message using Protobuf's [reserved](https://developers.google.com/protocol-buffers/docs/proto3#reserved) keyword.</span></span>
* <span data-ttu-id="4f048-136">**Zmiana nazwy wiadomości** — nazwy wiadomości nie są zazwyczaj wysyłane w sieci, więc nie jest to zmiana podziału protokołu gRPC.</span><span class="sxs-lookup"><span data-stu-id="4f048-136">**Renaming a message** - Message names aren't typically sent on the network, so this isn't a gRPC protocol breaking change.</span></span> <span data-ttu-id="4f048-137">Klient będzie musiał zostać zaktualizowany, jeśli uaktualni do najnowszej umowy.</span><span class="sxs-lookup"><span data-stu-id="4f048-137">The client will need to be updated if it upgrades to the latest contract.</span></span> <span data-ttu-id="4f048-138">Jedną z sytuacji, w której nazwy wiadomości **są** wysyłane w sieci, są [pola Dowolne,](https://developers.google.com/protocol-buffers/docs/proto3#any) gdy nazwa wiadomości jest używana do identyfikowania typu wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4f048-138">One situation where message names **are** sent on the network is with [Any](https://developers.google.com/protocol-buffers/docs/proto3#any) fields, when the message name is used to identify the message type.</span></span>
* <span data-ttu-id="4f048-139">**Zmiana csharp_namespace** — zmiana `csharp_namespace` spowoduje zmianę obszaru nazw wygenerowanych typów .NET.</span><span class="sxs-lookup"><span data-stu-id="4f048-139">**Changing csharp_namespace** - Changing `csharp_namespace` will change the namespace of generated .NET types.</span></span> <span data-ttu-id="4f048-140">Nie jest to zmiana podziału protokołu gRPC, ale klient musi zostać zaktualizowany, jeśli uaktualni się do najnowszej umowy.</span><span class="sxs-lookup"><span data-stu-id="4f048-140">This isn't a gRPC protocol breaking change, but the client needs to be updated if it upgrades to the latest contract.</span></span>

### <a name="protocol-breaking-changes"></a><span data-ttu-id="4f048-141">Zmiany w zerwaniu protokołu</span><span class="sxs-lookup"><span data-stu-id="4f048-141">Protocol breaking changes</span></span>

<span data-ttu-id="4f048-142">Następujące elementy są protokołem i binarnymi zmianami podziału:</span><span class="sxs-lookup"><span data-stu-id="4f048-142">The following items are protocol and binary breaking changes:</span></span>

* <span data-ttu-id="4f048-143">**Zmiana nazwy pola** — w przypadku zawartości Protobuf nazwy pól są używane tylko w wygenerowanym kodzie.</span><span class="sxs-lookup"><span data-stu-id="4f048-143">**Renaming a field** - With Protobuf content, the field names are only used in generated code.</span></span> <span data-ttu-id="4f048-144">Numer pola służy do identyfikowania pól w sieci.</span><span class="sxs-lookup"><span data-stu-id="4f048-144">The field number is used to identify fields on the network.</span></span> <span data-ttu-id="4f048-145">Zmiana nazwy pola nie jest zmianą protokołu dla Protobuf.</span><span class="sxs-lookup"><span data-stu-id="4f048-145">Renaming a field isn't a protocol breaking change for Protobuf.</span></span> <span data-ttu-id="4f048-146">Jeśli jednak serwer używa zawartości JSON, zmiana nazwy pola jest zmianą podziału.</span><span class="sxs-lookup"><span data-stu-id="4f048-146">However, if a server is using JSON content then renaming a field is a breaking change.</span></span>
* <span data-ttu-id="4f048-147">**Zmiana typu danych pola** — zmiana typu danych pola na [niezgodny typ](https://developers.google.com/protocol-buffers/docs/proto3#updating) spowoduje błędy podczas deserializacji wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4f048-147">**Changing a field data type** - Changing a field's data type to an [incompatible type](https://developers.google.com/protocol-buffers/docs/proto3#updating) will cause errors when deserializing the message.</span></span> <span data-ttu-id="4f048-148">Nawet jeśli nowy typ danych jest zgodny, jest prawdopodobne, że klient musi zostać zaktualizowany do obsługi nowego typu, jeśli uaktualnia do najnowszego kontraktu.</span><span class="sxs-lookup"><span data-stu-id="4f048-148">Even if the new data type is compatible, it's likely the client needs to be updated to support the new type if it upgrades to the latest contract.</span></span>
* <span data-ttu-id="4f048-149">**Zmiana numeru pola** — w przypadku ładunków Protobuf numer pola jest używany do identyfikowania pól w sieci.</span><span class="sxs-lookup"><span data-stu-id="4f048-149">**Changing a field number** - With Protobuf payloads, the field number is used to identify fields on the network.</span></span>
* <span data-ttu-id="4f048-150">**Zmiana nazwy pakietu, usługi lub metody** — gRPC używa nazwy pakietu, nazwy usługi i nazwy metody do tworzenia adresu URL.</span><span class="sxs-lookup"><span data-stu-id="4f048-150">**Renaming a package, service or method** - gRPC uses the package name, service name, and method name to build the URL.</span></span> <span data-ttu-id="4f048-151">Klient otrzymuje *status UNIMPLEMENTED* z serwera.</span><span class="sxs-lookup"><span data-stu-id="4f048-151">The client gets an *UNIMPLEMENTED* status from the server.</span></span>
* <span data-ttu-id="4f048-152">**Usuwanie usługi lub metody** — klient pobiera *status UNIMPLEMENTED* z serwera podczas wywoływania usuniętej metody.</span><span class="sxs-lookup"><span data-stu-id="4f048-152">**Removing a service or method** - The client gets an *UNIMPLEMENTED* status from the server when calling the removed method.</span></span>

### <a name="behavior-breaking-changes"></a><span data-ttu-id="4f048-153">Zmiany dotyczące zachowania</span><span class="sxs-lookup"><span data-stu-id="4f048-153">Behavior breaking changes</span></span>

<span data-ttu-id="4f048-154">Podczas wprowadzania zmian nierozłamających należy również rozważyć, czy starsi klienci mogą kontynuować pracę z nowym zachowaniem usługi.</span><span class="sxs-lookup"><span data-stu-id="4f048-154">When making non-breaking changes, you must also consider whether older clients can continue working with the new service behavior.</span></span> <span data-ttu-id="4f048-155">Na przykład dodanie nowego pola do wiadomości żądania:</span><span class="sxs-lookup"><span data-stu-id="4f048-155">For example, adding a new field to a request message:</span></span>

* <span data-ttu-id="4f048-156">Nie jest to zmiana podziału protokołu.</span><span class="sxs-lookup"><span data-stu-id="4f048-156">Isn't a protocol breaking change.</span></span>
* <span data-ttu-id="4f048-157">Zwracanie stanu błędu na serwerze, jeśli nowe pole nie jest ustawione, powoduje, że jest to przełomowa zmiana dla starych klientów.</span><span class="sxs-lookup"><span data-stu-id="4f048-157">Returning an error status on the server if the new field isn't set makes it a breaking change for old clients.</span></span>

<span data-ttu-id="4f048-158">Zgodność zachowania zależy od kodu specyficznego dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="4f048-158">Behavior compatibility is determined by your app-specific code.</span></span>

## <a name="version-number-services"></a><span data-ttu-id="4f048-159">Usługi numerów wersji</span><span class="sxs-lookup"><span data-stu-id="4f048-159">Version number services</span></span>

<span data-ttu-id="4f048-160">Usługi powinny dążyć do zachowania wstecz zgodności ze starymi klientami.</span><span class="sxs-lookup"><span data-stu-id="4f048-160">Services should strive to remain backwards compatible with old clients.</span></span> <span data-ttu-id="4f048-161">Po pewnym czasie zmiany w aplikacji mogą wymagać zmian w przerwaniu pracy.</span><span class="sxs-lookup"><span data-stu-id="4f048-161">Eventually changes to your app may require breaking changes.</span></span> <span data-ttu-id="4f048-162">Rozbijanie starych klientów i zmuszanie ich do aktualizacji wraz z usługą nie jest dobrym doświadczeniem użytkownika.</span><span class="sxs-lookup"><span data-stu-id="4f048-162">Breaking old clients and forcing them to be updated along with your service isn't a good user experience.</span></span> <span data-ttu-id="4f048-163">Sposobem zachowania zgodności z powrotem podczas wprowadzania zmian podziału jest opublikowanie wielu wersji usługi.</span><span class="sxs-lookup"><span data-stu-id="4f048-163">A way to maintain backwards compatibility while making breaking changes is to publish multiple versions of a service.</span></span>

<span data-ttu-id="4f048-164">gRPC obsługuje opcjonalny specyfikator [pakietu,](https://developers.google.com/protocol-buffers/docs/proto3#packages) który działa podobnie jak obszar nazw .NET.</span><span class="sxs-lookup"><span data-stu-id="4f048-164">gRPC supports an optional [package](https://developers.google.com/protocol-buffers/docs/proto3#packages) specifier, which functions much like a .NET namespace.</span></span> <span data-ttu-id="4f048-165">W rzeczywistości `package` będzie używany jako obszar nazw .NET dla `option csharp_namespace` wygenerowanych typów .NET, jeśli nie jest ustawiony w pliku *.proto.*</span><span class="sxs-lookup"><span data-stu-id="4f048-165">In fact, the `package` will be used as the .NET namespace for generated .NET types if `option csharp_namespace` is not set in the *.proto* file.</span></span> <span data-ttu-id="4f048-166">Pakiet może służyć do określenia numeru wersji usługi i jej komunikatów:</span><span class="sxs-lookup"><span data-stu-id="4f048-166">The package can be used to specify a version number for your service and its messages:</span></span>

[!code-protobuf[](versioning/sample/greet.v1.proto?highlight=3)]

<span data-ttu-id="4f048-167">Nazwa pakietu jest łączona z nazwą usługi w celu zidentyfikowania adresu usługi.</span><span class="sxs-lookup"><span data-stu-id="4f048-167">The package name is combined with the service name to identify a service address.</span></span> <span data-ttu-id="4f048-168">Adres usługi umożliwia hostowanie wielu wersji usługi obok siebie:</span><span class="sxs-lookup"><span data-stu-id="4f048-168">A service address allows multiple versions of a service to be hosted side-by-side:</span></span>

* `greet.v1.Greeter`
* `greet.v2.Greeter`

<span data-ttu-id="4f048-169">Implementacje usługi są rejestrowane w *Startup.cs:*</span><span class="sxs-lookup"><span data-stu-id="4f048-169">Implementations of the versioned service are registered in *Startup.cs*:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    // Implements greet.v1.Greeter
    endpoints.MapGrpcService<GreeterServiceV1>();

    // Implements greet.v2.Greeter
    endpoints.MapGrpcService<GreeterServiceV2>();
});
```

<span data-ttu-id="4f048-170">Uwzględnienie numeru wersji w nazwie pakietu daje możliwość opublikowania wersji *2* usługi z przełomowymi zmianami, kontynuując obsługę starszych klientów, którzy wywołują wersję *v1.*</span><span class="sxs-lookup"><span data-stu-id="4f048-170">Including a version number in the package name gives you the opportunity to publish a *v2* version of your service with breaking changes, while continuing to support older clients who call the *v1* version.</span></span> <span data-ttu-id="4f048-171">Po zaktualizowaniu klientów do korzystania z usługi *w wersji 2* można usunąć starą wersję.</span><span class="sxs-lookup"><span data-stu-id="4f048-171">Once clients have updated to use the *v2* service, you can choose to remove the old version.</span></span> <span data-ttu-id="4f048-172">Planując opublikowanie wielu wersji usługi:</span><span class="sxs-lookup"><span data-stu-id="4f048-172">When planning to publish multiple versions of a service:</span></span>

* <span data-ttu-id="4f048-173">Unikaj łamania zmian, jeśli jest to uzasadnione.</span><span class="sxs-lookup"><span data-stu-id="4f048-173">Avoid breaking changes if reasonable.</span></span>
* <span data-ttu-id="4f048-174">Nie aktualizuj numeru wersji, chyba że wprowadzasz przełomowe zmiany.</span><span class="sxs-lookup"><span data-stu-id="4f048-174">Don't update the version number unless making breaking changes.</span></span>
* <span data-ttu-id="4f048-175">Należy zaktualizować numer wersji po wprowadzeniu zmian w przerwaniu.</span><span class="sxs-lookup"><span data-stu-id="4f048-175">Do update the version number when you make breaking changes.</span></span>

<span data-ttu-id="4f048-176">Publikowanie wielu wersji usługi powiela ją.</span><span class="sxs-lookup"><span data-stu-id="4f048-176">Publishing multiple versions of a service duplicates it.</span></span> <span data-ttu-id="4f048-177">Aby ograniczyć powielanie, należy rozważyć przeniesienie logiki biznesowej z implementacji usługi do scentralizowanej lokalizacji, która może być ponownie używana przez stare i nowe implementacje:</span><span class="sxs-lookup"><span data-stu-id="4f048-177">To reduce duplication, consider moving business logic from the service implementations to a centralized location that can be reused by the old and new implementations:</span></span>

[!code-csharp[](versioning/sample/GreeterServiceV1.cs?highlight=10,19)]

<span data-ttu-id="4f048-178">Usługi i wiadomości generowane przy różnych nazwach pakietów są **różnymi typami .NET**.</span><span class="sxs-lookup"><span data-stu-id="4f048-178">Services and messages generated with different package names are **different .NET types**.</span></span> <span data-ttu-id="4f048-179">Przenoszenie logiki biznesowej do scentralizowanej lokalizacji wymaga mapowania wiadomości do typowych typów.</span><span class="sxs-lookup"><span data-stu-id="4f048-179">Moving business logic to a centralized location requires mapping messages to common types.</span></span>
