---
<span data-ttu-id="d387a-101">title: "niestandardowe dostawcy magazynu dla ASP.NET Core Identity " autor: Opis: "informacje o konfigurowaniu niestandardowych dostawców magazynu dla ASP.NET Core Identity ".</span><span class="sxs-lookup"><span data-stu-id="d387a-101">title: 'Custom storage providers for ASP.NET Core Identity' author: description: 'Learn how to configure custom storage providers for ASP.NET Core Identity.'</span></span>
<span data-ttu-id="d387a-102">MS. Author: MS. Custom: MS. Date: No-Loc:</span><span class="sxs-lookup"><span data-stu-id="d387a-102">ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="d387a-103">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="d387a-103">'Blazor'</span></span>
- <span data-ttu-id="d387a-104">'Identity'</span><span class="sxs-lookup"><span data-stu-id="d387a-104">'Identity'</span></span>
- <span data-ttu-id="d387a-105">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="d387a-105">'Let's Encrypt'</span></span>
- <span data-ttu-id="d387a-106">'Razor'</span><span class="sxs-lookup"><span data-stu-id="d387a-106">'Razor'</span></span>
- <span data-ttu-id="d387a-107">SignalRIdentyfikator UID:</span><span class="sxs-lookup"><span data-stu-id="d387a-107">'SignalR' uid:</span></span> 

---
# <a name="custom-storage-providers-for-aspnet-core-identity"></a><span data-ttu-id="d387a-108">Niestandardowi dostawcy magazynu dla ASP.NET CoreIdentity</span><span class="sxs-lookup"><span data-stu-id="d387a-108">Custom storage providers for ASP.NET Core Identity</span></span>

<span data-ttu-id="d387a-109">Przez [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="d387a-109">By [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="d387a-110">ASP.NET Core Identity to rozszerzalny system, który umożliwia utworzenie niestandardowego dostawcy magazynu i połączenie go z aplikacją.</span><span class="sxs-lookup"><span data-stu-id="d387a-110">ASP.NET Core Identity is an extensible system which enables you to create a custom storage provider and connect it to your app.</span></span> <span data-ttu-id="d387a-111">W tym temacie opisano sposób tworzenia niestandardowego dostawcy magazynu dla ASP.NET Core Identity .</span><span class="sxs-lookup"><span data-stu-id="d387a-111">This topic describes how to create a customized storage provider for ASP.NET Core Identity.</span></span> <span data-ttu-id="d387a-112">Dotyczy to ważnych koncepcji tworzenia własnego dostawcy magazynu, ale nie jest to przewodnik krok po kroku.</span><span class="sxs-lookup"><span data-stu-id="d387a-112">It covers the important concepts for creating your own storage provider, but isn't a step-by-step walkthrough.</span></span>

<span data-ttu-id="d387a-113">[Wyświetl lub Pobierz przykład z witryny GitHub](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/security/authentication/identity/sample).</span><span class="sxs-lookup"><span data-stu-id="d387a-113">[View or download sample from GitHub](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/security/authentication/identity/sample).</span></span>

## <a name="introduction"></a><span data-ttu-id="d387a-114">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="d387a-114">Introduction</span></span>

<span data-ttu-id="d387a-115">Domyślnie Identity system ASP.NET Core przechowuje informacje o użytkownikach w bazie danych SQL Server przy użyciu Entity Framework Core.</span><span class="sxs-lookup"><span data-stu-id="d387a-115">By default, the ASP.NET Core Identity system stores user information in a SQL Server database using Entity Framework Core.</span></span> <span data-ttu-id="d387a-116">W przypadku wielu aplikacji to podejście działa prawidłowo.</span><span class="sxs-lookup"><span data-stu-id="d387a-116">For many apps, this approach works well.</span></span> <span data-ttu-id="d387a-117">Jednak warto użyć innego mechanizmu trwałości lub schematu danych.</span><span class="sxs-lookup"><span data-stu-id="d387a-117">However, you may prefer to use a different persistence mechanism or data schema.</span></span> <span data-ttu-id="d387a-118">Przykład:</span><span class="sxs-lookup"><span data-stu-id="d387a-118">For example:</span></span>

* <span data-ttu-id="d387a-119">Używasz [usługi Azure Table Storage](/azure/storage/) lub innego magazynu danych.</span><span class="sxs-lookup"><span data-stu-id="d387a-119">You use [Azure Table Storage](/azure/storage/) or another data store.</span></span>
* <span data-ttu-id="d387a-120">Tabele bazy danych mają inną strukturę.</span><span class="sxs-lookup"><span data-stu-id="d387a-120">Your database tables have a different structure.</span></span> 
* <span data-ttu-id="d387a-121">Możesz chcieć użyć innego podejścia do uzyskiwania dostępu do danych, takiego jak [Dapper](https://github.com/StackExchange/Dapper).</span><span class="sxs-lookup"><span data-stu-id="d387a-121">You may wish to use a different data access approach, such as [Dapper](https://github.com/StackExchange/Dapper).</span></span> 

<span data-ttu-id="d387a-122">W każdym z tych przypadków można napisać niestandardowego dostawcę dla mechanizmu magazynu i podłączyć tego dostawcę do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d387a-122">In each of these cases, you can write a customized provider for your storage mechanism and plug that provider into your app.</span></span>

<span data-ttu-id="d387a-123">ASP.NET Core Identity jest zawarty w szablonach projektu w programie Visual Studio z opcją "indywidualne konta użytkowników".</span><span class="sxs-lookup"><span data-stu-id="d387a-123">ASP.NET Core Identity is included in project templates in Visual Studio with the "Individual User Accounts" option.</span></span>

<span data-ttu-id="d387a-124">Korzystając z interfejs wiersza polecenia platformy .NET Core, Dodaj `-au Individual` :</span><span class="sxs-lookup"><span data-stu-id="d387a-124">When using the .NET Core CLI, add `-au Individual`:</span></span>

```dotnetcli
dotnet new mvc -au Individual
```

## <a name="the-aspnet-core-identity-architecture"></a><span data-ttu-id="d387a-125">Architektura ASP.NET Core Identity</span><span class="sxs-lookup"><span data-stu-id="d387a-125">The ASP.NET Core Identity architecture</span></span>

<span data-ttu-id="d387a-126">ASP.NET Core Identity składa się z klas o nazwie menedżerowie i sklepy.</span><span class="sxs-lookup"><span data-stu-id="d387a-126">ASP.NET Core Identity consists of classes called managers and stores.</span></span> <span data-ttu-id="d387a-127">*Menedżerowie* są klasami wysokiego poziomu, których deweloperzy aplikacji używają do wykonywania operacji, takich jak tworzenie Identity użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d387a-127">*Managers* are high-level classes which an app developer uses to perform operations, such as creating an Identity user.</span></span> <span data-ttu-id="d387a-128">*Magazyny* są klasy niższego poziomu, które określają, jak są utrwalane jednostki, takie jak użytkownicy i role.</span><span class="sxs-lookup"><span data-stu-id="d387a-128">*Stores* are lower-level classes that specify how entities, such as users and roles, are persisted.</span></span> <span data-ttu-id="d387a-129">Sklepy są zgodne ze wzorcem repozytorium i są ściśle powiązane z mechanizmem trwałości.</span><span class="sxs-lookup"><span data-stu-id="d387a-129">Stores follow the repository pattern and are closely coupled with the persistence mechanism.</span></span> <span data-ttu-id="d387a-130">Menedżerowie są niezależni od sklepów, co oznacza, że można zastąpić mechanizm trwałości bez zmiany kodu aplikacji (z wyjątkiem konfiguracji).</span><span class="sxs-lookup"><span data-stu-id="d387a-130">Managers are decoupled from stores, which means you can replace the persistence mechanism without changing your application code (except for configuration).</span></span>

<span data-ttu-id="d387a-131">Na poniższym diagramie przedstawiono, w jaki sposób aplikacja internetowa współdziała z menedżerami, a jednocześnie przechowuje interakcję z warstwą dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="d387a-131">The following diagram shows how a web app interacts with the managers, while stores interact with the data access layer.</span></span>

![Aplikacje ASP.NET Core działają z menedżerami (na przykład "Usermanager", "roleManager").](identity-custom-storage-providers/_static/identity-architecture-diagram.png)

<span data-ttu-id="d387a-134">Aby utworzyć niestandardowego dostawcę magazynu, Utwórz źródło danych, warstwę dostępu do danych i klasy magazynu, które współpracują z tą warstwą dostępu do danych (zielone i szare pola na powyższym diagramie).</span><span class="sxs-lookup"><span data-stu-id="d387a-134">To create a custom storage provider, create the data source, the data access layer, and the store classes that interact with this data access layer (the green and grey boxes in the diagram above).</span></span> <span data-ttu-id="d387a-135">Nie musisz dostosowywać menedżerów ani kodu aplikacji, które współdziałają z nimi (niebieskie pola powyżej).</span><span class="sxs-lookup"><span data-stu-id="d387a-135">You don't need to customize the managers or your app code that interacts with them (the blue boxes above).</span></span>

<span data-ttu-id="d387a-136">Podczas tworzenia nowego wystąpienia `UserManager` lub `RoleManager` podania typu klasy użytkownika i przekazania wystąpienia klasy magazynu jako argumentu.</span><span class="sxs-lookup"><span data-stu-id="d387a-136">When creating a new instance of `UserManager` or `RoleManager` you provide the type of the user class and pass an instance of the store class as an argument.</span></span> <span data-ttu-id="d387a-137">Takie podejście umożliwia podłączenie dostosowanych klas do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d387a-137">This approach enables you to plug your customized classes into ASP.NET Core.</span></span> 

<span data-ttu-id="d387a-138">[Zmień konfigurację aplikacji, aby używała nowego dostawcy magazynu](#reconfigure-app-to-use-a-new-storage-provider) pokazuje, jak utworzyć wystąpienie `UserManager` i `RoleManager` przy użyciu dostosowanego magazynu.</span><span class="sxs-lookup"><span data-stu-id="d387a-138">[Reconfigure app to use new storage provider](#reconfigure-app-to-use-a-new-storage-provider) shows how to instantiate `UserManager` and `RoleManager` with a customized store.</span></span>

## <a name="aspnet-core-identity-stores-data-types"></a><span data-ttu-id="d387a-139">ASP.NET Core Identity przechowuje typy danych</span><span class="sxs-lookup"><span data-stu-id="d387a-139">ASP.NET Core Identity stores data types</span></span>

<span data-ttu-id="d387a-140">[ASP.NET Core Identity ](https://github.com/aspnet/identity) typy danych są szczegółowo opisane w następujących sekcjach:</span><span class="sxs-lookup"><span data-stu-id="d387a-140">[ASP.NET Core Identity](https://github.com/aspnet/identity) data types are detailed in the following sections:</span></span>

### <a name="users"></a><span data-ttu-id="d387a-141">Użytkownicy</span><span class="sxs-lookup"><span data-stu-id="d387a-141">Users</span></span>

<span data-ttu-id="d387a-142">Zarejestrowani użytkownicy witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="d387a-142">Registered users of your web site.</span></span> <span data-ttu-id="d387a-143">Typ [IdentityUser](/dotnet/api/microsoft.aspnet.identity.corecompat.identityuser) może być rozszerzony lub używany jako przykład dla własnego typu niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="d387a-143">The [IdentityUser](/dotnet/api/microsoft.aspnet.identity.corecompat.identityuser) type may be extended or used as an example for your own custom type.</span></span> <span data-ttu-id="d387a-144">Nie musisz dziedziczyć z określonego typu w celu zaimplementowania własnego niestandardowego rozwiązania do magazynowania tożsamości.</span><span class="sxs-lookup"><span data-stu-id="d387a-144">You don't need to inherit from a particular type to implement your own custom identity storage solution.</span></span>

### <a name="user-claims"></a><span data-ttu-id="d387a-145">Oświadczenia użytkownika</span><span class="sxs-lookup"><span data-stu-id="d387a-145">User Claims</span></span>

<span data-ttu-id="d387a-146">Zestaw instrukcji (lub [oświadczeń](/dotnet/api/system.security.claims.claim)) o użytkowniku, który reprezentuje tożsamość użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d387a-146">A set of statements (or [Claims](/dotnet/api/system.security.claims.claim)) about the user that represent the user's identity.</span></span> <span data-ttu-id="d387a-147">Można włączyć lepsze wyrażenie tożsamości użytkownika, niż można osiągnąć za pomocą ról.</span><span class="sxs-lookup"><span data-stu-id="d387a-147">Can enable greater expression of the user's identity than can be achieved through roles.</span></span>

### <a name="user-logins"></a><span data-ttu-id="d387a-148">Logowania użytkowników</span><span class="sxs-lookup"><span data-stu-id="d387a-148">User Logins</span></span>

<span data-ttu-id="d387a-149">Informacje o zewnętrznym dostawcy uwierzytelniania (na przykład Facebook lub konto Microsoft) do użycia podczas logowania użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d387a-149">Information about the external authentication provider (like Facebook or a Microsoft account) to use when logging in a user.</span></span> [<span data-ttu-id="d387a-150">Przykład</span><span class="sxs-lookup"><span data-stu-id="d387a-150">Example</span></span>](/dotnet/api/microsoft.aspnet.identity.corecompat.identityuserlogin)

### <a name="roles"></a><span data-ttu-id="d387a-151">Role</span><span class="sxs-lookup"><span data-stu-id="d387a-151">Roles</span></span>

<span data-ttu-id="d387a-152">Grupy autoryzacji dla witryny.</span><span class="sxs-lookup"><span data-stu-id="d387a-152">Authorization groups for your site.</span></span> <span data-ttu-id="d387a-153">Zawiera identyfikator roli i nazwę roli (na przykład "admin" lub "Employee").</span><span class="sxs-lookup"><span data-stu-id="d387a-153">Includes the role Id and role name (like "Admin" or "Employee").</span></span> [<span data-ttu-id="d387a-154">Przykład</span><span class="sxs-lookup"><span data-stu-id="d387a-154">Example</span></span>](/dotnet/api/microsoft.aspnet.identity.corecompat.identityrole)

## <a name="the-data-access-layer"></a><span data-ttu-id="d387a-155">Warstwa dostępu do danych</span><span class="sxs-lookup"><span data-stu-id="d387a-155">The data access layer</span></span>

<span data-ttu-id="d387a-156">W tym temacie założono, że znasz mechanizm trwałości, który ma być używany, oraz sposób tworzenia jednostek dla tego mechanizmu.</span><span class="sxs-lookup"><span data-stu-id="d387a-156">This topic assumes you are familiar with the persistence mechanism that you are going to use and how to create entities for that mechanism.</span></span> <span data-ttu-id="d387a-157">Ten temat nie zawiera szczegółowych informacji o sposobie tworzenia repozytoriów lub klas dostępu do danych; zawiera ona kilka sugestii dotyczących decyzji projektowych podczas pracy z ASP.NET Core Identity .</span><span class="sxs-lookup"><span data-stu-id="d387a-157">This topic doesn't provide details about how to create the repositories or data access classes; it provides some suggestions about design decisions when working with ASP.NET Core Identity.</span></span>

<span data-ttu-id="d387a-158">Podczas projektowania warstwy dostępu do danych dla niestandardowego dostawcy magazynu istnieje dużo swobody.</span><span class="sxs-lookup"><span data-stu-id="d387a-158">You have a lot of freedom when designing the data access layer for a customized store provider.</span></span> <span data-ttu-id="d387a-159">Należy tylko utworzyć mechanizmy trwałości dla funkcji, które mają być używane w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d387a-159">You only need to create persistence mechanisms for features that you intend to use in your app.</span></span> <span data-ttu-id="d387a-160">Jeśli na przykład nie korzystasz z ról w aplikacji, nie musisz tworzyć magazynu dla ról lub skojarzeń roli użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d387a-160">For example, if you are not using roles in your app, you don't need to create storage for roles or user role associations.</span></span> <span data-ttu-id="d387a-161">Twoja technologia i istniejąca infrastruktura mogą wymagać struktury, która różni się od domyślnej implementacji ASP.NET Core Identity .</span><span class="sxs-lookup"><span data-stu-id="d387a-161">Your technology and existing infrastructure may require a structure that's very different from the default implementation of ASP.NET Core Identity.</span></span> <span data-ttu-id="d387a-162">W warstwie dostępu do danych można zapewnić logikę do pracy ze strukturą wdrożenia magazynu.</span><span class="sxs-lookup"><span data-stu-id="d387a-162">In your data access layer, you provide the logic to work with the structure of your storage implementation.</span></span>

<span data-ttu-id="d387a-163">Warstwa dostępu do danych udostępnia logikę umożliwiającą zapisanie danych z ASP.NET Core Identity do źródła danych.</span><span class="sxs-lookup"><span data-stu-id="d387a-163">The data access layer provides the logic to save the data from ASP.NET Core Identity to a data source.</span></span> <span data-ttu-id="d387a-164">Warstwa dostępu do danych dla niestandardowego dostawcy magazynu może zawierać następujące klasy służące do przechowywania informacji o użytkowniku i roli.</span><span class="sxs-lookup"><span data-stu-id="d387a-164">The data access layer for your customized storage provider might include the following classes to store user and role information.</span></span>

### <a name="context-class"></a><span data-ttu-id="d387a-165">Context — Klasa</span><span class="sxs-lookup"><span data-stu-id="d387a-165">Context class</span></span>

<span data-ttu-id="d387a-166">Hermetyzuje informacje w celu nawiązania połączenia z mechanizmem trwałości i wykonywania zapytań.</span><span class="sxs-lookup"><span data-stu-id="d387a-166">Encapsulates the information to connect to your persistence mechanism and execute queries.</span></span> <span data-ttu-id="d387a-167">Kilka klas danych wymaga wystąpienia tej klasy, zwykle udostępnianych przez iniekcję zależności.</span><span class="sxs-lookup"><span data-stu-id="d387a-167">Several data classes require an instance of this class, typically provided through dependency injection.</span></span> <span data-ttu-id="d387a-168">[Przykład](/dotnet/api/microsoft.aspnet.identity.corecompat.identitydbcontext-1).</span><span class="sxs-lookup"><span data-stu-id="d387a-168">[Example](/dotnet/api/microsoft.aspnet.identity.corecompat.identitydbcontext-1).</span></span>

### <a name="user-storage"></a><span data-ttu-id="d387a-169">Magazyn użytkowników</span><span class="sxs-lookup"><span data-stu-id="d387a-169">User Storage</span></span>

<span data-ttu-id="d387a-170">Przechowuje i pobiera informacje o użytkowniku (takie jak nazwa użytkownika i skrót hasła).</span><span class="sxs-lookup"><span data-stu-id="d387a-170">Stores and retrieves user information (such as user name and password hash).</span></span> [<span data-ttu-id="d387a-171">Przykład</span><span class="sxs-lookup"><span data-stu-id="d387a-171">Example</span></span>](/dotnet/api/microsoft.aspnet.identity.corecompat.userstore-1)

### <a name="role-storage"></a><span data-ttu-id="d387a-172">Magazyn ról</span><span class="sxs-lookup"><span data-stu-id="d387a-172">Role Storage</span></span>

<span data-ttu-id="d387a-173">Przechowuje i pobiera informacje o rolach (takie jak nazwa roli).</span><span class="sxs-lookup"><span data-stu-id="d387a-173">Stores and retrieves role information (such as the role name).</span></span> [<span data-ttu-id="d387a-174">Przykład</span><span class="sxs-lookup"><span data-stu-id="d387a-174">Example</span></span>](/dotnet/api/microsoft.aspnetcore.identity.entityframeworkcore.rolestore-1)

### <a name="userclaims-storage"></a><span data-ttu-id="d387a-175">Magazyn UserClaims</span><span class="sxs-lookup"><span data-stu-id="d387a-175">UserClaims Storage</span></span>

<span data-ttu-id="d387a-176">Przechowuje i pobiera informacje o użytkowniku (takie jak typ i wartość żądania).</span><span class="sxs-lookup"><span data-stu-id="d387a-176">Stores and retrieves user claim information (such as the claim type and value).</span></span> [<span data-ttu-id="d387a-177">Przykład</span><span class="sxs-lookup"><span data-stu-id="d387a-177">Example</span></span>](/dotnet/api/microsoft.aspnet.identity.corecompat.userstore-1)

### <a name="userlogins-storage"></a><span data-ttu-id="d387a-178">Magazyn UserLogins</span><span class="sxs-lookup"><span data-stu-id="d387a-178">UserLogins Storage</span></span>

<span data-ttu-id="d387a-179">Przechowuje i pobiera informacje logowania użytkownika (na przykład zewnętrzny dostawca uwierzytelniania).</span><span class="sxs-lookup"><span data-stu-id="d387a-179">Stores and retrieves user login information (such as an external authentication provider).</span></span> [<span data-ttu-id="d387a-180">Przykład</span><span class="sxs-lookup"><span data-stu-id="d387a-180">Example</span></span>](/dotnet/api/microsoft.aspnet.identity.corecompat.userstore-1)

### <a name="userrole-storage"></a><span data-ttu-id="d387a-181">Przestrzeń dyskowa UserRole</span><span class="sxs-lookup"><span data-stu-id="d387a-181">UserRole Storage</span></span>

<span data-ttu-id="d387a-182">Przechowuje i pobiera przypisane role, do których użytkownicy.</span><span class="sxs-lookup"><span data-stu-id="d387a-182">Stores and retrieves which roles are assigned to which users.</span></span> [<span data-ttu-id="d387a-183">Przykład</span><span class="sxs-lookup"><span data-stu-id="d387a-183">Example</span></span>](/dotnet/api/microsoft.aspnet.identity.corecompat.userstore-1)

<span data-ttu-id="d387a-184">**Porada:** Zaimplementuj tylko klasy, które mają być używane w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d387a-184">**TIP:** Only implement the classes you intend to use in your app.</span></span>

<span data-ttu-id="d387a-185">W klasach dostępu do danych podaj kod służący do wykonywania operacji na danych dla mechanizmu trwałości.</span><span class="sxs-lookup"><span data-stu-id="d387a-185">In the data access classes, provide code to perform data operations for your persistence mechanism.</span></span> <span data-ttu-id="d387a-186">Na przykład w ramach niestandardowego dostawcy może istnieć następujący kod, aby utworzyć nowego użytkownika w klasie *magazynu* :</span><span class="sxs-lookup"><span data-stu-id="d387a-186">For example, within a custom provider, you might have the following code to create a new user in the *store* class:</span></span>

[!code-csharp[](identity-custom-storage-providers/sample/CustomIdentityProviderSample/CustomProvider/CustomUserStore.cs?name=createuser&highlight=7)]

<span data-ttu-id="d387a-187">Logika implementacji dla tworzenia użytkownika znajduje się w `_usersTable.CreateAsync` metodzie, jak pokazano poniżej.</span><span class="sxs-lookup"><span data-stu-id="d387a-187">The implementation logic for creating the user is in the `_usersTable.CreateAsync` method, shown below.</span></span>

## <a name="customize-the-user-class"></a><span data-ttu-id="d387a-188">Dostosowywanie klasy użytkownika</span><span class="sxs-lookup"><span data-stu-id="d387a-188">Customize the user class</span></span>

<span data-ttu-id="d387a-189">Podczas implementowania dostawcy magazynu należy utworzyć klasę użytkownika, która jest równoważna z [klasą IdentityUser](/dotnet/api/microsoft.aspnet.identity.corecompat.identityuser).</span><span class="sxs-lookup"><span data-stu-id="d387a-189">When implementing a storage provider, create a user class which is equivalent to the [IdentityUser class](/dotnet/api/microsoft.aspnet.identity.corecompat.identityuser).</span></span>

<span data-ttu-id="d387a-190">Co najmniej Klasa użytkownika musi zawierać `Id` `UserName` Właściwość i.</span><span class="sxs-lookup"><span data-stu-id="d387a-190">At a minimum, your user class must include an `Id` and a `UserName` property.</span></span>

<span data-ttu-id="d387a-191">`IdentityUser`Klasa definiuje właściwości, które są `UserManager` wywoływane podczas wykonywania żądanych operacji.</span><span class="sxs-lookup"><span data-stu-id="d387a-191">The `IdentityUser` class defines the properties that the `UserManager` calls when performing requested operations.</span></span> <span data-ttu-id="d387a-192">Domyślny typ `Id` właściwości jest ciągiem, ale można dziedziczyć po `IdentityUser<TKey, TUserClaim, TUserRole, TUserLogin, TUserToken>` i określić inny typ.</span><span class="sxs-lookup"><span data-stu-id="d387a-192">The default type of the `Id` property is a string, but you can inherit from `IdentityUser<TKey, TUserClaim, TUserRole, TUserLogin, TUserToken>` and specify a different type.</span></span> <span data-ttu-id="d387a-193">Platforma oczekuje implementacji magazynu do obsługi konwersji typu danych.</span><span class="sxs-lookup"><span data-stu-id="d387a-193">The framework expects the storage implementation to handle data type conversions.</span></span>

## <a name="customize-the-user-store"></a><span data-ttu-id="d387a-194">Dostosowywanie magazynu użytkowników</span><span class="sxs-lookup"><span data-stu-id="d387a-194">Customize the user store</span></span>

<span data-ttu-id="d387a-195">Utwórz `UserStore` klasę, która dostarcza metody dla wszystkich operacji na danych użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d387a-195">Create a `UserStore` class that provides the methods for all data operations on the user.</span></span> <span data-ttu-id="d387a-196">Ta klasa jest równoważna z klasą [UserStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.entityframeworkcore.userstore-1) .</span><span class="sxs-lookup"><span data-stu-id="d387a-196">This class is equivalent to the [UserStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.entityframeworkcore.userstore-1) class.</span></span> <span data-ttu-id="d387a-197">W `UserStore` klasie należy zaimplementować `IUserStore<TUser>` i opcjonalnie wymagane interfejsy.</span><span class="sxs-lookup"><span data-stu-id="d387a-197">In your `UserStore` class, implement `IUserStore<TUser>` and the optional interfaces required.</span></span> <span data-ttu-id="d387a-198">Należy wybrać opcjonalne interfejsy do wdrożenia w oparciu o funkcje dostępne w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d387a-198">You select which optional interfaces to implement based on the functionality provided in your app.</span></span>

### <a name="optional-interfaces"></a><span data-ttu-id="d387a-199">Interfejsy opcjonalne</span><span class="sxs-lookup"><span data-stu-id="d387a-199">Optional interfaces</span></span>

* [<span data-ttu-id="d387a-200">IUserRoleStore</span><span class="sxs-lookup"><span data-stu-id="d387a-200">IUserRoleStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iuserrolestore-1)
* [<span data-ttu-id="d387a-201">IUserClaimStore</span><span class="sxs-lookup"><span data-stu-id="d387a-201">IUserClaimStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iuserclaimstore-1)
* [<span data-ttu-id="d387a-202">IUserPasswordStore</span><span class="sxs-lookup"><span data-stu-id="d387a-202">IUserPasswordStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iuserpasswordstore-1)
* [<span data-ttu-id="d387a-203">IUserSecurityStampStore</span><span class="sxs-lookup"><span data-stu-id="d387a-203">IUserSecurityStampStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iusersecuritystampstore-1)
* [<span data-ttu-id="d387a-204">IUserEmailStore</span><span class="sxs-lookup"><span data-stu-id="d387a-204">IUserEmailStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iuseremailstore-1)
* [<span data-ttu-id="d387a-205">IUserPhoneNumberStore</span><span class="sxs-lookup"><span data-stu-id="d387a-205">IUserPhoneNumberStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iuserphonenumberstore-1)
* [<span data-ttu-id="d387a-206">IQueryableUserStore</span><span class="sxs-lookup"><span data-stu-id="d387a-206">IQueryableUserStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iqueryableuserstore-1)
* [<span data-ttu-id="d387a-207">IUserLoginStore</span><span class="sxs-lookup"><span data-stu-id="d387a-207">IUserLoginStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iuserloginstore-1)
* [<span data-ttu-id="d387a-208">IUserTwoFactorStore</span><span class="sxs-lookup"><span data-stu-id="d387a-208">IUserTwoFactorStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iusertwofactorstore-1)
* [<span data-ttu-id="d387a-209">IUserLockoutStore</span><span class="sxs-lookup"><span data-stu-id="d387a-209">IUserLockoutStore</span></span>](/dotnet/api/microsoft.aspnetcore.identity.iuserlockoutstore-1)

<span data-ttu-id="d387a-210">Opcjonalne interfejsy dziedziczą z `IUserStore<TUser>` .</span><span class="sxs-lookup"><span data-stu-id="d387a-210">The optional interfaces inherit from `IUserStore<TUser>`.</span></span> <span data-ttu-id="d387a-211">W [przykładowej aplikacji](https://github.com/dotnet/AspNetCore.Docs/blob/master/aspnetcore/security/authentication/identity-custom-storage-providers/sample/CustomIdentityProviderSample/CustomProvider/CustomUserStore.cs)widzisz częściowo zaimplementowany przykładowy magazyn użytkowników.</span><span class="sxs-lookup"><span data-stu-id="d387a-211">You can see a partially implemented sample user store in the [sample app](https://github.com/dotnet/AspNetCore.Docs/blob/master/aspnetcore/security/authentication/identity-custom-storage-providers/sample/CustomIdentityProviderSample/CustomProvider/CustomUserStore.cs).</span></span>

<span data-ttu-id="d387a-212">W ramach `UserStore` klasy używane są klasy dostępu do danych, które zostały utworzone w celu wykonania operacji.</span><span class="sxs-lookup"><span data-stu-id="d387a-212">Within the `UserStore` class, you use the data access classes that you created to perform operations.</span></span> <span data-ttu-id="d387a-213">Są one przenoszone przy użyciu iniekcji zależności.</span><span class="sxs-lookup"><span data-stu-id="d387a-213">These are passed in using dependency injection.</span></span> <span data-ttu-id="d387a-214">Na przykład w SQL Server z implementacją Dapper `UserStore` Klasa ma `CreateAsync` metodę, która używa wystąpienia `DapperUsersTable` do wstawienia nowego rekordu:</span><span class="sxs-lookup"><span data-stu-id="d387a-214">For example, in the SQL Server with Dapper implementation, the `UserStore` class has the `CreateAsync` method which uses an instance of `DapperUsersTable` to insert a new record:</span></span>

[!code-csharp[](identity-custom-storage-providers/sample/CustomIdentityProviderSample/CustomProvider/DapperUsersTable.cs?name=createuser&highlight=7)]

### <a name="interfaces-to-implement-when-customizing-user-store"></a><span data-ttu-id="d387a-215">Interfejsy do wdrożenia podczas dostosowywania magazynu użytkownika</span><span class="sxs-lookup"><span data-stu-id="d387a-215">Interfaces to implement when customizing user store</span></span>

* <span data-ttu-id="d387a-216">**IUserStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-216">**IUserStore**</span></span>  
 <span data-ttu-id="d387a-217">Interfejs [IUserStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iuserstore-1) jest jedynym interfejsem, który należy zaimplementować w magazynie użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d387a-217">The [IUserStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iuserstore-1) interface is the only interface you must implement in the user store.</span></span> <span data-ttu-id="d387a-218">Definiuje on metody tworzenia, aktualizowania, usuwania i pobierania użytkowników.</span><span class="sxs-lookup"><span data-stu-id="d387a-218">It defines methods for creating, updating, deleting, and retrieving users.</span></span>
* <span data-ttu-id="d387a-219">**IUserClaimStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-219">**IUserClaimStore**</span></span>  
 <span data-ttu-id="d387a-220">Interfejs [IUserClaimStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iuserclaimstore-1) definiuje metody implementowane w celu włączenia oświadczeń użytkowników.</span><span class="sxs-lookup"><span data-stu-id="d387a-220">The [IUserClaimStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iuserclaimstore-1) interface defines the methods you implement to enable user claims.</span></span> <span data-ttu-id="d387a-221">Zawiera metody dodawania, usuwania i pobierania oświadczeń użytkowników.</span><span class="sxs-lookup"><span data-stu-id="d387a-221">It contains methods for adding, removing and retrieving user claims.</span></span>
* <span data-ttu-id="d387a-222">**IUserLoginStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-222">**IUserLoginStore**</span></span>  
 <span data-ttu-id="d387a-223">[IUserLoginStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iuserloginstore-1) definiuje metody implementowane w celu umożliwienia zewnętrznym dostawcom uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="d387a-223">The [IUserLoginStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iuserloginstore-1) defines the methods you implement to enable external authentication providers.</span></span> <span data-ttu-id="d387a-224">Zawiera metody dodawania, usuwania i pobierania identyfikatorów logowania użytkowników oraz metoda pobierania użytkownika na podstawie informacji logowania.</span><span class="sxs-lookup"><span data-stu-id="d387a-224">It contains methods for adding, removing and retrieving user logins, and a method for retrieving a user based on the login information.</span></span>
* <span data-ttu-id="d387a-225">**IUserRoleStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-225">**IUserRoleStore**</span></span>  
 <span data-ttu-id="d387a-226">Interfejs [IUserRoleStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iuserrolestore-1) definiuje metody implementowane w celu zamapowania użytkownika na rolę.</span><span class="sxs-lookup"><span data-stu-id="d387a-226">The [IUserRoleStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iuserrolestore-1) interface defines the methods you implement to map a user to a role.</span></span> <span data-ttu-id="d387a-227">Zawiera on metody dodawania, usuwania i pobierania ról użytkownika oraz metodę sprawdzania, czy użytkownik jest przypisany do roli.</span><span class="sxs-lookup"><span data-stu-id="d387a-227">It contains methods to add, remove, and retrieve a user's roles, and a method to check if a user is assigned to a role.</span></span>
* <span data-ttu-id="d387a-228">**IUserPasswordStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-228">**IUserPasswordStore**</span></span>  
 <span data-ttu-id="d387a-229">Interfejs [IUserPasswordStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iuserpasswordstore-1) definiuje metody implementowane w celu utrwalenia haseł z mieszaniem.</span><span class="sxs-lookup"><span data-stu-id="d387a-229">The [IUserPasswordStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iuserpasswordstore-1) interface defines the methods you implement to persist hashed passwords.</span></span> <span data-ttu-id="d387a-230">Zawiera on metody pobierania i ustawiania skrótu hasła oraz metodę, która wskazuje, czy użytkownik ustawił hasło.</span><span class="sxs-lookup"><span data-stu-id="d387a-230">It contains methods for getting and setting the hashed password, and a method that indicates whether the user has set a password.</span></span>
* <span data-ttu-id="d387a-231">**IUserSecurityStampStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-231">**IUserSecurityStampStore**</span></span>  
 <span data-ttu-id="d387a-232">Interfejs [IUserSecurityStampStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iusersecuritystampstore-1) definiuje metody implementowane w celu użycia sygnatury zabezpieczeń w celu wskazania, czy informacje o koncie użytkownika zostały zmienione.</span><span class="sxs-lookup"><span data-stu-id="d387a-232">The [IUserSecurityStampStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iusersecuritystampstore-1) interface defines the methods you implement to use a security stamp for indicating whether the user's account information has changed.</span></span> <span data-ttu-id="d387a-233">Ta sygnatura jest aktualizowana, gdy użytkownik zmienia hasło lub dodaje lub usuwa logowania.</span><span class="sxs-lookup"><span data-stu-id="d387a-233">This stamp is updated when a user changes the password, or adds or removes logins.</span></span> <span data-ttu-id="d387a-234">Zawiera on metody pobierania i ustawiania sygnatury zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="d387a-234">It contains methods for getting and setting the security stamp.</span></span>
* <span data-ttu-id="d387a-235">**IUserTwoFactorStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-235">**IUserTwoFactorStore**</span></span>  
 <span data-ttu-id="d387a-236">Interfejs [IUserTwoFactorStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iusertwofactorstore-1) definiuje metody implementowane w celu obsługi uwierzytelniania dwuskładnikowego.</span><span class="sxs-lookup"><span data-stu-id="d387a-236">The [IUserTwoFactorStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iusertwofactorstore-1) interface defines the methods you implement to support two factor authentication.</span></span> <span data-ttu-id="d387a-237">Zawiera on metody umożliwiające pobieranie i określanie, czy uwierzytelnianie dwuskładnikowe jest włączone dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d387a-237">It contains methods for getting and setting whether two factor authentication is enabled for a user.</span></span>
* <span data-ttu-id="d387a-238">**IUserPhoneNumberStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-238">**IUserPhoneNumberStore**</span></span>  
 <span data-ttu-id="d387a-239">Interfejs [IUserPhoneNumberStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iuserphonenumberstore-1) definiuje metody, które są implementowane w celu przechowywania numerów telefonów użytkowników.</span><span class="sxs-lookup"><span data-stu-id="d387a-239">The [IUserPhoneNumberStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iuserphonenumberstore-1) interface defines the methods you implement to store user phone numbers.</span></span> <span data-ttu-id="d387a-240">Zawiera on metody pobierania i ustawiania numeru telefonu oraz tego, czy numer telefonu został potwierdzony.</span><span class="sxs-lookup"><span data-stu-id="d387a-240">It contains methods for getting and setting the phone number and whether the phone number is confirmed.</span></span>
* <span data-ttu-id="d387a-241">**IUserEmailStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-241">**IUserEmailStore**</span></span>  
 <span data-ttu-id="d387a-242">Interfejs [IUserEmailStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iuseremailstore-1) definiuje metody implementowane w celu przechowywania adresów e-mail użytkowników.</span><span class="sxs-lookup"><span data-stu-id="d387a-242">The [IUserEmailStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iuseremailstore-1) interface defines the methods you implement to store user email addresses.</span></span> <span data-ttu-id="d387a-243">Zawiera on metody pobierania i ustawiania adresu e-mail oraz tego, czy wiadomość e-mail została potwierdzona.</span><span class="sxs-lookup"><span data-stu-id="d387a-243">It contains methods for getting and setting the email address and whether the email is confirmed.</span></span>
* <span data-ttu-id="d387a-244">**IUserLockoutStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-244">**IUserLockoutStore**</span></span>  
 <span data-ttu-id="d387a-245">Interfejs [IUserLockoutStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iuserlockoutstore-1) definiuje metody implementowane w celu przechowywania informacji o blokowaniu konta.</span><span class="sxs-lookup"><span data-stu-id="d387a-245">The [IUserLockoutStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iuserlockoutstore-1) interface defines the methods you implement to store information about locking an account.</span></span> <span data-ttu-id="d387a-246">Zawiera metody śledzenia nieudanych prób dostępu i blokad.</span><span class="sxs-lookup"><span data-stu-id="d387a-246">It contains methods for tracking failed access attempts and lockouts.</span></span>
* <span data-ttu-id="d387a-247">**IQueryableUserStore**</span><span class="sxs-lookup"><span data-stu-id="d387a-247">**IQueryableUserStore**</span></span>  
 <span data-ttu-id="d387a-248">Interfejs [IQueryableUserStore &lt; TUser &gt; ](/dotnet/api/microsoft.aspnetcore.identity.iqueryableuserstore-1) definiuje elementy członkowskie, które są implementowane w celu udostępnienia magazynu użytkownika queryable.</span><span class="sxs-lookup"><span data-stu-id="d387a-248">The [IQueryableUserStore&lt;TUser&gt;](/dotnet/api/microsoft.aspnetcore.identity.iqueryableuserstore-1) interface defines the members you implement to provide a queryable user store.</span></span>

<span data-ttu-id="d387a-249">Implementowane są tylko interfejsy, które są potrzebne w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d387a-249">You implement only the interfaces that are needed in your app.</span></span> <span data-ttu-id="d387a-250">Przykład:</span><span class="sxs-lookup"><span data-stu-id="d387a-250">For example:</span></span>

```csharp
public class UserStore : IUserStore<IdentityUser>,
                         IUserClaimStore<IdentityUser>,
                         IUserLoginStore<IdentityUser>,
                         IUserRoleStore<IdentityUser>,
                         IUserPasswordStore<IdentityUser>,
                         IUserSecurityStampStore<IdentityUser>
{
    // interface implementations not shown
}
```

### <a name="identityuserclaim-identityuserlogin-and-identityuserrole"></a><span data-ttu-id="d387a-251">IdentityUserClaim, IdentityUserLogin i IdentityUserRole</span><span class="sxs-lookup"><span data-stu-id="d387a-251">IdentityUserClaim, IdentityUserLogin, and IdentityUserRole</span></span>

<span data-ttu-id="d387a-252">`Microsoft.AspNet.Identity.EntityFramework`Przestrzeń nazw zawiera implementacje klas [IdentityUserClaim](/dotnet/api/microsoft.aspnetcore.identity.entityframeworkcore.identityuserclaim-1), [IdentityUserLogin](/dotnet/api/microsoft.aspnet.identity.corecompat.identityuserlogin)i [IdentityUserRole](/dotnet/api/microsoft.aspnetcore.identity.entityframeworkcore.identityuserrole-1) .</span><span class="sxs-lookup"><span data-stu-id="d387a-252">The `Microsoft.AspNet.Identity.EntityFramework` namespace contains implementations of the [IdentityUserClaim](/dotnet/api/microsoft.aspnetcore.identity.entityframeworkcore.identityuserclaim-1), [IdentityUserLogin](/dotnet/api/microsoft.aspnet.identity.corecompat.identityuserlogin), and [IdentityUserRole](/dotnet/api/microsoft.aspnetcore.identity.entityframeworkcore.identityuserrole-1) classes.</span></span> <span data-ttu-id="d387a-253">Jeśli używasz tych funkcji, możesz chcieć utworzyć własne wersje tych klas i zdefiniować właściwości aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d387a-253">If you are using these features, you may want to create your own versions of these classes and define the properties for your app.</span></span> <span data-ttu-id="d387a-254">Czasami jednak wydajniejsze jest, aby nie ładować tych jednostek do pamięci podczas wykonywania podstawowych operacji (takich jak dodawanie lub usuwanie roszczeń użytkownika).</span><span class="sxs-lookup"><span data-stu-id="d387a-254">However, sometimes it's more efficient to not load these entities into memory when performing basic operations (such as adding or removing a user's claim).</span></span> <span data-ttu-id="d387a-255">Zamiast tego klasy magazynu zaplecza mogą wykonywać te operacje bezpośrednio w źródle danych.</span><span class="sxs-lookup"><span data-stu-id="d387a-255">Instead, the backend store classes can execute these operations directly on the data source.</span></span> <span data-ttu-id="d387a-256">Na przykład `UserStore.GetClaimsAsync` Metoda może wywołać `userClaimTable.FindByUserId(user.Id)` metodę, aby wykonać zapytanie bezpośrednio względem tej tabeli i zwrócić listę oświadczeń.</span><span class="sxs-lookup"><span data-stu-id="d387a-256">For example, the `UserStore.GetClaimsAsync` method can call the `userClaimTable.FindByUserId(user.Id)` method to execute a query on that table directly and return a list of claims.</span></span>

## <a name="customize-the-role-class"></a><span data-ttu-id="d387a-257">Dostosowywanie klasy roli</span><span class="sxs-lookup"><span data-stu-id="d387a-257">Customize the role class</span></span>

<span data-ttu-id="d387a-258">Podczas implementowania dostawcy magazynu roli można utworzyć niestandardowy typ roli.</span><span class="sxs-lookup"><span data-stu-id="d387a-258">When implementing a role storage provider, you can create a custom role type.</span></span> <span data-ttu-id="d387a-259">Nie musi implementować określonego interfejsu, ale musi mieć, `Id` a zazwyczaj będzie miał `Name` Właściwość.</span><span class="sxs-lookup"><span data-stu-id="d387a-259">It need not implement a particular interface, but it must have an `Id` and typically it will have a `Name` property.</span></span>

<span data-ttu-id="d387a-260">Poniżej przedstawiono przykładową klasę roli:</span><span class="sxs-lookup"><span data-stu-id="d387a-260">The following is an example role class:</span></span>

[!code-csharp[](identity-custom-storage-providers/sample/CustomIdentityProviderSample/CustomProvider/ApplicationRole.cs)]

## <a name="customize-the-role-store"></a><span data-ttu-id="d387a-261">Dostosowywanie magazynu ról</span><span class="sxs-lookup"><span data-stu-id="d387a-261">Customize the role store</span></span>

<span data-ttu-id="d387a-262">Można utworzyć `RoleStore` klasę, która dostarcza metody dla wszystkich operacji na danych na rolach.</span><span class="sxs-lookup"><span data-stu-id="d387a-262">You can create a `RoleStore` class that provides the methods for all data operations on roles.</span></span> <span data-ttu-id="d387a-263">Ta klasa jest równoważna z klasą [RoleStore &lt; TRole &gt; ](/dotnet/api/microsoft.aspnetcore.identity.entityframeworkcore.rolestore-1) .</span><span class="sxs-lookup"><span data-stu-id="d387a-263">This class is equivalent to the [RoleStore&lt;TRole&gt;](/dotnet/api/microsoft.aspnetcore.identity.entityframeworkcore.rolestore-1) class.</span></span> <span data-ttu-id="d387a-264">W `RoleStore` klasie należy zaimplementować `IRoleStore<TRole>` interfejs i opcjonalnie `IQueryableRoleStore<TRole>` .</span><span class="sxs-lookup"><span data-stu-id="d387a-264">In the `RoleStore` class, you implement the `IRoleStore<TRole>` and optionally the `IQueryableRoleStore<TRole>` interface.</span></span>

* <span data-ttu-id="d387a-265">**IRoleStore &lt; TRole&gt;**</span><span class="sxs-lookup"><span data-stu-id="d387a-265">**IRoleStore&lt;TRole&gt;**</span></span>  
 <span data-ttu-id="d387a-266">Interfejs [IRoleStore &lt; TRole &gt; ](/dotnet/api/microsoft.aspnetcore.identity.irolestore-1) definiuje metody do zaimplementowania w klasie magazynu ról.</span><span class="sxs-lookup"><span data-stu-id="d387a-266">The [IRoleStore&lt;TRole&gt;](/dotnet/api/microsoft.aspnetcore.identity.irolestore-1) interface defines the methods to implement in the role store class.</span></span> <span data-ttu-id="d387a-267">Zawiera on metody tworzenia, aktualizowania, usuwania i pobierania ról.</span><span class="sxs-lookup"><span data-stu-id="d387a-267">It contains methods for creating, updating, deleting, and retrieving roles.</span></span>
* <span data-ttu-id="d387a-268">**RoleStore &lt; TRole&gt;**</span><span class="sxs-lookup"><span data-stu-id="d387a-268">**RoleStore&lt;TRole&gt;**</span></span>  
 <span data-ttu-id="d387a-269">Aby dostosować `RoleStore` , należy utworzyć klasę, która implementuje `IRoleStore<TRole>` interfejs.</span><span class="sxs-lookup"><span data-stu-id="d387a-269">To customize `RoleStore`, create a class that implements the `IRoleStore<TRole>` interface.</span></span> 

## <a name="reconfigure-app-to-use-a-new-storage-provider"></a><span data-ttu-id="d387a-270">Zmień konfigurację aplikacji tak, aby korzystała z nowego dostawcy magazynu</span><span class="sxs-lookup"><span data-stu-id="d387a-270">Reconfigure app to use a new storage provider</span></span>

<span data-ttu-id="d387a-271">Po zaimplementowaniu dostawcy magazynu należy skonfigurować aplikację do korzystania z niej.</span><span class="sxs-lookup"><span data-stu-id="d387a-271">Once you have implemented a storage provider, you configure your app to use it.</span></span> <span data-ttu-id="d387a-272">Jeśli aplikacja użyła domyślnego dostawcy, Zastąp ją własnym dostawcą.</span><span class="sxs-lookup"><span data-stu-id="d387a-272">If your app used the default provider, replace it with your custom provider.</span></span>

1. <span data-ttu-id="d387a-273">Usuń `Microsoft.AspNetCore.EntityFramework.Identity` pakiet NuGet.</span><span class="sxs-lookup"><span data-stu-id="d387a-273">Remove the `Microsoft.AspNetCore.EntityFramework.Identity` NuGet package.</span></span>
1. <span data-ttu-id="d387a-274">Jeśli dostawca magazynu znajduje się w osobnym projekcie lub pakiecie, Dodaj odwołanie do niego.</span><span class="sxs-lookup"><span data-stu-id="d387a-274">If the storage provider resides in a separate project or package, add a reference to it.</span></span>
1. <span data-ttu-id="d387a-275">Zastąp wszystkie odwołania do za pomocą `Microsoft.AspNetCore.EntityFramework.Identity` instrukcji using dla przestrzeni nazw dostawcy magazynu.</span><span class="sxs-lookup"><span data-stu-id="d387a-275">Replace all references to `Microsoft.AspNetCore.EntityFramework.Identity` with a using statement for the namespace of your storage provider.</span></span>
1. <span data-ttu-id="d387a-276">W `ConfigureServices` metodzie Zmień metodę, `AddIdentity` tak aby korzystała z typów niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="d387a-276">In the `ConfigureServices` method, change the `AddIdentity` method to use your custom types.</span></span> <span data-ttu-id="d387a-277">W tym celu można utworzyć własne metody rozszerzenia.</span><span class="sxs-lookup"><span data-stu-id="d387a-277">You can create your own extension methods for this purpose.</span></span> <span data-ttu-id="d387a-278">Zapoznaj się z przykładem [IdentityServiceCollectionExtensions](https://github.com/aspnet/Identity/blob/rel/1.1.0/src/Microsoft.AspNetCore.Identity/IdentityServiceCollectionExtensions.cs) .</span><span class="sxs-lookup"><span data-stu-id="d387a-278">See [IdentityServiceCollectionExtensions](https://github.com/aspnet/Identity/blob/rel/1.1.0/src/Microsoft.AspNetCore.Identity/IdentityServiceCollectionExtensions.cs) for an example.</span></span>
1. <span data-ttu-id="d387a-279">Jeśli używasz ról, zaktualizuj, `RoleManager` Aby użyć `RoleStore` klasy.</span><span class="sxs-lookup"><span data-stu-id="d387a-279">If you are using Roles, update the `RoleManager` to use your `RoleStore` class.</span></span>
1. <span data-ttu-id="d387a-280">Zaktualizuj parametry połączenia i poświadczenia do konfiguracji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d387a-280">Update the connection string and credentials to your app's configuration.</span></span>

<span data-ttu-id="d387a-281">Przykład:</span><span class="sxs-lookup"><span data-stu-id="d387a-281">Example:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    // Add identity types
    services.AddIdentity<ApplicationUser, ApplicationRole>()
        .AddDefaultTokenProviders();

    // Identity Services
    services.AddTransient<IUserStore<ApplicationUser>, CustomUserStore>();
    services.AddTransient<IRoleStore<ApplicationRole>, CustomRoleStore>();
    string connectionString = Configuration.GetConnectionString("DefaultConnection");
    services.AddTransient<SqlConnection>(e => new SqlConnection(connectionString));
    services.AddTransient<DapperUsersTable>();

    // additional configuration
}
```

## <a name="references"></a><span data-ttu-id="d387a-282">Odwołania</span><span class="sxs-lookup"><span data-stu-id="d387a-282">References</span></span>

* <span data-ttu-id="d387a-283">[Niestandardowi dostawcy magazynu dla ASP.NET 4. xIdentity](/aspnet/identity/overview/extensibility/overview-of-custom-storage-providers-for-aspnet-identity)</span><span class="sxs-lookup"><span data-stu-id="d387a-283">[Custom Storage Providers for ASP.NET 4.x Identity](/aspnet/identity/overview/extensibility/overview-of-custom-storage-providers-for-aspnet-identity)</span></span>
* <span data-ttu-id="d387a-284">[ASP.NET Core Identity ](https://github.com/dotnet/AspNetCore/tree/master/src/Identity): to repozytorium zawiera linki do dostawców sklepu obsługiwanego przez społeczność.</span><span class="sxs-lookup"><span data-stu-id="d387a-284">[ASP.NET Core Identity](https://github.com/dotnet/AspNetCore/tree/master/src/Identity): This repository includes links to community maintained store providers.</span></span>
