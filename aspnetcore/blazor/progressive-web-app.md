---
title: Tworzenie progresywnych aplikacji sieci Web Blazor za pomocą ASP.NET Core WebAssembly
author: guardrex
description: Dowiedz się, Blazorjak utworzyć opartą na bazie progresywną aplikację sieci Web (PWA), która używa nowoczesnych funkcji przeglądarki, aby zachowywać się jak aplikacja klasyczna.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/23/2020
no-loc:
- Blazor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: fe69e51aefae9c80e5bb4b78151d384ce25d41a7
ms.sourcegitcommit: f7886fd2e219db9d7ce27b16c0dc5901e658d64e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2020
ms.locfileid: "80218950"
---
# <a name="build-progressive-web-applications-with-aspnet-core-blazor-webassembly"></a><span data-ttu-id="a051a-103">Tworzenie progresywnych aplikacji sieci Web za pomocą ASP.NET Core Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="a051a-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="a051a-104">Przez [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="a051a-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

<span data-ttu-id="a051a-105">Progressive Web Application (PWA) to aplikacja jednostronicowa (SPA), która używa nowoczesnych interfejsów API przeglądarki i możliwości zachowywania się jak aplikacja klasyczna.</span><span class="sxs-lookup"><span data-stu-id="a051a-105">A Progressive Web Application (PWA) is a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> <span data-ttu-id="a051a-106">Blazor WebAssembly jest opartą na standardach platformą aplikacji internetowych po stronie klienta, dzięki czemu może korzystać z dowolnego interfejsu API przeglądarki, w tym interfejsów API PWA wymaganych dla następujących możliwości:</span><span class="sxs-lookup"><span data-stu-id="a051a-106">Blazor WebAssembly is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="a051a-107">Praca w trybie offline i ładowanie natychmiast, niezależnie od szybkości sieci.</span><span class="sxs-lookup"><span data-stu-id="a051a-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="a051a-108">Uruchamianie w swoim własnym oknie aplikacji, a nie tylko w oknie przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="a051a-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="a051a-109">Uruchamiany z menu startowego systemu operacyjnego hosta, stacji dokującej lub ekranu głównego.</span><span class="sxs-lookup"><span data-stu-id="a051a-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="a051a-110">Odbieranie powiadomień wypychanych z serwera wewnętrznej bazy danych, nawet jeśli użytkownik nie korzysta z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="a051a-111">Automatyczne aktualizowanie w tle.</span><span class="sxs-lookup"><span data-stu-id="a051a-111">Automatically updating in the background.</span></span>

<span data-ttu-id="a051a-112">Słowo *progressive* jest używane do opisywania takich aplikacji, ponieważ:</span><span class="sxs-lookup"><span data-stu-id="a051a-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="a051a-113">Użytkownik może najpierw odkryć i korzystać z aplikacji w przeglądarce internetowej, jak każdy inny SPA.</span><span class="sxs-lookup"><span data-stu-id="a051a-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="a051a-114">Później użytkownik przechodzi do instalowania go w swoim os i włączania powiadomień wypychanych.</span><span class="sxs-lookup"><span data-stu-id="a051a-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="a051a-115">Tworzenie projektu na podstawie szablonu programu PWA</span><span class="sxs-lookup"><span data-stu-id="a051a-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="a051a-116">Program Visual Studio</span><span class="sxs-lookup"><span data-stu-id="a051a-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="a051a-117">Podczas tworzenia nowej **aplikacji Blazor WebAssembly** w oknie **dialogowym Tworzenie nowego projektu** zaznacz pole wyboru Progress Web **Application:**</span><span class="sxs-lookup"><span data-stu-id="a051a-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progress Web Application** check box:</span></span>

![Pole wyboru "Progresywna aplikacja sieci Web" jest zaznaczone w oknie dialogowym nowego projektu programu Visual Studio.](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="a051a-119">Kod programu Visual Studio / .NET Core CLI</span><span class="sxs-lookup"><span data-stu-id="a051a-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="a051a-120">Utwórz projekt programu PWA w `--pwa` powłoce poleceń za pomocą przełącznika:</span><span class="sxs-lookup"><span data-stu-id="a051a-120">Create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyNewProject --pwa
```

---

<span data-ttu-id="a051a-121">Opcjonalnie program PWA można skonfigurować dla aplikacji utworzonej na podstawie szablonu hostowanego ASP.NET rdzenia.</span><span class="sxs-lookup"><span data-stu-id="a051a-121">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="a051a-122">Scenariusz programu PWA jest niezależny od modelu hostingu.</span><span class="sxs-lookup"><span data-stu-id="a051a-122">The PWA scenario is independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="a051a-123">Instalacja i manifest aplikacji</span><span class="sxs-lookup"><span data-stu-id="a051a-123">Installation and app manifest</span></span>

<span data-ttu-id="a051a-124">Podczas odwiedzania aplikacji utworzonej przy użyciu szablonu PROGRAMU PWA użytkownicy mają możliwość zainstalowania aplikacji w menu start systemu operacyjnego, stacji dokującej lub ekranie głównym.</span><span class="sxs-lookup"><span data-stu-id="a051a-124">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="a051a-125">Sposób prezentacji tej opcji zależy od przeglądarki użytkownika.</span><span class="sxs-lookup"><span data-stu-id="a051a-125">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="a051a-126">W przypadku korzystania z przeglądarek opartych na chromie na komputerach stacjonarnych, takich jak Edge lub Chrome, na pasku adresu URL pojawia się przycisk **Dodaj.**</span><span class="sxs-lookup"><span data-stu-id="a051a-126">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="a051a-127">Po wybraniu przycisku **Dodaj** użytkownik otrzymuje okno dialogowe potwierdzenia:</span><span class="sxs-lookup"><span data-stu-id="a051a-127">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![Diaglog potwierdzenia w Google Chrome przedstawia przycisk Zainstaluj dla użytkownika dla aplikacji "MyBlazorPwa".](progressive-web-app/_static/image2.png)

<span data-ttu-id="a051a-129">W przypadku systemu iOS użytkownicy mogą zainstalować program PWA za pomocą przycisku **Udostępnij** w przeglądarce Safari i opcji **Dodaj do ekranu głównego.**</span><span class="sxs-lookup"><span data-stu-id="a051a-129">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="a051a-130">W Chrome dla Androida użytkownicy powinni wybrać przycisk **Menu** w prawym górnym rogu, a następnie **dodaj do ekranu głównego**.</span><span class="sxs-lookup"><span data-stu-id="a051a-130">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="a051a-131">Po zainstalowaniu aplikacja pojawia się we własnym oknie bez paska adresu:</span><span class="sxs-lookup"><span data-stu-id="a051a-131">Once installed, the app appears in its own window without an address bar:</span></span>

![Aplikacja "MyBlazorPwa" działa w Google Chrome bez paska adresu.](progressive-web-app/_static/image3.png)

<span data-ttu-id="a051a-133">Aby dostosować tytuł okna, schemat kolorów, ikonę lub inne szczegóły, zobacz plik *manifest.json* w katalogu *wwwroot* projektu.</span><span class="sxs-lookup"><span data-stu-id="a051a-133">To customize the window's title, color scheme, icon, or other details, see the *manifest.json* file in the project's *wwwroot* directory.</span></span> <span data-ttu-id="a051a-134">Schemat tego pliku jest zdefiniowany przez standardy sieci web.</span><span class="sxs-lookup"><span data-stu-id="a051a-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="a051a-135">Aby uzyskać więcej informacji, zobacz [dokumenty sieci Web MDN: Manifest aplikacji sieci Web](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="a051a-135">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="a051a-136">Obsługa w trybie offline</span><span class="sxs-lookup"><span data-stu-id="a051a-136">Offline support</span></span>

<span data-ttu-id="a051a-137">Domyślnie aplikacje utworzone przy użyciu opcji szablonu programu PWA mają obsługę uruchamiania w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="a051a-137">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="a051a-138">Użytkownik musi najpierw odwiedzić aplikację, gdy jest w trybie online.</span><span class="sxs-lookup"><span data-stu-id="a051a-138">A user must first visit the app while they're online.</span></span> <span data-ttu-id="a051a-139">Przeglądarka automatycznie pobiera i buforuje wszystkie zasoby wymagane do pracy w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="a051a-139">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a051a-140">Wsparcie rozwoju kolidowałoby ze zwykłym cyklem rozwoju wprowadzania zmian i testowania ich.</span><span class="sxs-lookup"><span data-stu-id="a051a-140">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="a051a-141">W związku z tym obsługa w trybie offline jest włączona tylko dla *opublikowanych* aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-141">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="a051a-142">Jeśli zamierzasz rozpowszechniać program PWA z obsługą trybu offline, istnieje [kilka ważnych ostrzeżeń i zastrzeżeń.](#caveats-for-offline-pwas)</span><span class="sxs-lookup"><span data-stu-id="a051a-142">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="a051a-143">Te scenariusze są związane z programem BlazorPWA w trybie offline i nie są specyficzne dla .</span><span class="sxs-lookup"><span data-stu-id="a051a-143">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="a051a-144">Pamiętaj, aby przeczytać i zrozumieć te zastrzeżenia przed podjęciem założeń dotyczących działania aplikacji obsługującej tryb offline.</span><span class="sxs-lookup"><span data-stu-id="a051a-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="a051a-145">Aby zobaczyć, jak działa pomoc techniczna w trybie offline:</span><span class="sxs-lookup"><span data-stu-id="a051a-145">To see how offline support works:</span></span>

1. <span data-ttu-id="a051a-146">Opublikuj aplikację.</span><span class="sxs-lookup"><span data-stu-id="a051a-146">Publish the app.</span></span> <span data-ttu-id="a051a-147">Aby uzyskać więcej informacji, zobacz <xref:host-and-deploy/blazor/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="a051a-147">For more information, see <xref:host-and-deploy/blazor/index#publish-the-app>.</span></span>
1. <span data-ttu-id="a051a-148">Wdrażanie aplikacji na serwerze obsługującym protokół HTTPS i uzyskiwanie dostępu do aplikacji w przeglądarce pod jej bezpiecznym adresem HTTPS.</span><span class="sxs-lookup"><span data-stu-id="a051a-148">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="a051a-149">Otwórz narzędzia deweloperskie przeglądarki i sprawdź, czy *pracownik serwisu* jest zarejestrowany dla hosta na karcie **Aplikacja:**</span><span class="sxs-lookup"><span data-stu-id="a051a-149">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![Karta "Aplikacja" narzędzi programistycznych Google Chrome pokazuje, że pracownik serwisu jest aktywowany i uruchomiony.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="a051a-151">Przeładuj ponownie stronę i sprawdź kartę **Sieć.** **Pracownik serwisu** lub **pamięć podręczna** są wymienione jako źródła wszystkich zasobów strony:</span><span class="sxs-lookup"><span data-stu-id="a051a-151">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![Karta "Sieć" narzędzi programistycznych Google Chrome z pokasamy źródeł wszystkich zasobów strony.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="a051a-153">Aby sprawdzić, czy przeglądarka nie jest zależna od dostępu do sieci, aby załadować aplikację, :</span><span class="sxs-lookup"><span data-stu-id="a051a-153">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="a051a-154">Zamknij serwer www i zobacz, jak aplikacja nadal działa normalnie, co obejmuje ponowne ładowanie strony.</span><span class="sxs-lookup"><span data-stu-id="a051a-154">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="a051a-155">Podobnie aplikacja nadal działa normalnie, gdy istnieje wolne połączenie sieciowe.</span><span class="sxs-lookup"><span data-stu-id="a051a-155">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="a051a-156">Poinstruuj przeglądarkę, aby symulowała tryb offline na karcie **Sieć:**</span><span class="sxs-lookup"><span data-stu-id="a051a-156">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![Karta "Sieć" narzędzi programistycznych Google Chrome z rozwijanym trybem przeglądarki została zmieniona z "Online" na "Offline".](progressive-web-app/_static/image6.png)

<span data-ttu-id="a051a-158">Obsługa w trybie offline przy użyciu pracownika Blazorserwisu jest standardem sieci web, niespecyficznym dla .</span><span class="sxs-lookup"><span data-stu-id="a051a-158">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="a051a-159">Aby uzyskać więcej informacji na temat pracowników serwisu, zobacz [dokumenty sieci Web MDN: Interfejs API procesu roboczego usługi](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="a051a-159">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="a051a-160">Aby dowiedzieć się więcej na temat typowych wzorców użycia dla pracowników serwisu, zobacz [Google Web: Cykl życia pracownika serwisu](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="a051a-160">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

Blazor<span data-ttu-id="a051a-161">'s SZABLON PWA tworzy dwa pliki pracownika serwisu:</span><span class="sxs-lookup"><span data-stu-id="a051a-161">'s PWA template produces two service worker files:</span></span>

* <span data-ttu-id="a051a-162">*wwwroot/service-worker.js*, który jest używany podczas rozwoju.</span><span class="sxs-lookup"><span data-stu-id="a051a-162">*wwwroot/service-worker.js*, which is used during development.</span></span>
* <span data-ttu-id="a051a-163">*wwwroot/service-worker.published.js*, który jest używany po opublikowaniu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-163">*wwwroot/service-worker.published.js*, which is used after the app is published.</span></span>

<span data-ttu-id="a051a-164">Aby udostępnić logikę między dwoma plikami procesu roboczego usługi, należy wziąć pod uwagę następujące podejście:</span><span class="sxs-lookup"><span data-stu-id="a051a-164">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="a051a-165">Dodaj trzeci plik JavaScript, aby pomieścić wspólną logikę.</span><span class="sxs-lookup"><span data-stu-id="a051a-165">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="a051a-166">Użyj [self.importScripts,](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) aby załadować wspólną logikę do obu plików procesu roboczego usługi.</span><span class="sxs-lookup"><span data-stu-id="a051a-166">Use [self.importScripts](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="a051a-167">Strategia pobierania pamięci podręcznej</span><span class="sxs-lookup"><span data-stu-id="a051a-167">Cache-first fetch strategy</span></span>

<span data-ttu-id="a051a-168">Wbudowany proces *service-worker.published.js* rozpoznaje żądania przy użyciu strategii *pamięci podręcznej.*</span><span class="sxs-lookup"><span data-stu-id="a051a-168">The built-in *service-worker.published.js* service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="a051a-169">Oznacza to, że pracownik usługi woli zwracać zawartość buforowaną, niezależnie od tego, czy użytkownik ma dostęp do sieci, czy nowsza zawartość jest dostępna na serwerze.</span><span class="sxs-lookup"><span data-stu-id="a051a-169">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="a051a-170">Strategia pamięci podręcznej jest cenna, ponieważ:</span><span class="sxs-lookup"><span data-stu-id="a051a-170">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="a051a-171">**Zapewnia niezawodność.**</span><span class="sxs-lookup"><span data-stu-id="a051a-171">**It ensures reliability.**</span></span> <span data-ttu-id="a051a-172">&ndash;Dostęp do sieci nie jest stanem logicznym.</span><span class="sxs-lookup"><span data-stu-id="a051a-172">&ndash; Network access isn't a boolean state.</span></span> <span data-ttu-id="a051a-173">Użytkownik nie jest po prostu w trybie online lub offline:</span><span class="sxs-lookup"><span data-stu-id="a051a-173">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="a051a-174">Urządzenie użytkownika może zakładać, że jest w trybie online, ale sieć może być tak powolna, że niepraktyczne czekać.</span><span class="sxs-lookup"><span data-stu-id="a051a-174">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="a051a-175">Sieć może zwracać nieprawidłowe wyniki dla niektórych adresów URL, na przykład gdy istnieje wbudowany portal WIFI, który obecnie blokuje lub przekierowuje określone żądania.</span><span class="sxs-lookup"><span data-stu-id="a051a-175">The network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="a051a-176">Dlatego `navigator.onLine` interfejs API przeglądarki nie jest niezawodny i nie powinien być uzależniony od.</span><span class="sxs-lookup"><span data-stu-id="a051a-176">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="a051a-177">**Zapewnia poprawność.**</span><span class="sxs-lookup"><span data-stu-id="a051a-177">**It ensures correctness.**</span></span> <span data-ttu-id="a051a-178">&ndash;Podczas tworzenia pamięci podręcznej zasobów w trybie offline, pracownik usługi używa mieszania zawartości, aby zagwarantować, że pobrano pełną i samowystarczajną migawkę zasobów w jednej chwili w czasie.</span><span class="sxs-lookup"><span data-stu-id="a051a-178">&ndash; When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="a051a-179">Ta pamięć podręczna jest następnie używana jako jednostka atomowa.</span><span class="sxs-lookup"><span data-stu-id="a051a-179">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="a051a-180">Nie ma sensu pytać sieci o nowsze zasoby, ponieważ tylko wymagane wersje są już buforowane.</span><span class="sxs-lookup"><span data-stu-id="a051a-180">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="a051a-181">Wszystko inne ryzyko niespójności i niezgodności (na przykład próbuje użyć wersji zestawów .NET, które nie zostały skompilowane razem).</span><span class="sxs-lookup"><span data-stu-id="a051a-181">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="a051a-182">Aktualizacje w tle</span><span class="sxs-lookup"><span data-stu-id="a051a-182">Background updates</span></span>

<span data-ttu-id="a051a-183">Jako model mentalny, możesz myśleć o pierwszym w trybie offline PWA jako zachowującym się jak aplikacja mobilna, którą można zainstalować.</span><span class="sxs-lookup"><span data-stu-id="a051a-183">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="a051a-184">Aplikacja uruchamia się natychmiast niezależnie od łączności sieciowej, ale logika zainstalowanej aplikacji pochodzi z migawki punktu w czasie, która może nie być najnowszą wersją.</span><span class="sxs-lookup"><span data-stu-id="a051a-184">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="a051a-185">Szablon Blazor programu PWA tworzy aplikacje, które automatycznie próbują aktualizować się w tle za każdym razem, gdy użytkownik odwiedzi i ma działające połączenie sieciowe.</span><span class="sxs-lookup"><span data-stu-id="a051a-185">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="a051a-186">Sposób, w jaki to działa, jest następujący:</span><span class="sxs-lookup"><span data-stu-id="a051a-186">The way this works is as follows:</span></span>

* <span data-ttu-id="a051a-187">Podczas kompilacji projekt generuje *manifest zasobów pracownika serwisu*.</span><span class="sxs-lookup"><span data-stu-id="a051a-187">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="a051a-188">Domyślnie jest to nazywane *service-worker-assets.js*.</span><span class="sxs-lookup"><span data-stu-id="a051a-188">By default, this is called *service-worker-assets.js*.</span></span> <span data-ttu-id="a051a-189">Manifest zawiera listę wszystkich zasobów statycznych, które aplikacja wymaga do działania w trybie offline, takich jak zestawy .NET, pliki JavaScript i CSS, w tym ich skróty zawartości.</span><span class="sxs-lookup"><span data-stu-id="a051a-189">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="a051a-190">Lista zasobów jest ładowana przez proces roboczy usługi, dzięki czemu wie, które zasoby do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="a051a-190">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="a051a-191">Za każdym razem, gdy użytkownik odwiedza aplikację, przeglądarka ponownie żąda *service-worker.js* i *service-worker-assets.js* w tle.</span><span class="sxs-lookup"><span data-stu-id="a051a-191">Each time the user visits the app, the browser re-requests *service-worker.js* and *service-worker-assets.js* in the background.</span></span> <span data-ttu-id="a051a-192">Pliki są porównywane bajtami za bajt z istniejącym zainstalowanym pracownikiem serwisu.</span><span class="sxs-lookup"><span data-stu-id="a051a-192">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="a051a-193">Jeśli serwer zwraca zmienioną zawartość dla jednego z tych plików, pracownik serwisu próbuje zainstalować nową wersję siebie.</span><span class="sxs-lookup"><span data-stu-id="a051a-193">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="a051a-194">Podczas instalowania nowej wersji siebie, pracownik usługi tworzy nową, oddzielną pamięć podręczną dla zasobów w trybie offline i rozpoczyna wypełnianie pamięci podręcznej zasobami wymienionymi w *service-worker-assets.js*.</span><span class="sxs-lookup"><span data-stu-id="a051a-194">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in *service-worker-assets.js*.</span></span> <span data-ttu-id="a051a-195">Ta logika jest `onInstall` implementowana w funkcji wewnątrz *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="a051a-195">This logic is implemented in the `onInstall` function inside *service-worker.published.js*.</span></span>
* <span data-ttu-id="a051a-196">Proces kończy się pomyślnie, gdy wszystkie zasoby są ładowane bez błędów i wszystkie skróty zawartości są zgodne.</span><span class="sxs-lookup"><span data-stu-id="a051a-196">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="a051a-197">W przypadku powodzenia nowy pracownik serwisu wprowadza stan *oczekiwania na aktywację.*</span><span class="sxs-lookup"><span data-stu-id="a051a-197">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="a051a-198">Jak tylko użytkownik zamknie aplikację (nie ma pozostałych kart aplikacji lub okien), nowy pracownik usługi staje się *aktywny* i jest używany do kolejnych wizyt w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-198">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="a051a-199">Stary proces roboczy usługi i jego pamięć podręczna są usuwane.</span><span class="sxs-lookup"><span data-stu-id="a051a-199">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="a051a-200">Jeśli proces nie zakończy się pomyślnie, nowe wystąpienie procesu roboczego usługi zostanie odrzucone.</span><span class="sxs-lookup"><span data-stu-id="a051a-200">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="a051a-201">Proces aktualizacji jest podejmowana ponownie przy następnej wizycie użytkownika, gdy miejmy nadzieję, że klient ma lepsze połączenie sieciowe, które może zakończyć żądania.</span><span class="sxs-lookup"><span data-stu-id="a051a-201">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="a051a-202">Dostosuj ten proces, edytując logikę procesu roboczego serwisu.</span><span class="sxs-lookup"><span data-stu-id="a051a-202">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="a051a-203">Żadne z powyższych zachowań Blazor nie jest specyficzne dla, ale jest tylko domyślne środowisko dostarczone przez opcję szablonu programu PWA.</span><span class="sxs-lookup"><span data-stu-id="a051a-203">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="a051a-204">Aby uzyskać więcej informacji, zobacz [dokumenty sieci Web MDN: Interfejs API pracownika serwisu](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="a051a-204">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="a051a-205">Jak żądania są rozwiązywane</span><span class="sxs-lookup"><span data-stu-id="a051a-205">How requests are resolved</span></span>

<span data-ttu-id="a051a-206">Zgodnie z opisem w [sekcji strategii pobierania pamięci podręcznej](#cache-first-fetch-strategy) domyślny proces roboczy usługi używa strategii *pamięci podręcznej,* co oznacza, że próbuje obsługiwać zawartość buforowaną, gdy jest dostępna.</span><span class="sxs-lookup"><span data-stu-id="a051a-206">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="a051a-207">Jeśli nie ma zawartości buforowanej dla określonego adresu URL, na przykład podczas żądania danych z interfejsu API wewnętrznej bazy danych, proces roboczy usługi powraca do zwykłego żądania sieciowego.</span><span class="sxs-lookup"><span data-stu-id="a051a-207">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="a051a-208">Żądanie sieciowe powiedzie się, jeśli serwer jest osiągalny.</span><span class="sxs-lookup"><span data-stu-id="a051a-208">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="a051a-209">Ta logika jest `onFetch` implementowana wewnątrz funkcji w *serwisie service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="a051a-209">This logic is implemented inside `onFetch` function within *service-worker.published.js*.</span></span>

<span data-ttu-id="a051a-210">Jeśli składniki Razor aplikacji polegać na żądaniu danych z interfejsów API wewnętrznej bazy danych i chcesz zapewnić przyjazne środowisko użytkownika dla żądań nie powiodło się z powodu niedostępności sieci, zaimplementuj logikę w składnikach aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-210">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="a051a-211">Na przykład `try/catch` użyj `HttpClient` wokół żądań.</span><span class="sxs-lookup"><span data-stu-id="a051a-211">For example, use `try/catch` around `HttpClient` requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="a051a-212">Obsługa stron renderowanych na serwerze</span><span class="sxs-lookup"><span data-stu-id="a051a-212">Support server-rendered pages</span></span>

<span data-ttu-id="a051a-213">Zastanów się, co się stanie, gdy `/counter` użytkownik po raz pierwszy przejdzie do adresu URL, takiego jak lub innego głębokiego łącza w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-213">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="a051a-214">W takich przypadkach nie chcesz zwracać zawartości `/counter`w pamięci podręcznej jako , ale zamiast `/index.html` tego trzeba Blazor przeglądarki, aby załadować zawartość w pamięci podręcznej, aby uruchomić aplikację WebAssembly.</span><span class="sxs-lookup"><span data-stu-id="a051a-214">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="a051a-215">Te początkowe żądania są znane jako żądania *nawigacji,* w przeciwieństwie do:</span><span class="sxs-lookup"><span data-stu-id="a051a-215">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="a051a-216">*subresource* żądań obrazów, arkuszy stylów lub innych plików.</span><span class="sxs-lookup"><span data-stu-id="a051a-216">*subresource* requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="a051a-217">*żądania pobierania/XHR* dla danych INTERFEJSU API.</span><span class="sxs-lookup"><span data-stu-id="a051a-217">*fetch/XHR* requests for API data.</span></span>

<span data-ttu-id="a051a-218">Domyślny proces roboczy usługi zawiera logikę specjalnego przypadku dla żądań nawigacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-218">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="a051a-219">Pracownik serwisu rozwiązuje żądania, zwracając buforowaną zawartość `/index.html`dla , niezależnie od żądanego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="a051a-219">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="a051a-220">Ta logika jest `onFetch` implementowana w funkcji wewnątrz *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="a051a-220">This logic is implemented in the `onFetch` function inside *service-worker.published.js*.</span></span>

<span data-ttu-id="a051a-221">Jeśli aplikacja ma określone adresy URL, które muszą zwracać kod HTML renderowany na serwerze, a nie służyć `/index.html` z pamięci podręcznej, należy edytować logikę w usłudze worker.</span><span class="sxs-lookup"><span data-stu-id="a051a-221">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="a051a-222">Jeśli wszystkie adresy `/Identity/` URL zawierające muszą być obsługiwane jako zwykłe żądania tylko online do serwera, następnie zmodyfikuj *logikę service-worker.published.js.* `onFetch`</span><span class="sxs-lookup"><span data-stu-id="a051a-222">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify *service-worker.published.js* `onFetch` logic.</span></span> <span data-ttu-id="a051a-223">Znajdź następujący kod:</span><span class="sxs-lookup"><span data-stu-id="a051a-223">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="a051a-224">Zmień kod na następujący:</span><span class="sxs-lookup"><span data-stu-id="a051a-224">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="a051a-225">Jeśli tego nie zrobisz, niezależnie od łączności sieciowej pracownik serwisu przechwytuje żądania dotyczące takich adresów URL i rozwiązuje je za pomocą programu `/index.html`.</span><span class="sxs-lookup"><span data-stu-id="a051a-225">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="a051a-226">Buforowanie zasobów kontrolnych</span><span class="sxs-lookup"><span data-stu-id="a051a-226">Control asset caching</span></span>

<span data-ttu-id="a051a-227">Jeśli projekt definiuje `ServiceWorkerAssetsManifest` właściwość MSBuild, Blazornarzędzia kompilacji 's generuje manifest zasobów zasobu procesu roboczego usługi o określonej nazwie.</span><span class="sxs-lookup"><span data-stu-id="a051a-227">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="a051a-228">Domyślny szablon programu PWA tworzy plik projektu zawierający następującą właściwość:</span><span class="sxs-lookup"><span data-stu-id="a051a-228">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="a051a-229">Plik jest umieszczany w katalogu wyjściowym *wwwroot,* dzięki czemu przeglądarka może pobrać ten plik, żądając `/service-worker-assets.js`.</span><span class="sxs-lookup"><span data-stu-id="a051a-229">The file is placed in the *wwwroot* output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="a051a-230">Aby wyświetlić zawartość tego pliku, otwórz */bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js* w edytorze tekstu.</span><span class="sxs-lookup"><span data-stu-id="a051a-230">To see the contents of this file, open */bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js* in a text editor.</span></span> <span data-ttu-id="a051a-231">Jednak nie edytować plik, ponieważ jest generowany ponownie na każdej kompilacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-231">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="a051a-232">Domyślnie ten manifest zawiera listę:</span><span class="sxs-lookup"><span data-stu-id="a051a-232">By default, this manifest lists:</span></span>

* <span data-ttu-id="a051a-233">Wszystkie Blazorzasoby zarządzane przez -, takie jak zestawy .NET i pliki środowiska uruchomieniowego .NET WebAssembly wymagane do działania w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="a051a-233">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="a051a-234">Wszystkie zasoby do publikowania w katalogu *wwwroot* aplikacji, takie jak obrazy, arkusze stylów i pliki JavaScript, w tym statyczne zasoby sieci Web dostarczane przez projekty zewnętrzne i pakiety NuGet.</span><span class="sxs-lookup"><span data-stu-id="a051a-234">All resources for publishing to the app's *wwwroot* directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="a051a-235">Można kontrolować, które z tych zasobów są pobierane i buforowane przez `onInstall` pracownika serwisu, edytując logikę w *serwisie service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="a051a-235">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in *service-worker.published.js*.</span></span> <span data-ttu-id="a051a-236">Domyślnie pracownik serwisu pobiera i buforuje pliki pasujące do typowych rozszerzeń nazwy plików internetowych, takich jak *.html*, Blazor *css*, *.js*i *.wasm*, plus typy plików specyficzne dla WebAssembly (*.dll*, *.pdb*).</span><span class="sxs-lookup"><span data-stu-id="a051a-236">By default, the service worker fetches and caches files matching typical web filename extensions such as *.html*, *.css*, *.js*, and *.wasm*, plus file types specific to Blazor WebAssembly (*.dll*, *.pdb*).</span></span>

<span data-ttu-id="a051a-237">Aby uwzględnić dodatkowe zasoby, które nie są obecne w katalogu *wwwroot* `ItemGroup` aplikacji, należy zdefiniować dodatkowe wpisy MSBuild, jak pokazano w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="a051a-237">To include additional resources that aren't present in the app's *wwwroot* directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="a051a-238">Metadane `AssetUrl` określa adres URL względny podstawowy, który przeglądarka powinna używać podczas pobierania zasobu do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="a051a-238">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="a051a-239">Może to być niezależne od jego oryginalnej nazwy pliku źródłowego na dysku.</span><span class="sxs-lookup"><span data-stu-id="a051a-239">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a051a-240">Dodanie `ServiceWorkerAssetsManifestItem` pliku nie powoduje, że plik zostanie opublikowany w katalogu *wwwroot* aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-240">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's *wwwroot* directory.</span></span> <span data-ttu-id="a051a-241">Dane wyjściowe publikacji muszą być kontrolowane oddzielnie.</span><span class="sxs-lookup"><span data-stu-id="a051a-241">The publish output must be controlled separately.</span></span> <span data-ttu-id="a051a-242">Tylko `ServiceWorkerAssetsManifestItem` powoduje, że dodatkowy wpis pojawia się w manifeście zasobów pracownika serwisu.</span><span class="sxs-lookup"><span data-stu-id="a051a-242">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="a051a-243">Powiadomienia push</span><span class="sxs-lookup"><span data-stu-id="a051a-243">Push notifications</span></span>

<span data-ttu-id="a051a-244">Jak każdy inny pwa, Blazor WebAssembly PWA może odbierać powiadomienia wypychania z serwera wewnętrznej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="a051a-244">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="a051a-245">Serwer może wysyłać powiadomienia wypychane w dowolnym momencie, nawet jeśli użytkownik nie korzysta aktywnie z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-245">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="a051a-246">Na przykład powiadomienia wypychane mogą być wysyłane, gdy inny użytkownik wykonuje odpowiednią akcję.</span><span class="sxs-lookup"><span data-stu-id="a051a-246">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="a051a-247">Mechanizm wysyłania powiadomień wypychanych Blazor jest całkowicie niezależny od webassembly, ponieważ jest zaimplementowany przez serwer wewnętrznej bazy danych, który może korzystać z dowolnej technologii.</span><span class="sxs-lookup"><span data-stu-id="a051a-247">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="a051a-248">Jeśli chcesz wysyłać powiadomienia push z ASP.NET core server, rozważ [użycie techniki podobnej do podejścia przyjętego w warsztacie Blazing Pizza.](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications)</span><span class="sxs-lookup"><span data-stu-id="a051a-248">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="a051a-249">Mechanizm odbierania i wyświetlania powiadomień wypychanych Blazor na kliencie jest również niezależny od WebAssembly, ponieważ jest zaimplementowany w pliku JavaScript pracownika usługi.</span><span class="sxs-lookup"><span data-stu-id="a051a-249">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="a051a-250">Na przykład, zobacz [podejście stosowane w warsztacie Blazing Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="a051a-250">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="a051a-251">Zastrzeżenia dla programów PWA w trybie offline</span><span class="sxs-lookup"><span data-stu-id="a051a-251">Caveats for offline PWAs</span></span>

<span data-ttu-id="a051a-252">Nie wszystkie aplikacje powinny próbować obsługiwać korzystanie w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="a051a-252">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="a051a-253">Obsługa w trybie offline zwiększa złożoność, a jednocześnie nie zawsze jest istotne dla przypadków użycia wymagane.</span><span class="sxs-lookup"><span data-stu-id="a051a-253">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="a051a-254">Obsługa w trybie offline jest zwykle tylko odpowiednia:</span><span class="sxs-lookup"><span data-stu-id="a051a-254">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="a051a-255">Jeśli podstawowy magazyn danych jest lokalny w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="a051a-255">If the primary data store is local to the browser.</span></span> <span data-ttu-id="a051a-256">Na przykład podejście jest istotne w aplikacji z interfejsem użytkownika dla urządzenia `localStorage` [IoT,](https://en.wikipedia.org/wiki/Internet_of_things) które przechowuje dane w lub [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="a051a-256">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="a051a-257">Jeśli aplikacja wykonuje znaczną ilość pracy, aby pobrać i buforować dane interfejsu API wewnętrznej bazy danych istotne dla każdego użytkownika, dzięki czemu mogą poruszać się po danych w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="a051a-257">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="a051a-258">Jeśli aplikacja musi obsługiwać edycję, należy sbudować system śledzenia zmian i synchronizowania danych z zapleczem.</span><span class="sxs-lookup"><span data-stu-id="a051a-258">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="a051a-259">Jeśli celem jest zagwarantowanie, że aplikacja ładuje się natychmiast, niezależnie od warunków sieciowych.</span><span class="sxs-lookup"><span data-stu-id="a051a-259">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="a051a-260">Zaimplementuj odpowiednie środowisko użytkownika wokół żądań interfejsu API wewnętrznej bazy danych, aby pokazać postęp żądań i zachowywać się bezpiecznie, gdy żądania nie powiodą się z powodu niedostępności sieci.</span><span class="sxs-lookup"><span data-stu-id="a051a-260">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="a051a-261">Ponadto usługi PWA obsługujące tryb offline muszą radzić sobie z szeregiem dodatkowych komplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-261">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="a051a-262">Deweloperzy powinni dokładnie zapoznać się z zastrzeżeniami w poniższych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="a051a-262">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="a051a-263">Obsługa w trybie offline tylko wtedy, gdy jest opublikowana</span><span class="sxs-lookup"><span data-stu-id="a051a-263">Offline support only when published</span></span>

<span data-ttu-id="a051a-264">Podczas tworzenia zazwyczaj chcesz zobaczyć każdą zmianę odzwierciedloną natychmiast w przeglądarce bez przechodzenia przez proces aktualizacji w tle.</span><span class="sxs-lookup"><span data-stu-id="a051a-264">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="a051a-265">W związku Blazorz tym szablon programu PWA 's umożliwia obsługę w trybie offline tylko wtedy, gdy opublikowane.</span><span class="sxs-lookup"><span data-stu-id="a051a-265">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="a051a-266">Podczas tworzenia aplikacji w trybie offline, nie wystarczy przetestować aplikację w środowisku deweloperskim.</span><span class="sxs-lookup"><span data-stu-id="a051a-266">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="a051a-267">Należy przetestować aplikację w stanie opublikowanym, aby zrozumieć, jak reaguje na różne warunki sieciowe.</span><span class="sxs-lookup"><span data-stu-id="a051a-267">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="a051a-268">Aktualizacja ukończenia po nawigacji użytkownika z dala od aplikacji</span><span class="sxs-lookup"><span data-stu-id="a051a-268">Update completion after user navigation away from app</span></span>

<span data-ttu-id="a051a-269">Aktualizacje nie są kompletne, dopóki użytkownik nie odsunie się od aplikacji na wszystkich kartach.</span><span class="sxs-lookup"><span data-stu-id="a051a-269">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="a051a-270">Jak wyjaśniono w [sekcji Aktualizacje w tle,](#background-updates) po wdrożeniu aktualizacji do aplikacji przeglądarka pobiera zaktualizowane pliki procesu roboczego usługi, aby rozpocząć proces aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-270">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="a051a-271">Co zaskakuje wielu deweloperów jest to, że nawet po zakończeniu tej aktualizacji, **nie** zostanie ona obowiązuje, dopóki użytkownik nie odsunął się we wszystkich kartach.</span><span class="sxs-lookup"><span data-stu-id="a051a-271">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="a051a-272">**Nie** wystarczy odświeżyć kartę wyświetlającą aplikację, nawet jeśli jest to jedyna karta wyświetlająca aplikację.</span><span class="sxs-lookup"><span data-stu-id="a051a-272">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="a051a-273">Dopóki aplikacja nie zostanie całkowicie zamknięta, nowy pracownik serwisu pozostaje w *oczekiwaniu na aktywację* stanu.</span><span class="sxs-lookup"><span data-stu-id="a051a-273">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="a051a-274">**Nie jest to Blazorspecyficzne dla , ale raczej jest to standardowe zachowanie platformy internetowej.**</span><span class="sxs-lookup"><span data-stu-id="a051a-274">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="a051a-275">To często kłopoty deweloperów, którzy próbują przetestować aktualizacje do ich pracy usługi lub w trybie offline buforowane zasoby.</span><span class="sxs-lookup"><span data-stu-id="a051a-275">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="a051a-276">Jeśli zaewidencjonujesz narzędzia programistyczne przeglądarki, może pojawić się coś następującego:</span><span class="sxs-lookup"><span data-stu-id="a051a-276">If you check in the browser's developer tools, you may see something like the following:</span></span>

![Karta "Aplikacja" Google Chrome pokazuje, że pracownik serwisu aplikacji "czeka na aktywację".](progressive-web-app/_static/image7.png)

<span data-ttu-id="a051a-278">Tak długo, jak lista "klientów", które są karty lub okna wyświetlania aplikacji, jest niepusty, pracownik kontynuuje oczekiwanie.</span><span class="sxs-lookup"><span data-stu-id="a051a-278">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="a051a-279">Powodem, dla którego pracownicy serwisu to robią, jest zagwarantowanie spójności.</span><span class="sxs-lookup"><span data-stu-id="a051a-279">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="a051a-280">Spójność oznacza, że wszystkie zasoby są pobierane z tej samej niepodzielną pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="a051a-280">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="a051a-281">Podczas testowania zmian, może okazać się wygodne, aby kliknąć link "skipWaiting", jak pokazano na poprzednim zrzucie ekranu, a następnie ponownie załadować stronę.</span><span class="sxs-lookup"><span data-stu-id="a051a-281">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="a051a-282">Można to zautomatyzować dla wszystkich użytkowników, kodując pracownika serwisu, aby [pominąć fazę "oczekiwania" i natychmiast aktywować przy aktualizacji](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="a051a-282">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="a051a-283">Jeśli pominąć fazę oczekiwania, rezygnując z gwarancji, że zasoby są zawsze pobierane konsekwentnie z tego samego wystąpienia pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="a051a-283">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="a051a-284">Użytkownicy mogą uruchamiać dowolną historyczną wersję aplikacji</span><span class="sxs-lookup"><span data-stu-id="a051a-284">Users may run any historical version of the app</span></span>

<span data-ttu-id="a051a-285">Deweloperzy sieci Web zwykle oczekują, że użytkownicy uruchamiają tylko najnowszą wdrożoną wersję swojej aplikacji sieci web, ponieważ jest to normalne w ramach tradycyjnego modelu dystrybucji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="a051a-285">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="a051a-286">Jednak pwa połączona w trybie offline jest bardziej zbliżona do natywnej aplikacji mobilnej, w której użytkownicy niekoniecznie uruchamiają najnowszą wersję.</span><span class="sxs-lookup"><span data-stu-id="a051a-286">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="a051a-287">Jak wyjaśniono w [sekcji Aktualizacje w tle,](#background-updates) po wdrożeniu aktualizacji do **aplikacji, każdy istniejący użytkownik nadal używa poprzedniej wersji dla co najmniej jednej kolejnej wizyty,** ponieważ aktualizacja występuje w tle i nie jest aktywowana, dopóki użytkownik nie przejdzie dalej.</span><span class="sxs-lookup"><span data-stu-id="a051a-287">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="a051a-288">Ponadto poprzednia wersja używana nie jest koniecznie poprzednia wdrożona.</span><span class="sxs-lookup"><span data-stu-id="a051a-288">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="a051a-289">Poprzednia wersja może być *dowolną* wersją historyczną, w zależności od tego, kiedy użytkownik ostatnio ukończył aktualizację.</span><span class="sxs-lookup"><span data-stu-id="a051a-289">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="a051a-290">Może to być problem, jeśli frontend i wewnętrznej bazy części aplikacji wymagają porozumienia dotyczące schematu dla żądań interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="a051a-290">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="a051a-291">Nie należy wdrażać wstecznie niezgodnych zmian schematu interfejsu API, dopóki nie można mieć pewności, że wszyscy użytkownicy uaktualnili.</span><span class="sxs-lookup"><span data-stu-id="a051a-291">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="a051a-292">Alternatywnie należy zablokować użytkownikom korzystanie z niezgodnych starszych wersji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a051a-292">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="a051a-293">To wymaganie scenariusza jest taka sama jak w przypadku natywnych aplikacji mobilnych.</span><span class="sxs-lookup"><span data-stu-id="a051a-293">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="a051a-294">Jeśli wdrożysz przełomową zmianę w interfejsach API serwera, aplikacja kliencka zostanie przerwana dla użytkowników, którzy nie zostały jeszcze zaktualizowane.</span><span class="sxs-lookup"><span data-stu-id="a051a-294">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="a051a-295">Jeśli to możliwe, nie należy wdrażać zmian podziału do interfejsów API wewnętrznej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="a051a-295">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="a051a-296">Jeśli musisz to zrobić, należy rozważyć użycie [standardowych interfejsów API service worker, takich jak ServiceWorkerRegistration,](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) aby ustalić, czy aplikacja jest aktualna, a jeśli nie, aby zapobiec użyciu.</span><span class="sxs-lookup"><span data-stu-id="a051a-296">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="a051a-297">Zakłócenia ze strony renderowane na serwerze</span><span class="sxs-lookup"><span data-stu-id="a051a-297">Interference with server-rendered pages</span></span>

<span data-ttu-id="a051a-298">Zgodnie z opisem w [pomocy technicznej strony renderowane strony](#support-server-rendered-pages) sekcji, jeśli chcesz `/index.html` pominąć zachowanie pracownika usługi zwracania zawartości dla wszystkich żądań nawigacji, edytować logikę w pracowniku usługi.</span><span class="sxs-lookup"><span data-stu-id="a051a-298">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="a051a-299">Cała zawartość manifestu zasobu zasobu zasobu procesu roboczego usługi jest domyślnie buforowana</span><span class="sxs-lookup"><span data-stu-id="a051a-299">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="a051a-300">Zgodnie z opisem w [sekcji Buforowanie zasobów kontroli,](#control-asset-caching) usługa plików *worker-assets.js* jest generowany podczas kompilacji i wyświetla listę wszystkich zasobów, które pracownik usługi powinien pobrać i pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="a051a-300">As described in the [Control asset caching](#control-asset-caching) section, the file *service-worker-assets.js* is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="a051a-301">Ponieważ ta lista domyślnie zawiera wszystko, co jest dostarczane do *wwwroot*, w tym treści dostarczane przez zewnętrzne pakiety i projekty, należy uważać, aby nie umieścić tam zbyt wiele treści.</span><span class="sxs-lookup"><span data-stu-id="a051a-301">Since this list by default includes everything emitted to *wwwroot*, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="a051a-302">Jeśli katalog *wwwroot* zawiera miliony obrazów, pracownik serwisu próbuje pobrać i buforować je wszystkie, zużywając nadmierną przepustowość i najprawdopodobniej nie kończąc pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="a051a-302">If the *wwwroot* directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="a051a-303">Zaimplementuj dowolną logikę, aby kontrolować, który podzbiór zawartości `onInstall` manifestu powinien być pobierany i buforowany, edytując funkcję w *serwisie service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="a051a-303">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in *service-worker.published.js*.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="a051a-304">Interakcja z uwierzytelnianiem</span><span class="sxs-lookup"><span data-stu-id="a051a-304">Interaction with authentication</span></span>

<span data-ttu-id="a051a-305">Możliwe jest użycie opcji szablonu programu PWA w połączeniu z opcjami uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="a051a-305">It's possible to use the PWA template option in conjunction with the authentication options.</span></span> <span data-ttu-id="a051a-306">Program PWA obsługujący tryb offline może również obsługiwać uwierzytelnianie, gdy użytkownik ma łączność sieciową.</span><span class="sxs-lookup"><span data-stu-id="a051a-306">An offline-capable PWA can also support authentication when the user has network connectivity.</span></span>

<span data-ttu-id="a051a-307">Gdy użytkownik nie ma łączności sieciowej, nie może uwierzytelnić ani uzyskać tokenów dostępu.</span><span class="sxs-lookup"><span data-stu-id="a051a-307">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="a051a-308">Domyślnie próba odwiedzenia strony logowania bez dostępu do sieci powoduje wyświetlenie komunikatu "błąd sieci".</span><span class="sxs-lookup"><span data-stu-id="a051a-308">By default, attempting to visit the login page without network access results in a "network error" message.</span></span>

<span data-ttu-id="a051a-309">Należy zaprojektować przepływ interfejsu użytkownika, który pozwala użytkownikowi wykonywać przydatne czynności w trybie offline bez próby uwierzytelnienia lub uzyskania tokenów dostępu.</span><span class="sxs-lookup"><span data-stu-id="a051a-309">You must design a UI flow that lets the user do useful things while offline without attempting to authenticate or obtain access tokens.</span></span> <span data-ttu-id="a051a-310">Alternatywnie można zaprojektować aplikację, aby zakończyć się niepowodzeniem w sposób pełen wdzięku, gdy sieć nie jest dostępna.</span><span class="sxs-lookup"><span data-stu-id="a051a-310">Alternatively, you can design the app to fail in a graceful way when the network isn't available.</span></span> <span data-ttu-id="a051a-311">Jeśli nie jest to możliwe w aplikacji, możesz nie chcieć włączyć obsługi w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="a051a-311">If this isn't possible in your app, you might not want to enable offline support.</span></span>
