---
title: Kompilowanie progresywnych aplikacji sieci Web za pomocą ASP.NET Core Blazor webassembly
author: guardrex
description: Dowiedz się, jak tworzyć Blazorprogresywne aplikacje sieci Web (PWAs), aplikacje sieci Web, które używają nowoczesnych funkcji przeglądarki, aby zachować takie działania jak aplikacje klasyczne.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/09/2020
no-loc:
- Blazor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: f1c1ce50f20bf579e67e1d4eb02cc7d9d681e354
ms.sourcegitcommit: 98bcf5fe210931e3eb70f82fd675d8679b33f5d6
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/11/2020
ms.locfileid: "79083721"
---
# <a name="build-progressive-web-applications-with-aspnet-core-opno-locblazor-webassembly"></a><span data-ttu-id="8fbf7-103">Kompilowanie progresywnych aplikacji sieci Web za pomocą ASP.NET Core Blazor webassembly</span><span class="sxs-lookup"><span data-stu-id="8fbf7-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="8fbf7-104">[Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="8fbf7-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

<span data-ttu-id="8fbf7-105">Progresywna aplikacja sieci Web (PWA) to aplikacja oparta na sieci Web, która korzysta z nowoczesnych interfejsów API i funkcji w celu zachowania aplikacji klasycznych.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-105">A Progressive Web Application (PWA) is a web-based application that uses modern browser APIs and capabilities to behave like a desktop application.</span></span> <span data-ttu-id="8fbf7-106">Dostępne są następujące możliwości:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-106">These capabilities can include:</span></span>

* <span data-ttu-id="8fbf7-107">Praca w trybie offline i zawsze trwa ładowanie niezależnie od szybkości sieci</span><span class="sxs-lookup"><span data-stu-id="8fbf7-107">Working offline and always loading instantly, independently of network speed</span></span>
* <span data-ttu-id="8fbf7-108">Możliwość uruchamiania w osobnym oknie aplikacji, a nie tylko w oknie przeglądarki</span><span class="sxs-lookup"><span data-stu-id="8fbf7-108">Being able to run in its own application window, not just a browser window</span></span>
* <span data-ttu-id="8fbf7-109">Jest uruchamiany z menu Start systemu operacyjnego hosta, dokowania lub ekranu głównego</span><span class="sxs-lookup"><span data-stu-id="8fbf7-109">Being launched from the host operating system (OS) start menu, dock, or home screen</span></span>
* <span data-ttu-id="8fbf7-110">Otrzymywanie powiadomień wypychanych z serwera wewnętrznej bazy danych, nawet jeśli użytkownik nie korzysta z aplikacji</span><span class="sxs-lookup"><span data-stu-id="8fbf7-110">Receiving push notifications from a backend server, even while the user is not using the application</span></span>
* <span data-ttu-id="8fbf7-111">Automatyczne aktualizowanie w tle</span><span class="sxs-lookup"><span data-stu-id="8fbf7-111">Automatically updating in the background</span></span>

<span data-ttu-id="8fbf7-112">Użytkownik może najpierw odnaleźć i korzystać z aplikacji w swojej przeglądarce internetowej, podobnie jak każda inna aplikacja jednostronicowa (SPA), później postępować w celu zainstalowania jej w systemie operacyjnym i włączenia powiadomień wypychanych.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-112">A user might first discover and use the application within their web browser like any other single-page application (SPA), then later progress to installing it in their OS and enabling push notifications.</span></span> <span data-ttu-id="8fbf7-113">Dlatego używamy warunkowego *postępu*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-113">That's why we use the term *progressive*.</span></span>

Blazor<span data-ttu-id="8fbf7-114"> webassembly to prawdziwa oparta na standardach platforma aplikacji sieci Web po stronie klienta, dzięki której można korzystać z dowolnego interfejsu API przeglądarki, w tym interfejsów API programu PWA, które są potrzebne do obsługi wymienionych powyżej.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-114"> WebAssembly is a true standards-based client-side web application platform, so it can use any browser API, including PWA APIs needed for the capabilities listed above.</span></span> <span data-ttu-id="8fbf7-115">Może działać w trybie offline podobnie jak w przypadku każdej innej technologii sieci Web po stronie klienta.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-115">It can work offline just like any other client-side web technology.</span></span>

## <a name="pwa-template"></a><span data-ttu-id="8fbf7-116">Szablon PWA</span><span class="sxs-lookup"><span data-stu-id="8fbf7-116">PWA template</span></span>

<span data-ttu-id="8fbf7-117">Podczas tworzenia nowej aplikacji Blazor webassembly jest oferowana opcja dodawania funkcji PWA.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-117">When creating a new Blazor WebAssembly application, you are offered the option to add PWA features.</span></span> <span data-ttu-id="8fbf7-118">W programie Visual Studio opcja jest określona jako pole wyboru w oknie dialogowym tworzenia projektu:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-118">In Visual Studio, the option is given as a checkbox in the project creation dialog:</span></span>

![obraz](https://user-images.githubusercontent.com/1101362/76207411-a6b54200-61f5-11ea-9dfc-6acd87a91428.png)

<span data-ttu-id="8fbf7-120">Jeśli tworzysz projekt w wierszu polecenia, możesz użyć flagi `--pwa`.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-120">If you're creating the project on the command line, you can use the `--pwa` flag.</span></span> <span data-ttu-id="8fbf7-121">Na przykład</span><span class="sxs-lookup"><span data-stu-id="8fbf7-121">For example,</span></span>

```dotnetcli
dotnet new blazorwasm --pwa -o MyNewProject
```

<span data-ttu-id="8fbf7-122">W obu przypadkach możesz połączyć ten program z opcją "ASP.NET Core Hosted", jeśli chcesz, ale nie musisz tego robić.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-122">In both cases, you're free to combine this with the "ASP.NET Core hosted" option if you wish, but don't have to do so.</span></span> <span data-ttu-id="8fbf7-123">Funkcje programu PWA są niezależne od modelu hostingu.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-123">PWA features are independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="8fbf7-124">Manifest instalacji i aplikacji</span><span class="sxs-lookup"><span data-stu-id="8fbf7-124">Installation and app manifest</span></span>

<span data-ttu-id="8fbf7-125">Podczas odwiedzania aplikacji utworzonej przy użyciu opcji szablonu PWA użytkownicy mogą zainstalować aplikację w menu Start, zadokowanym lub na ekranie głównym systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-125">When visiting an application created using the PWA template option, users have the option to install the application into their OS's start menu, dock, or home screen.</span></span>

<span data-ttu-id="8fbf7-126">Sposób przedstawiania tej opcji zależy od przeglądarki użytkownika.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-126">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="8fbf7-127">Na przykład w przypadku korzystania z przeglądarek opartych na formacie chromu w programie Desktop, takich jak Edge lub Chrome, na pasku adresu URL pojawia się przycisk *Dodaj* .</span><span class="sxs-lookup"><span data-stu-id="8fbf7-127">For example, when using desktop Chromium-based browsers such as Edge or Chrome, an *Add* button appears within the URL bar:</span></span>

![obraz](https://user-images.githubusercontent.com/1101362/76208127-f7796a80-61f6-11ea-8aea-7fba704be787.png)

<span data-ttu-id="8fbf7-129">W systemie iOS osoby odwiedzające mogą zainstalować program PWA przy użyciu przycisku *udostępniania* Safari i jego opcji *Dodaj do homescreen* .</span><span class="sxs-lookup"><span data-stu-id="8fbf7-129">On iOS, visitors can install the PWA using Safari's *Share* button and its *Add to Homescreen* option.</span></span> <span data-ttu-id="8fbf7-130">W przypadku programu Chrome dla systemu Android użytkownicy powinni nacisnąć przycisk *menu* w prawym górnym rogu, a następnie wybrać pozycję *Dodaj do ekranu głównego*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-130">On Chrome for Android, users should tap the *Menu* button in the upper-right corner, then choose *Add to Home screen*.</span></span>

<span data-ttu-id="8fbf7-131">Po zainstalowaniu aplikacja pojawia się w osobnym oknie, bez paska adresu.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-131">Once installed, the application appears in its own window, without any address bar.</span></span>

![obraz](https://user-images.githubusercontent.com/1101362/76208588-e2e9a200-61f7-11ea-85e1-8c3fc849b252.png)

<span data-ttu-id="8fbf7-133">Aby dostosować tytuł okna, schemat kolorów, ikonę lub inne szczegóły, zobacz plik `manifest.json` w katalogu *wwwroot* Twojego projektu.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-133">To customize the window's title, color scheme, icon, or other details, see the file `manifest.json` in your project's *wwwroot* directory.</span></span> <span data-ttu-id="8fbf7-134">Schemat tego pliku jest definiowany przez standardy sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="8fbf7-135">Aby uzyskać szczegółową dokumentację, zobacz https://developer.mozilla.org/docs/Web/Manifest.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-135">For detailed documentation, see https://developer.mozilla.org/docs/Web/Manifest.</span></span>

## <a name="offline-support"></a><span data-ttu-id="8fbf7-136">Obsługa offline</span><span class="sxs-lookup"><span data-stu-id="8fbf7-136">Offline support</span></span>

<span data-ttu-id="8fbf7-137">Domyślnie aplikacje utworzone przy użyciu opcji szablonu PWA obsługują uruchamianie w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-137">By default, applications created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="8fbf7-138">Użytkownik musi najpierw odwiedzić aplikację, gdy jest w trybie online, a następnie automatycznie pobierze i przetworzy pamięć podręczną wszystkich zasobów wymaganych do działania w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-138">A user must first visit the application while they are online, then the browser will automatically download and cache all the resources needed to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8fbf7-139">Obsługa w trybie offline jest włączona tylko dla *opublikowanych* aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-139">Offline support is only enabled for *published* applications.</span></span> <span data-ttu-id="8fbf7-140">Nie jest ona włączona podczas tworzenia.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-140">It is not enabled during development.</span></span> <span data-ttu-id="8fbf7-141">Dzieje się tak, ponieważ mogłoby to zakłócać proces tworzenia zmian i testowania.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-141">This is because it would interfere with the usual development cycle of making changes and testing them.</span></span>

> [!WARNING]
> <span data-ttu-id="8fbf7-142">Jeśli zamierzasz wysłać aplikację PWA z obsługą trybu offline, istnieje [kilka ważnych ostrzeżeń i](#caveats-for-offline-pwas) zaleceń, które należy zrozumieć.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-142">If you intend to ship an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas) you need to understand.</span></span> <span data-ttu-id="8fbf7-143">Są one związane z PWAs w trybie offline i nie są specyficzne dla Blazor.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-143">These are inherent to offline PWAs, and not specific to Blazor.</span></span> <span data-ttu-id="8fbf7-144">Pamiętaj, aby przeczytać i zrozumieć te zastrzeżenia przed wprowadzeniem założeń dotyczących działania aplikacji z obsługą trybu offline.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled application will work.</span></span>

<span data-ttu-id="8fbf7-145">Aby zobaczyć, jak działa obsługa w trybie offline, należy najpierw [opublikować aplikację](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/?view=aspnetcore-3.1&tabs=visual-studio#publish-the-app)i hostować ją na serwerze obsługującym protokół https.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-145">To see how offline support works, first [publish your application](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/?view=aspnetcore-3.1&tabs=visual-studio#publish-the-app), and host it on a server supporting HTTPS.</span></span> <span data-ttu-id="8fbf7-146">Po odwiedzeniu aplikacji powinno być możliwe otwarcie narzędzi deweloperskich przeglądarki i sprawdzenie, czy *proces roboczy usługi* został zarejestrowany dla hosta:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-146">When you visit the application, you should be able to open the browser's dev tools and verify that a *Service Worker* is registered for your host:</span></span>

![obraz](https://user-images.githubusercontent.com/1101362/76210294-bd5e9780-61fb-11ea-9869-65c55c62803d.png)

<span data-ttu-id="8fbf7-148">Ponadto w przypadku ponownego załadowania strony na karcie *Sieć* powinna zostać wyświetlona wartość wszystkie zasoby potrzebne do załadowania strony są pobierane z *procesu roboczego usługi* lub pamięci *podręcznej pamięci*:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-148">Additionally, if you reload the page, then on the *Network* tab you should see that all resources needed to load your page are being retrieved from the *Service Worker* or *Memory Cache*:</span></span>

![obraz](https://user-images.githubusercontent.com/1101362/76210472-1d553e00-61fc-11ea-84c6-291644df709e.png)

<span data-ttu-id="8fbf7-150">Oznacza to, że przeglądarka nie jest zależna od dostępu do sieci w celu załadowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-150">This shows that the browser is not dependent on network access to load your application.</span></span> <span data-ttu-id="8fbf7-151">Aby to sprawdzić, możesz zamknąć serwer sieci Web lub poinstruować przeglądarkę, aby zasymulować tryb offline:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-151">To verify this, you can either shut down your web server, or instruct the browser to simulate offline mode:</span></span>

![obraz](https://user-images.githubusercontent.com/1101362/76210556-47a6fb80-61fc-11ea-9d12-20a8f6528744.png)

<span data-ttu-id="8fbf7-153">Teraz, nawet bez dostępu do serwera sieci Web, powinno być możliwe ponowne załadowanie strony i sprawdzenie, czy aplikacja jest nadal ładowana i uruchomiona.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-153">Now, even without access to your web server, you should be able to reload the page and see that your application still loads and runs.</span></span> <span data-ttu-id="8fbf7-154">Podobnie nawet w przypadku symulowania bardzo wolnego połączenia sieciowego strona zostanie załadowana natychmiast po załadowaniu jej niezależnie od sieci.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-154">Likewise, even if you simulate a very slow network connection, your page will still load immediately since it is loaded independently of the network.</span></span>

### <a name="service-worker"></a><span data-ttu-id="8fbf7-155">Proces roboczy usługi</span><span class="sxs-lookup"><span data-stu-id="8fbf7-155">Service worker</span></span>

<span data-ttu-id="8fbf7-156">Obsługa w trybie offline jest realizowana przy użyciu procesu roboczego usługi.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-156">Offline support is achieved using a service worker.</span></span> <span data-ttu-id="8fbf7-157">Jest to standard sieci Web, który nie jest specyficzny dla Blazor.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-157">This is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="8fbf7-158">Aby uzyskać dokumentację dotyczącą pracowników usług, zobacz https://developer.mozilla.org/docs/Web/API/Service_Worker_API.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-158">For documentation about service workers, see https://developer.mozilla.org/docs/Web/API/Service_Worker_API.</span></span> <span data-ttu-id="8fbf7-159">Aby dowiedzieć się więcej o typowych wzorcach użycia dla pracowników usług, zobacz doskonałe informacje o [cyklu życia pracownika usługi](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-159">To learn more about common usage patterns for service workers, see the excellent article [The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

<span data-ttu-id="8fbf7-160">szablon w programie BlazorPWA tworzy dwa pliki procesów roboczych usługi:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-160">Blazor's PWA template produces two service worker files:</span></span>

* <span data-ttu-id="8fbf7-161">*wwwroot/Service-Worker. js*, który jest używany podczas opracowywania</span><span class="sxs-lookup"><span data-stu-id="8fbf7-161">*wwwroot/service-worker.js*, which is used during development</span></span>
* <span data-ttu-id="8fbf7-162">*wwwroot/Service-Worker. opublikowano. js*, który jest używany po opublikowaniu aplikacji</span><span class="sxs-lookup"><span data-stu-id="8fbf7-162">*wwwroot/service-worker.published.js*, which is used once your application is published</span></span>

<span data-ttu-id="8fbf7-163">Jeśli chcesz udostępnić logikę między tymi dwoma plikami, rozważ dodanie trzeciego pliku JavaScript do przechowywania typowej logiki i Użyj [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) do załadowania logiki do obu plików.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-163">If you want to share logic between these two files, consider adding a third JavaScript file to hold the common logic, and use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load that logic into both files.</span></span>

#### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="8fbf7-164">Strategia pobierania w pamięci podręcznej</span><span class="sxs-lookup"><span data-stu-id="8fbf7-164">Cache-first fetch strategy</span></span>

<span data-ttu-id="8fbf7-165">Wbudowany proces roboczy usługi *Service-Worker. opublikowano. js* rozpoznaje żądania przy użyciu strategii *pierwszej pamięci podręcznej* .</span><span class="sxs-lookup"><span data-stu-id="8fbf7-165">The built-in *service-worker.published.js* service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="8fbf7-166">Oznacza to, że zawsze woli zwrócić zawartość pamięci podręcznej, jeśli jest dostępna, niezależnie od tego, czy użytkownik ma dostęp do sieci, czy nowsza zawartość jest dostępna na serwerze.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-166">This means it always prefers to return cached content if available, regardless of whether the user has network access or whether newer content is available on the server.</span></span>

<span data-ttu-id="8fbf7-167">Istnieją dwa powody, dla których jest to cenne:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-167">There are two reasons why this is valuable:</span></span>

* <span data-ttu-id="8fbf7-168">**Zapewnia niezawodność.**</span><span class="sxs-lookup"><span data-stu-id="8fbf7-168">**It ensures reliability.**</span></span> <span data-ttu-id="8fbf7-169">Dostęp do sieci nie jest stanem logicznym.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-169">Network access is not a boolean state.</span></span> <span data-ttu-id="8fbf7-170">Użytkownik nie jest po prostu "online" lub "offline".</span><span class="sxs-lookup"><span data-stu-id="8fbf7-170">A user is not simply "online" or "offline".</span></span> <span data-ttu-id="8fbf7-171">W rzeczywistości urządzenie użytkownika może uznać, że jest w trybie online, ale sieć może być zbyt mała, aby oczekiwać.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-171">In reality, the user's device may believe it is online, but the network may be so slow as to be impractical to wait for.</span></span> <span data-ttu-id="8fbf7-172">Lub sieć może zwracać nieprawidłowe wyniki dla niektórych adresów URL, na przykład gdy istnieje Portal sieci Wi-Fi, który aktualnie blokuje lub przekierowuje określone żądania.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-172">Or the network might be returning invalid results for certain URLs, such as when there is a captive WIFI portal that is currently blocking or redirecting certain requests.</span></span> <span data-ttu-id="8fbf7-173">Jest to dlatego, że interfejs API `navigator.onLine` przeglądarki nie jest niezawodny i nie powinien być zależny od tego, czy nie.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-173">This is why the browser's `navigator.onLine` API is not reliable and should not be depended upon.</span></span>
* <span data-ttu-id="8fbf7-174">**Zapewnia to poprawność.**</span><span class="sxs-lookup"><span data-stu-id="8fbf7-174">**It ensures correctness.**</span></span> <span data-ttu-id="8fbf7-175">Podczas kompilowania pamięci podręcznej zasobów w trybie offline, proces roboczy usługi używa tworzenia skrótów zawartości w celu zagwarantowania, że pobrano kompletną i spójną migawkę zasobów w jednym czasie.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-175">When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="8fbf7-176">Ta pamięć podręczna jest następnie używana jako jednostka niepodzielna.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-176">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="8fbf7-177">W związku z tym nie ma żadnego punktu, aby uzyskać dostęp do sieci w celu uzyskania nowszych zasobów, ponieważ jedynymi wersjami są te, które zostały już zapisane w pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-177">Given this, there is no point asking the network for newer resources, since the only versions you want are the ones you've already cached.</span></span> <span data-ttu-id="8fbf7-178">Wszelkie inne zagrożenia niespójnością i niezgodnością (na przykład próba użycia wersji zestawów .NET, które nie zostały skompilowane razem).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-178">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that were not compiled together).</span></span>

#### <a name="background-updates"></a><span data-ttu-id="8fbf7-179">Aktualizacje w tle</span><span class="sxs-lookup"><span data-stu-id="8fbf7-179">Background updates</span></span>

<span data-ttu-id="8fbf7-180">Jako model psychiczny Możesz pomyśleć o tym, że w trybie offline — w pierwszej kolejności, jak w przypadku aplikacji mobilnej, która może być zainstalowana.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-180">As a mental model, you can think of an offline-first PWA as behaving like an mobile app that can be installed.</span></span> <span data-ttu-id="8fbf7-181">Zawsze zaczyna się od razu, niezależnie od łączności sieciowej, ale zainstalowana logika aplikacji pochodzi z migawki do punktu w czasie, która może nie być najnowszą wersją.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-181">It always starts up immediately regardless of network connectivity, but the installed application logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="8fbf7-182">Szablon Blazor PWA umożliwia tworzenie aplikacji, które automatycznie próbują zaktualizować się w tle zawsze, gdy użytkownik odwiedza i ma działające połączenie sieciowe.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-182">The Blazor PWA template produces applications that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="8fbf7-183">Oto jak to działa:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-183">The way this works is as follows:</span></span>

* <span data-ttu-id="8fbf7-184">Podczas kompilacji projekt generuje *manifest zasobów roboczych usługi*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-184">During compilation, your project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="8fbf7-185">Domyślnie jest to nazwa *Service-Worker-Assets. js*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-185">By default this is called *service-worker-assets.js*.</span></span> <span data-ttu-id="8fbf7-186">Zawiera listę wszystkich zasobów statycznych, które aplikacja musi działać w trybie offline, takich jak zestawy .NET, pliki JavaScript, CSS itp., włącznie z ich skrótami zawartości.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-186">This lists all the static resources your application needs to function offline, such as .NET assemblies, JavaScript files, CSS, etc., including their content hashes.</span></span> <span data-ttu-id="8fbf7-187">Ta lista jest załadowana przez proces roboczy usługi, aby uzyskać informację o tym, które zasoby mają być buforowane.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-187">This list is loaded by your service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="8fbf7-188">Za każdym razem, gdy użytkownik odwiedzi aplikację, przeglądarka zażąda w tle *Service-Worker. js* i *Service-Worker-Assets. js* .</span><span class="sxs-lookup"><span data-stu-id="8fbf7-188">Each time the user visits your application, the browser re-requests *service-worker.js* and *service-worker-assets.js* in the background.</span></span> <span data-ttu-id="8fbf7-189">Jeśli serwer zwróci zmienioną zawartość dla jednego z tych plików (w porównaniu bajtach w bajtach z istniejącym zainstalowanym pracownikiem usługi), proces roboczy usługi próbuje zainstalować nową wersję programu.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-189">If the server returns changed content for either of these files (compared byte-for-byte with the existing installed service worker), the service worker tries to install a new version of itself.</span></span>
* <span data-ttu-id="8fbf7-190">Podczas instalowania nowej wersji, proces roboczy usługi tworzy nową, oddzielną pamięć podręczną dla zasobów w trybie offline i rozpoczyna zapełnianie jej zasobami wymienionymi w *Service-Worker-Assets. js*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-190">When installing a new version of itself, the service worker creates a new, separate cache for offline resources, and starts populating it with resources listed in *service-worker-assets.js*.</span></span> <span data-ttu-id="8fbf7-191">Ta logika jest implementowana w funkcji `onInstall` w *Service-Worker. opublikowano. js*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-191">This logic is implemented in the `onInstall` function inside *service-worker.published.js*.</span></span>
* <span data-ttu-id="8fbf7-192">Jeśli proces zakończy się pomyślnie (tj. wszystkie zasoby są ładowane bez błędów, a wszystkie wartości skrótów zawartości), nowy proces roboczy usługi przechodzi do stanu "Oczekiwanie na aktywację".</span><span class="sxs-lookup"><span data-stu-id="8fbf7-192">If the process completes successfully (i.e., all the resources are loaded without error, and all content hashes match), then the new service worker enters a "waiting for activation" state.</span></span> <span data-ttu-id="8fbf7-193">Gdy tylko użytkownik zamknie aplikację (tj. nie ma żadnych kart lub okien aplikacji), nowy proces roboczy usługi zmieni się na "aktywny" i będzie używany do kolejnych wizyt w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-193">As soon as the user closes your application (i.e., there are no remaining tabs or windows displaying your application), the new service worker becomes "active" and will be used for subsequent visits to your application.</span></span> <span data-ttu-id="8fbf7-194">Stary proces roboczy usługi i jego pamięć podręczna są usuwane.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-194">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="8fbf7-195">Jeśli proces nie zakończy się pomyślnie, nowe wystąpienie procesu roboczego usługi zostanie odrzucone.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-195">If the process does not complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="8fbf7-196">Proces aktualizacji zostanie podjęty ponownie na następnym odwiedzeniu użytkownika, gdy miejmy nadzieję się z lepszym połączeniem sieciowym, które może zakończyć żądania.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-196">The update process will be attempted again on the user's next visit, when hopefully they have a better network connection that can complete the requests.</span></span>

<span data-ttu-id="8fbf7-197">Można dostosować dowolny aspekt tego procesu, edytując logikę procesu roboczego usługi.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-197">You can customize any aspect of this process by editing the service worker logic.</span></span> <span data-ttu-id="8fbf7-198">Żadne z powyższych elementów nie jest specyficzne dla Blazor, ale jest tylko sugestią podaną przez opcję szablonu PWA.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-198">None of the above is specific to Blazor, but is merely a suggestion provided by the PWA template option.</span></span> <span data-ttu-id="8fbf7-199">Aby uzyskać więcej informacji, zobacz [dokumentację procesu roboczego usługi](https://developer.mozilla.org/docs/Web/API/Service_Worker_API.) .</span><span class="sxs-lookup"><span data-stu-id="8fbf7-199">See [service worker documentation](https://developer.mozilla.org/docs/Web/API/Service_Worker_API.) for more information.</span></span>

#### <a name="how-requests-are-resolved"></a><span data-ttu-id="8fbf7-200">Jak są rozwiązywane żądania</span><span class="sxs-lookup"><span data-stu-id="8fbf7-200">How requests are resolved</span></span>

<span data-ttu-id="8fbf7-201">Jak opisano powyżej, domyślny proces roboczy usługi korzysta z strategii dotyczącej *pamięci podręcznej* , co oznacza, że próbuje obsłużć zawartość buforowaną, jeśli jest dostępna.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-201">As described above, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="8fbf7-202">W przypadku braku zawartości przechowywanej w pamięci podręcznej dla określonego adresu URL, na przykład podczas żądania danych z interfejsu API zaplecza, proces roboczy usługi powraca do zwykłego żądania sieci, co może zakończyć się powodzeniem tylko wtedy, gdy serwer jest osiągalny.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-202">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request which can only succeed if the server is reachable.</span></span> <span data-ttu-id="8fbf7-203">Ta logika jest implementowana w `onFetch` w ramach *Service-Worker. opublikowano. js*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-203">This logic is implemented inside `onFetch` within *service-worker.published.js*.</span></span>

<span data-ttu-id="8fbf7-204">Jeśli składniki Blazor korzystają z żądania danych z interfejsów API zaplecza i chcesz zapewnić przyjazne środowisko użytkownika w przypadku, gdy takie żądania nie powiodą się z powodu niedostępności sieci, należy zaimplementować logikę w składnikach.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-204">If your Blazor components rely on requesting data from backend APIs, and you want to provide a friendly user experience in the case where such requests fail due to network unavailability, then you need to implement logic within your components.</span></span> <span data-ttu-id="8fbf7-205">Na przykład użyj `try/catch` wokół żądań `HttpClient`.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-205">For example, use `try/catch` around `HttpClient` requests.</span></span>

#### <a name="support-server-rendered-pages"></a><span data-ttu-id="8fbf7-206">Obsługa stron renderowanych na serwerze</span><span class="sxs-lookup"><span data-stu-id="8fbf7-206">Support server-rendered pages</span></span>

<span data-ttu-id="8fbf7-207">Zastanów się, co się stanie, gdy użytkownik najpierw nawiguje do adresu URL, takiego jak `/counter`, lub dowolnego innego linku bezpośredniego do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-207">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link into your application.</span></span> <span data-ttu-id="8fbf7-208">W takich przypadkach nie chcesz zwracać zawartości w pamięci podręcznej jako `/counter`, ale zamiast tego należy użyć przeglądarki do załadowania zawartości w pamięci podręcznej jako `/index.html`, aby uruchomić aplikację Blazor webassembly.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-208">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly application.</span></span> <span data-ttu-id="8fbf7-209">Te początkowe żądania są znane jako żądania *nawigacji* (w przeciwieństwie do żądań dotyczących *zasobów* dla obrazów/CSS/etc lub *pobierania/XHR* żądań dotyczących danych interfejsu API).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-209">These initial requests are known as *navigation* requests (as opposed to *subresource* requests for images/CSS/etc, or *fetch/XHR* requests for API data).</span></span>

<span data-ttu-id="8fbf7-210">Domyślny proces roboczy usługi zawiera logikę przypadków specjalnych dla żądań nawigacji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-210">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="8fbf7-211">Rozwiązuje je, zwracając zawartość z pamięci podręcznej dla `/index.html`niezależnie od żądanego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-211">It resolves them by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="8fbf7-212">Ta logika jest implementowana w funkcji `onFetch` w *Service-Worker. opublikowano. js*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-212">This logic is implemented in the `onFetch` function inside *service-worker.published.js*.</span></span>

<span data-ttu-id="8fbf7-213">Jeśli aplikacja zawiera pewne adresy URL, które muszą zwracać kod HTML renderowany przez serwer (i nie obsługują `/index.html` z pamięci podręcznej), należy edytować logikę w procesie roboczym usługi.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-213">If your application has certain URLs that must return server-rendered HTML (and not serve `/index.html` from the cache), then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="8fbf7-214">Na przykład, jeśli wszystkie adresy URL zawierające `/Identity/` muszą być obsługiwane jako regularne żądania tylko online do serwera, zmodyfikuj logikę `onFetch` *Service-Worker. opublikowano. js* .</span><span class="sxs-lookup"><span data-stu-id="8fbf7-214">For example, if all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify *service-worker.published.js* `onFetch` logic.</span></span> <span data-ttu-id="8fbf7-215">Znajdź następujący kod:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-215">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="8fbf7-216">Zmień kod na następujący:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-216">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="8fbf7-217">Jeśli tego nie zrobisz, proces roboczy usługi przechwytuje żądania dotyczące adresów URL i rozwiąże je przy użyciu `/index.html`.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-217">If you don't do this, then regardless of network connectivity, the service worker will intercept requests for such URLs and will resolve them using `/index.html`.</span></span>

#### <a name="control-asset-caching"></a><span data-ttu-id="8fbf7-218">Sterowanie buforowaniem zasobów</span><span class="sxs-lookup"><span data-stu-id="8fbf7-218">Control asset caching</span></span>

<span data-ttu-id="8fbf7-219">Jeśli projekt definiuje Właściwość programu MSBuild o nazwie `ServiceWorkerAssetsManifest`, narzędzia kompilacji Blazorwygenerują manifest zasobów procesów roboczych usługi o podanej nazwie.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-219">If your project defines an MSBuild property called `ServiceWorkerAssetsManifest`, then Blazor's build tooling will generate a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="8fbf7-220">Domyślny szablon PWA tworzy plik projektu zawierający następujące elementy:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-220">The default PWA template produces a project file containing the following:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="8fbf7-221">Plik zostanie umieszczony w katalogu wyjściowym *wwwroot* , dzięki czemu przeglądarka może pobrać ten plik, żądając `/service-worker-assets.js`.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-221">The file is placed in the *wwwroot* output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="8fbf7-222">Aby wyświetlić zawartość, Otwórz *YourProject\bin\Debug\netstandard2.1\wwwroot\service-Worker-Assets.js* w edytorze tekstu.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-222">To see the contents, open *YourProject\bin\Debug\netstandard2.1\wwwroot\service-worker-assets.js* in a text editor.</span></span> <span data-ttu-id="8fbf7-223">Jednak nie należy edytować pliku, ponieważ zostanie on wygenerowany ponownie dla każdej kompilacji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-223">However, don't edit the file, as it will be regenerated on each build.</span></span>

<span data-ttu-id="8fbf7-224">Domyślnie ten manifest zawiera następujące listę:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-224">By default, this manifest lists:</span></span>

* <span data-ttu-id="8fbf7-225">Wszystkie zasoby zarządzane przez Blazor, takie jak zestawy .NET i pliki środowiska uruchomieniowego programu .NET webassembly, które są potrzebne do działania w trybie offline</span><span class="sxs-lookup"><span data-stu-id="8fbf7-225">Any Blazor-managed resources such as .NET assemblies and the .NET WebAssembly runtime files needed to function offline</span></span>
* <span data-ttu-id="8fbf7-226">Wszystkie zasoby, które zostaną opublikowane w katalogu *wwwroot* , takie jak obrazy, pliki CSS i pliki JavaScript.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-226">All resources that will be published in your *wwwroot* directory, such as images, CSS files, and JavaScript files.</span></span> <span data-ttu-id="8fbf7-227">Obejmuje to statyczne zasoby sieci Web dostarczane przez zewnętrzne projekty i pakiety NuGet.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-227">This includes static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="8fbf7-228">Można kontrolować, które z tych zasobów będą pobierane i buforowane przez proces roboczy usługi przez edytowanie logiki w `onInstall` w *Service-Worker. opublikowano. js*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-228">You can control which of these resources will be fetched and cached by the service worker by editing the logic in `onInstall` in *service-worker.published.js*.</span></span> <span data-ttu-id="8fbf7-229">Domyślnie pobiera i buforuje pliki zgodne z typowymi rozszerzeniami nazw sieci Web, takimi jak *. html*, *. css*,. *js*, *. wasm*i innych, a także typy plików specyficzne dla Blazor webassembly ( *. dll*, *. pdb*).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-229">By default, it will fetch and cache files matching typical web filename extensions such as *.html*, *.css*, *.js*, *.wasm*, and others, plus file types specific to Blazor WebAssembly (*.dll*, *.pdb*).</span></span>

<span data-ttu-id="8fbf7-230">Jeśli chcesz uwzględnić dodatkowe zasoby, które nie znajdują się w katalogu *wwwroot* , możesz to zrobić przez zdefiniowanie dodatkowych wpisów w ramach elementu MSBuild.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-230">If you want to include additional resources that aren't present in your *wwwroot* directory, you can do so by defining extra MSBuild itemgroup entries.</span></span> <span data-ttu-id="8fbf7-231">Na przykład w pliku projektu Dodaj:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-231">For example, in your project file, add:</span></span>

```xml
<ItemGroup>
    <ServiceWorkerAssetsManifestItem
        Include="MyDirectory\AnotherFile.json"
        RelativePath="MyDirectory\AnotherFile.json"
        AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="8fbf7-232">Metadane `AssetUrl` określają podstawowy adres URL, który powinien być używany przez przeglądarkę podczas pobierania zasobu do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-232">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="8fbf7-233">Może to być niezależna od oryginalnej nazwy pliku źródłowego na dysku.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-233">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8fbf7-234">Dodanie `ServiceWorkerAssetsManifestItem` nie powoduje opublikowania pliku w katalogu *wwwroot* .</span><span class="sxs-lookup"><span data-stu-id="8fbf7-234">Adding a `ServiceWorkerAssetsManifestItem` does not cause the file to be published in your *wwwroot* directory.</span></span> <span data-ttu-id="8fbf7-235">Pozwala ona na kontrolowanie danych wyjściowych publikowanych osobno.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-235">It up to you to control your publish output separately.</span></span> <span data-ttu-id="8fbf7-236">`ServiceWorkerAssetsManifestItem` powoduje tylko dodatkowy wpis do wyświetlenia w manifeście zasobów procesu roboczego usługi.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-236">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="8fbf7-237">Powiadomienia push</span><span class="sxs-lookup"><span data-stu-id="8fbf7-237">Push notifications</span></span>

<span data-ttu-id="8fbf7-238">Podobnie jak w przypadku wszystkich innych aplikacji PWA, Blazor webassembly PWA może odbierać powiadomienia wypychane z serwera wewnętrznej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-238">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="8fbf7-239">Serwer może wysłać je w dowolnym momencie, nawet jeśli użytkownik nie korzysta aktywnie z aplikacji (na przykład gdy inny użytkownik wykonuje akcję, która może być istotna).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-239">Your server can send these at any time, even when the user is not actively using your application (for example, when a different user performs an action that may be relevant).</span></span>

<span data-ttu-id="8fbf7-240">Mechanizm wysyłania powiadomień wypychanych jest całkowicie niezależny od Blazor webassembly, ponieważ jest zaimplementowany przez serwer wewnętrznej bazy danych, który może korzystać z dowolnej technologii.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-240">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="8fbf7-241">Jeśli chcesz wysyłać powiadomienia wypychane z serwera ASP.NET Core, rozważ [użycie techniki podobnej do tej w warsztatie niezwykle Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-241">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to that in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="8fbf7-242">Mechanizm otrzymywania i wyświetlania powiadomień wypychanych na kliencie jest również niezależny od Blazor webassembly, ponieważ jest zaimplementowany w procesie roboczym usługi, który jest plikiem JavaScript.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-242">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker, which is a JavaScript file.</span></span> <span data-ttu-id="8fbf7-243">Na przykład możesz ponownie zobaczyć [podejście używane w warsztatie niezwykle Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-243">As an example, you can again see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="8fbf7-244">Ostrzeżenia dotyczące PWAs w trybie offline</span><span class="sxs-lookup"><span data-stu-id="8fbf7-244">Caveats for offline PWAs</span></span>

<span data-ttu-id="8fbf7-245">Nie wszystkie aplikacje powinny próbować obsługiwać użycie w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-245">Not all applications should attempt to support offline use.</span></span> <span data-ttu-id="8fbf7-246">Zwiększa ona znaczącą złożoność, ale nie zawsze jest istotna.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-246">It adds significant complexity, while not always being relevant.</span></span>

<span data-ttu-id="8fbf7-247">Obsługa w trybie offline jest zwykle istotna:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-247">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="8fbf7-248">Jeśli podstawowy magazyn danych jest lokalny dla przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-248">If your primary data store is local to the browser.</span></span> <span data-ttu-id="8fbf7-249">Na przykład podczas kompilowania interfejsu użytkownika dla urządzenia [IoT](https://en.wikipedia.org/wiki/Internet_of_things) , które przechowuje dane w `localStorage` lub [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-249">For example, when building a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>

* <span data-ttu-id="8fbf7-250">Jeśli masz znaczącą służbę do pobierania i buforowania danych interfejsu API zaplecza związanych z każdym użytkownikiem, można poruszać się w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-250">If you do significant work to fetch and cache the backend API data relevant to each user, so they can navigate through it offline.</span></span> <span data-ttu-id="8fbf7-251">W przypadku obsługi edycji należy również utworzyć system do śledzenia zmian i synchronizowania ich z zapleczem.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-251">If you support editing, you will also need to build a system for tracking changes and synchronizing them with the backend.</span></span>

* <span data-ttu-id="8fbf7-252">Jeśli celem jest zagwarantowanie, że aplikacja zostanie załadowana natychmiast niezależnie od warunków sieci.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-252">If your goal is to guarantee the application loads immediately regardless of network conditions.</span></span> <span data-ttu-id="8fbf7-253">Następnie należy zaimplementować odpowiednie środowisko użytkownika dla żądań interfejsu API zaplecza, aby pokazać postęp żądań i zachować wrażenie niepowodzenia z powodu niedostępności sieci.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-253">You will then need to implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when they fail due to network unavailability.</span></span>

<span data-ttu-id="8fbf7-254">Ponadto PWAs z obsługą trybu offline musi zająć się zakresem dodatkowych komplikacji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-254">Additionally, offline-capable PWAs need to deal with a range of extra complications.</span></span> <span data-ttu-id="8fbf7-255">Deweloperzy powinni uważnie zapoznać się z poniższymi zastrzeżeniami.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-255">Developers should carefully familiarize themselves with the following caveats.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="8fbf7-256">Obsługa offline tylko po opublikowaniu</span><span class="sxs-lookup"><span data-stu-id="8fbf7-256">Offline support only when published</span></span>

<span data-ttu-id="8fbf7-257">szablon aplikacji PWA Blazorumożliwia obsługę offline tylko po opublikowaniu.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-257">Blazor's PWA template enables offline support only when published.</span></span> <span data-ttu-id="8fbf7-258">Jest to spowodowane tym, że podczas opracowywania zwykle chcesz zobaczyć, że zmiany zostaną odzwierciedlone natychmiast w przeglądarce, bez przechodzenia przez proces aktualizacji w tle.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-258">This is because, during development, you typically want to see each change reflected immediately in the browser, without going through a background update process.</span></span>

<span data-ttu-id="8fbf7-259">W związku z tym podczas kompilowania aplikacji z obsługą trybu offline jest za mało, aby przetestować aplikację w trybie tworzenia.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-259">Therefore when building an offline-capable application, it's not enough to test your application in development mode.</span></span> <span data-ttu-id="8fbf7-260">Należy przetestować aplikację w stanie opublikowanym, aby zrozumieć, jak będzie ona odpowiadać na różne warunki sieci.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-260">You must test your application in its published state to understand how it will respond to differing network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="8fbf7-261">Aktualizowanie uzupełniania po nawigacji użytkownika z aplikacji</span><span class="sxs-lookup"><span data-stu-id="8fbf7-261">Update completion after user navigation away from app</span></span>

<span data-ttu-id="8fbf7-262">Aktualizacje nie zostaną ukończone, dopóki użytkownik nie wyjdzie z aplikacji na wszystkich kartach.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-262">Updates don't complete until the user has navigated away from your application in all tabs.</span></span> <span data-ttu-id="8fbf7-263">Zgodnie z opisem w temacie [aktualizacje w tle](#background-updates), po wdrożeniu aktualizacji dla aplikacji Przeglądarka pobierze zaktualizowane pliki procesu roboczego usługi i rozpocznie proces aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-263">As explained in [Background updates](#background-updates), after you deploy an update to your application, the browser will fetch the updated service worker files and begin an update process.</span></span>

<span data-ttu-id="8fbf7-264">Co się stało z wieloma deweloperami, nawet po zakończeniu tej aktualizacji **nie zacznie obowiązywać** , dopóki użytkownik nie przejdzie na wszystkie karty.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-264">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="8fbf7-265">Odświeżenie karty wyświetlającej aplikację **nie** jest wystarczające, nawet jeśli jest to jedyna karta wyświetlająca aplikację.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-265">It is **not** sufficient to refresh the tab displaying your application, even if it's the only tab displaying your application.</span></span> <span data-ttu-id="8fbf7-266">Do momentu całkowitego zamknięcia aplikacji nowy proces roboczy usługi pozostanie w stanie "Oczekiwanie na aktywację".</span><span class="sxs-lookup"><span data-stu-id="8fbf7-266">Until your application is completely closed, the new service worker will remain in a "waiting to activate" status.</span></span> <span data-ttu-id="8fbf7-267">**Nie jest to specyficzne dla Blazor, ale raczej jest standardowe zachowanie platformy sieci Web.**</span><span class="sxs-lookup"><span data-stu-id="8fbf7-267">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="8fbf7-268">Jest to często spowodowane przez deweloperów, którzy próbują przetestować aktualizacje do swoich procesów roboczych lub zasobów w pamięci podręcznej w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-268">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="8fbf7-269">W przypadku zaewidencjonowania narzędzi deweloperskich w przeglądarce można zobaczyć podobne do następujących:</span><span class="sxs-lookup"><span data-stu-id="8fbf7-269">If you check in the browser's dev tools, you may see something like the following:</span></span>

![obraz](https://user-images.githubusercontent.com/1101362/76226394-b93f7380-6215-11ea-8572-7d52afee2dd8.png)

<span data-ttu-id="8fbf7-271">W przypadku, gdy lista "klientów" (tj. kart lub okien wyświetlania aplikacji) nie jest pusta, proces roboczy będzie kontynuował oczekiwanie.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-271">For as long as the list of "clients" (i.e., tabs or windows displaying your application) is nonempty, the worker will continue waiting.</span></span> <span data-ttu-id="8fbf7-272">Przyczyną tego problemu jest zagwarantowanie spójności, tj., że wszystkie zasoby są pobierane z tej samej niepodzielnej pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-272">The reason service workers do this is to guarantee consistency, i.e., that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="8fbf7-273">Podczas testowania zmian może być przydatne kliknięcie linku "skipWaiting", jak pokazano na poniższym zrzucie ekranu, a następnie ponowne załadowanie strony.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-273">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the screenshot above, then reload the page.</span></span> <span data-ttu-id="8fbf7-274">Jeśli chcesz, Możesz zautomatyzować ten proces dla wszystkich użytkowników, napisanie przez siebie procesu roboczego usługi w celu [pominięcia fazy "oczekiwanie" i natychmiastowej aktywacji przy aktualizacji](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-274">If you want, you can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="8fbf7-275">Jeśli jednak to zrobisz, nastąpi zagwarantowanie, że zasoby są zawsze pobierane spójnie z tego samego wystąpienia pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-275">However if you do this, you are giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="8fbf7-276">Użytkownicy mogą uruchamiać dowolną wersję historyczną aplikacji</span><span class="sxs-lookup"><span data-stu-id="8fbf7-276">Users may run any historical version of the app</span></span>

<span data-ttu-id="8fbf7-277">Deweloperzy sieci Web zwykle oczekują, że użytkownicy będą uruchamiać tylko najnowszą wdrożoną wersję aplikacji sieci Web, ponieważ jest ona normalna w ramach tradycyjnego modelu dystrybucji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-277">Web developers habitually expect that users will only run the latest deployed version of their web application, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="8fbf7-278">Jednak w trybie offline — w pierwszej kolejności program PWA jest bardziej zbliżone w natywnej aplikacji mobilnej, w której użytkownicy nie muszą uruchamiać najnowszej wersji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-278">However, an offline-first PWA is more akin to a native mobile app, where users are not necessarily running the latest version.</span></span>

<span data-ttu-id="8fbf7-279">Zgodnie z opisem w temacie [aktualizacje w tle](#background-updates), po wdrożeniu aktualizacji aplikacji, **każdy istniejący użytkownik będzie nadal używał poprzedniej wersji dla co najmniej jednej kolejnej odwiedzania** (ponieważ aktualizacja odbywa się w tle i nie jest aktywowana, dopóki użytkownik nie wyjdzie dalej).</span><span class="sxs-lookup"><span data-stu-id="8fbf7-279">As explained in [Background updates](#background-updates), after you deploy an update to your application, **each existing user will continue to use a previous version for at least one further visit** (because the update occurs in the background and isn't activated until the user then navigates away).</span></span> <span data-ttu-id="8fbf7-280">Ponadto Poprzednia wersja jest wcześniejsza niż poprzednio wdrożona — może to być *dowolna* wersja historyczna, w zależności od tego, kiedy użytkownik ostatnio ukończył aktualizację.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-280">Plus, the previous version being used isn't necessarily the previous one you deployed - it can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="8fbf7-281">Może to być problemem, jeśli składniki frontonu i zaplecza aplikacji wymagają umowy dotyczącej schematu dla żądań interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-281">This can be an issue if the frontend and backend parts of your application require agreement about the schema for API requests.</span></span> <span data-ttu-id="8fbf7-282">Nie należy wdrażać zmian schematu interfejsu API bez zgodności z poprzednimi wersjami, dopóki nie będzie można upewnić się, że wszyscy użytkownicy zostali zaktualizowani, lub co najmniej Zablokuj użytkownikom możliwość korzystania ze starszych wersji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-282">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded, or at least block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="8fbf7-283">Jest to podobne do natywnej aplikacji mobilnej.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-283">This is just like a native mobile app.</span></span> <span data-ttu-id="8fbf7-284">W przypadku wdrożenia istotnej zmiany w interfejsach API serwera aplikacja kliencka zostanie uszkodzona dla osób, które nie zostały jeszcze zaktualizowane.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-284">If you deploy a breaking change in server APIs, the client app will be broken for people who haven't yet updated.</span></span>

<span data-ttu-id="8fbf7-285">Jeśli to możliwe, nie Wdrażaj istotnych zmian w interfejsach API zaplecza.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-285">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="8fbf7-286">Ale jeśli to konieczne, należy rozważyć użycie [standardowych interfejsów API procesów roboczych, takich jak `ServiceWorkerRegistration`](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) , aby określić, czy aplikacja jest aktualna, a jeśli nie, aby zapobiec użyciu.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-286">But if you must do so, consider using [standard Service Worker APIs such as `ServiceWorkerRegistration`](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the application is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="8fbf7-287">Zakłócenia przy użyciu stron renderowanych na serwerze</span><span class="sxs-lookup"><span data-stu-id="8fbf7-287">Interference with server-rendered pages</span></span>

<span data-ttu-id="8fbf7-288">[Jak opisano powyżej](#support-server-rendered-pages), jeśli chcesz ominąć zachowanie `/index.html` zawartości dla wszystkich żądań nawigacji przez proces roboczy usługi, musisz edytować logikę w procesie roboczym usługi.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-288">[As described above](#support-server-rendered-pages), if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, you need to edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="8fbf7-289">Zawartość manifestu wszystkich zasobów procesu roboczego usługi jest domyślnie buforowana</span><span class="sxs-lookup"><span data-stu-id="8fbf7-289">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="8fbf7-290">[Jak opisano powyżej](#control-asset-caching), plik *Service-Worker-Assets. js* jest generowany podczas kompilacji i zawiera listę wszystkich zasobów, które pracownik usług powinien pobrać i buforować.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-290">[As described above](#control-asset-caching), the file *service-worker-assets.js* is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="8fbf7-291">Ponieważ ta lista domyślnie zawiera wszystkie dane wyemitowane do *wwwroot* (w tym zawartość dostarczaną przez zewnętrzne pakiety i projekty), należy uważać, aby nie umieścić zbyt dużej ilości zawartości.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-291">Since this list by default includes everything emitted to *wwwroot* (including content supplied by external packages and projects), you must be careful not to put too much content there.</span></span> <span data-ttu-id="8fbf7-292">Jeśli na przykład katalog *wwwroot* zawiera miliony obrazów, proces roboczy usługi spróbuje pobrać i buforować je wszystkie, zużywać nadmierną przepustowość i prawdopodobnie nie zostanie pomyślnie zakończony.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-292">If for example your *wwwroot* directory contains millions of images, the service worker would try to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="8fbf7-293">Możliwe jest zaimplementowanie dowolnej logiki w celu kontrolowania, który podzbiór zawartości manifestu powinien być pobierany i buforowany przez edycję funkcji `onInstall` w *Service-Worker. opublikowano. js*.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-293">You can implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in *service-worker.published.js*.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="8fbf7-294">Interakcja z uwierzytelnianiem</span><span class="sxs-lookup"><span data-stu-id="8fbf7-294">Interaction with authentication</span></span>

<span data-ttu-id="8fbf7-295">Możliwe jest użycie opcji szablonu PWA w połączeniu z opcjami uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-295">It's possible to use the PWA template option in conjunction with the authentication options.</span></span> <span data-ttu-id="8fbf7-296">PWA obsługujący tryb offline może również obsługiwać uwierzytelnianie, gdy użytkownik ma łączność sieciową.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-296">An offline-capable PWA can also support authentication when the user has network connectivity.</span></span>

<span data-ttu-id="8fbf7-297">Jeśli jednak użytkownik nie ma łączności sieciowej, nie będzie mógł uwierzytelnić ani uzyskać tokenów dostępu.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-297">However, when a user does not have network connectivity, they will not be able to authenticate or obtain access tokens.</span></span> <span data-ttu-id="8fbf7-298">Próba odwiedzenia strony "login" spowoduje wyświetlenie komunikatu o błędzie "błąd sieci".</span><span class="sxs-lookup"><span data-stu-id="8fbf7-298">Attempting to visit the "login" page will by default display a message saying "network error".</span></span>

<span data-ttu-id="8fbf7-299">Ponieważ jest to zadanie, aby zaprojektować przepływ interfejsu użytkownika, który umożliwia użytkownikowi wykonywanie użytecznych funkcji podczas pracy w trybie offline bez próby uwierzytelnienia lub uzyskania tokenów dostępu, lub co najmniej niepowodzeniem w takich przypadkach.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-299">As such it's your job to design a UI flow that lets the user do useful things while offline without attempting to authenticate or obtain access tokens, or at least failing in a graceful way in those cases.</span></span> <span data-ttu-id="8fbf7-300">Jeśli nie jest to możliwe w aplikacji, może nie być konieczne włączenie obsługi offline.</span><span class="sxs-lookup"><span data-stu-id="8fbf7-300">If this isn't possible in your application, you might not want to enable offline support.</span></span>
